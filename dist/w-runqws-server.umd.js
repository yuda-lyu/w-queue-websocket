/*!
 * w-runqws-server v1.0.26
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ws"),require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","events","mongodb","stream"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-runqws-server"]=e(t.ws,t.events,t.mongodb,t.stream)}(this,(function(t,e,n,r){"use strict";var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function u(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var a=function(){this.__data__=[],this.size=0};var c=function(t,e){return t===e||t!=t&&e!=e},f=c;var l=function(t,e){for(var n=t.length;n--;)if(f(t[n][0],e))return n;return-1},s=l,v=Array.prototype.splice;var p=l;var d=l;var h=l;var y=a,b=function(t){var e=this.__data__,n=s(e,t);return!(n<0)&&(n==e.length-1?e.pop():v.call(e,n,1),--this.size,!0)},g=function(t){var e=this.__data__,n=p(e,t);return n<0?void 0:e[n][1]},j=function(t){return d(this.__data__,t)>-1},w=function(t,e){var n=this.__data__,r=h(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function _(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}_.prototype.clear=y,_.prototype.delete=b,_.prototype.get=g,_.prototype.has=j,_.prototype.set=w;var m=_,A=m;var O=function(){this.__data__=new A,this.size=0};var x=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var S=function(t){return this.__data__.get(t)};var B=function(t){return this.__data__.has(t)},k="object"==typeof o&&o&&o.Object===Object&&o,U=k,P="object"==typeof self&&self&&self.Object===Object&&self,z=U||P||Function("return this")(),C=z.Symbol,E=C,M=Object.prototype,I=M.hasOwnProperty,T=M.toString,D=E?E.toStringTag:void 0;var F=function(t){var e=I.call(t,D),n=t[D];try{t[D]=void 0;var r=!0}catch(t){}var o=T.call(t);return r&&(e?t[D]=n:delete t[D]),o},N=Object.prototype.toString;var L=F,$=function(t){return N.call(t)},R=C?C.toStringTag:void 0;var Q=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":R&&R in Object(t)?L(t):$(t)};var G=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},W=Q,q=G;var V,H=function(t){if(!q(t))return!1;var e=W(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},J=z["__core-js_shared__"],K=(V=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";var X=function(t){return!!K&&K in t},Y=Function.prototype.toString;var Z=function(t){if(null!=t){try{return Y.call(t)}catch(t){}try{return t+""}catch(t){}}return""},tt=H,et=X,nt=G,rt=Z,ot=/^\[object .+?Constructor\]$/,it=Function.prototype,ut=Object.prototype,at=it.toString,ct=ut.hasOwnProperty,ft=RegExp("^"+at.call(ct).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var lt=function(t){return!(!nt(t)||et(t))&&(tt(t)?ft:ot).test(rt(t))},st=function(t,e){return null==t?void 0:t[e]};var vt=function(t,e){var n=st(t,e);return lt(n)?n:void 0},pt=vt(z,"Map"),dt=vt(Object,"create"),ht=dt;var yt=function(){this.__data__=ht?ht(null):{},this.size=0};var bt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},gt=dt,jt=Object.prototype.hasOwnProperty;var wt=function(t){var e=this.__data__;if(gt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return jt.call(e,t)?e[t]:void 0},_t=dt,mt=Object.prototype.hasOwnProperty;var At=dt;var Ot=yt,xt=bt,St=wt,Bt=function(t){var e=this.__data__;return _t?void 0!==e[t]:mt.call(e,t)},kt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=At&&void 0===e?"__lodash_hash_undefined__":e,this};function Ut(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ut.prototype.clear=Ot,Ut.prototype.delete=xt,Ut.prototype.get=St,Ut.prototype.has=Bt,Ut.prototype.set=kt;var Pt=Ut,zt=m,Ct=pt;var Et=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Mt=function(t,e){var n=t.__data__;return Et(e)?n["string"==typeof e?"string":"hash"]:n.map},It=Mt;var Tt=Mt;var Dt=Mt;var Ft=Mt;var Nt=function(t,e){var n=Ft(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Lt=function(){this.size=0,this.__data__={hash:new Pt,map:new(Ct||zt),string:new Pt}},$t=function(t){var e=It(this,t).delete(t);return this.size-=e?1:0,e},Rt=function(t){return Tt(this,t).get(t)},Qt=function(t){return Dt(this,t).has(t)},Gt=Nt;function Wt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Wt.prototype.clear=Lt,Wt.prototype.delete=$t,Wt.prototype.get=Rt,Wt.prototype.has=Qt,Wt.prototype.set=Gt;var qt=Wt,Vt=m,Ht=pt,Jt=qt;var Kt=m,Xt=O,Yt=x,Zt=S,te=B,ee=function(t,e){var n=this.__data__;if(n instanceof Vt){var r=n.__data__;if(!Ht||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Jt(r)}return n.set(t,e),this.size=n.size,this};function ne(t){var e=this.__data__=new Kt(t);this.size=e.size}ne.prototype.clear=Xt,ne.prototype.delete=Yt,ne.prototype.get=Zt,ne.prototype.has=te,ne.prototype.set=ee;var re=ne;var oe=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},ie=vt,ue=function(){try{var t=ie(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),ae=ue;var ce=function(t,e,n){"__proto__"==e&&ae?ae(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},fe=ce,le=c,se=Object.prototype.hasOwnProperty;var ve=function(t,e,n){var r=t[e];se.call(t,e)&&le(r,n)&&(void 0!==n||e in t)||fe(t,e,n)},pe=ve,de=ce;var he=function(t,e,n,r){var o=!n;n||(n={});for(var i=-1,u=e.length;++i<u;){var a=e[i],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),o?de(n,a,c):pe(n,a,c)}return n};var ye=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var be=function(t){return null!=t&&"object"==typeof t},ge=Q,je=be;var we=function(t){return je(t)&&"[object Arguments]"==ge(t)},_e=be,me=Object.prototype,Ae=me.hasOwnProperty,Oe=me.propertyIsEnumerable,xe=we(function(){return arguments}())?we:function(t){return _e(t)&&Ae.call(t,"callee")&&!Oe.call(t,"callee")},Se=xe,Be=Array.isArray,ke={};var Ue=function(){return!1};!function(t,e){var n=z,r=Ue,o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,u=i&&i.exports===o?n.Buffer:void 0,a=(u?u.isBuffer:void 0)||r;t.exports=a}({get exports(){return ke},set exports(t){ke=t}},ke);var Pe=/^(?:0|[1-9]\d*)$/;var ze=function(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Pe.test(t))&&t>-1&&t%1==0&&t<e};var Ce=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Ee=Q,Me=Ce,Ie=be,Te={};Te["[object Float32Array]"]=Te["[object Float64Array]"]=Te["[object Int8Array]"]=Te["[object Int16Array]"]=Te["[object Int32Array]"]=Te["[object Uint8Array]"]=Te["[object Uint8ClampedArray]"]=Te["[object Uint16Array]"]=Te["[object Uint32Array]"]=!0,Te["[object Arguments]"]=Te["[object Array]"]=Te["[object ArrayBuffer]"]=Te["[object Boolean]"]=Te["[object DataView]"]=Te["[object Date]"]=Te["[object Error]"]=Te["[object Function]"]=Te["[object Map]"]=Te["[object Number]"]=Te["[object Object]"]=Te["[object RegExp]"]=Te["[object Set]"]=Te["[object String]"]=Te["[object WeakMap]"]=!1;var De=function(t){return Ie(t)&&Me(t.length)&&!!Te[Ee(t)]};var Fe=function(t){return function(e){return t(e)}},Ne={};!function(t,e){var n=k,r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,i=o&&o.exports===r&&n.process,u=function(){try{var t=o&&o.require&&o.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=u}({get exports(){return Ne},set exports(t){Ne=t}},Ne);var Le=De,$e=Fe,Re=Ne&&Ne.isTypedArray,Qe=Re?$e(Re):Le,Ge=ye,We=Se,qe=Be,Ve=ke,He=ze,Je=Qe,Ke=Object.prototype.hasOwnProperty;var Xe=function(t,e){var n=qe(t),r=!n&&We(t),o=!n&&!r&&Ve(t),i=!n&&!r&&!o&&Je(t),u=n||r||o||i,a=u?Ge(t.length,String):[],c=a.length;for(var f in t)!e&&!Ke.call(t,f)||u&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||He(f,c))||a.push(f);return a},Ye=Object.prototype;var Ze=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ye)};var tn=function(t,e){return function(n){return t(e(n))}},en=tn(Object.keys,Object),nn=Ze,rn=en,on=Object.prototype.hasOwnProperty;var un=function(t){if(!nn(t))return rn(t);var e=[];for(var n in Object(t))on.call(t,n)&&"constructor"!=n&&e.push(n);return e},an=H,cn=Ce;var fn=function(t){return null!=t&&cn(t.length)&&!an(t)},ln=Xe,sn=un,vn=fn;var pn=function(t){return vn(t)?ln(t):sn(t)},dn=he,hn=pn;var yn=function(t,e){return t&&dn(e,hn(e),t)};var bn=G,gn=Ze,jn=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},wn=Object.prototype.hasOwnProperty;var _n=Xe,mn=function(t){if(!bn(t))return jn(t);var e=gn(t),n=[];for(var r in t)("constructor"!=r||!e&&wn.call(t,r))&&n.push(r);return n},An=fn;var On=function(t){return An(t)?_n(t,!0):mn(t)},xn=he,Sn=On;var Bn=function(t,e){return t&&xn(e,Sn(e),t)},kn={};!function(t,e){var n=z,r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,i=o&&o.exports===r?n.Buffer:void 0,u=i?i.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=u?u(n):new t.constructor(n);return t.copy(r),r}}({get exports(){return kn},set exports(t){kn=t}},kn);var Un=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e};var Pn=function(){return[]},zn=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var u=t[n];e(u,n,t)&&(i[o++]=u)}return i},Cn=Pn,En=Object.prototype.propertyIsEnumerable,Mn=Object.getOwnPropertySymbols,In=Mn?function(t){return null==t?[]:(t=Object(t),zn(Mn(t),(function(e){return En.call(t,e)})))}:Cn,Tn=he,Dn=In;var Fn=function(t,e){return Tn(t,Dn(t),e)};var Nn=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t},Ln=tn(Object.getPrototypeOf,Object),$n=Nn,Rn=Ln,Qn=In,Gn=Pn,Wn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)$n(e,Qn(t)),t=Rn(t);return e}:Gn,qn=he,Vn=Wn;var Hn=function(t,e){return qn(t,Vn(t),e)},Jn=Nn,Kn=Be;var Xn=function(t,e,n){var r=e(t);return Kn(t)?r:Jn(r,n(t))},Yn=Xn,Zn=In,tr=pn;var er=function(t){return Yn(t,tr,Zn)},nr=Xn,rr=Wn,or=On;var ir=function(t){return nr(t,or,rr)},ur=vt(z,"DataView"),ar=pt,cr=vt(z,"Promise"),fr=vt(z,"Set"),lr=vt(z,"WeakMap"),sr=Q,vr=Z,pr="[object Map]",dr="[object Promise]",hr="[object Set]",yr="[object WeakMap]",br="[object DataView]",gr=vr(ur),jr=vr(ar),wr=vr(cr),_r=vr(fr),mr=vr(lr),Ar=sr;(ur&&Ar(new ur(new ArrayBuffer(1)))!=br||ar&&Ar(new ar)!=pr||cr&&Ar(cr.resolve())!=dr||fr&&Ar(new fr)!=hr||lr&&Ar(new lr)!=yr)&&(Ar=function(t){var e=sr(t),n="[object Object]"==e?t.constructor:void 0,r=n?vr(n):"";if(r)switch(r){case gr:return br;case jr:return pr;case wr:return dr;case _r:return hr;case mr:return yr}return e});var Or=Ar,xr=Object.prototype.hasOwnProperty;var Sr=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&xr.call(t,"index")&&(n.index=t.index,n.input=t.input),n},Br=z.Uint8Array,kr=Br;var Ur=function(t){var e=new t.constructor(t.byteLength);return new kr(e).set(new kr(t)),e},Pr=Ur;var zr=function(t,e){var n=e?Pr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},Cr=/\w*$/;var Er=function(t){var e=new t.constructor(t.source,Cr.exec(t));return e.lastIndex=t.lastIndex,e},Mr=C?C.prototype:void 0,Ir=Mr?Mr.valueOf:void 0;var Tr=Ur;var Dr=Ur,Fr=zr,Nr=Er,Lr=function(t){return Ir?Object(Ir.call(t)):{}},$r=function(t,e){var n=e?Tr(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var Rr=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return Dr(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return Fr(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return $r(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return Nr(t);case"[object Symbol]":return Lr(t)}},Qr=G,Gr=Object.create,Wr=function(){function t(){}return function(e){if(!Qr(e))return{};if(Gr)return Gr(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),qr=Ln,Vr=Ze;var Hr=function(t){return"function"!=typeof t.constructor||Vr(t)?{}:Wr(qr(t))},Jr=Or,Kr=be;var Xr=function(t){return Kr(t)&&"[object Map]"==Jr(t)},Yr=Fe,Zr=Ne&&Ne.isMap,to=Zr?Yr(Zr):Xr,eo=Or,no=be;var ro=function(t){return no(t)&&"[object Set]"==eo(t)},oo=Fe,io=Ne&&Ne.isSet,uo=io?oo(io):ro,ao=re,co=oe,fo=ve,lo=yn,so=Bn,vo=kn,po=Un,ho=Fn,yo=Hn,bo=er,go=ir,jo=Or,wo=Sr,_o=Rr,mo=Hr,Ao=Be,Oo=ke,xo=to,So=G,Bo=uo,ko=pn,Uo=On,Po="[object Arguments]",zo="[object Function]",Co="[object Object]",Eo={};Eo[Po]=Eo["[object Array]"]=Eo["[object ArrayBuffer]"]=Eo["[object DataView]"]=Eo["[object Boolean]"]=Eo["[object Date]"]=Eo["[object Float32Array]"]=Eo["[object Float64Array]"]=Eo["[object Int8Array]"]=Eo["[object Int16Array]"]=Eo["[object Int32Array]"]=Eo["[object Map]"]=Eo["[object Number]"]=Eo[Co]=Eo["[object RegExp]"]=Eo["[object Set]"]=Eo["[object String]"]=Eo["[object Symbol]"]=Eo["[object Uint8Array]"]=Eo["[object Uint8ClampedArray]"]=Eo["[object Uint16Array]"]=Eo["[object Uint32Array]"]=!0,Eo["[object Error]"]=Eo[zo]=Eo["[object WeakMap]"]=!1;var Mo=function t(e,n,r,o,i,u){var a,c=1&n,f=2&n,l=4&n;if(r&&(a=i?r(e,o,i,u):r(e)),void 0!==a)return a;if(!So(e))return e;var s=Ao(e);if(s){if(a=wo(e),!c)return po(e,a)}else{var v=jo(e),p=v==zo||"[object GeneratorFunction]"==v;if(Oo(e))return vo(e,c);if(v==Co||v==Po||p&&!i){if(a=f||p?{}:mo(e),!c)return f?yo(e,so(a,e)):ho(e,lo(a,e))}else{if(!Eo[v])return i?e:{};a=_o(e,v,c)}}u||(u=new ao);var d=u.get(e);if(d)return d;u.set(e,a),Bo(e)?e.forEach((function(o){a.add(t(o,n,r,o,e,u))})):xo(e)&&e.forEach((function(o,i){a.set(i,t(o,n,r,i,e,u))}));var h=s?void 0:(l?f?go:bo:f?Uo:ko)(e);return co(h||e,(function(o,i){h&&(o=e[i=o]),fo(a,i,t(o,n,r,i,e,u))})),a},Io=Mo;var To=function(t){return Io(t,5)},Do=Q,Fo=be;var No=function(t){return"symbol"==typeof t||Fo(t)&&"[object Symbol]"==Do(t)},Lo=Be,$o=No,Ro=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qo=/^\w*$/;var Go=function(t,e){if(Lo(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!$o(t))||(Qo.test(t)||!Ro.test(t)||null!=e&&t in Object(e))},Wo=qt;function qo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var u=t.apply(this,r);return n.cache=i.set(o,u)||i,u};return n.cache=new(qo.Cache||Wo),n}qo.Cache=Wo;var Vo=qo;var Ho=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jo=/\\(\\)?/g,Ko=function(t){var e=Vo(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ho,(function(t,n,r,o){e.push(r?o.replace(Jo,"$1"):n||t)})),e}));var Xo=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o},Yo=Xo,Zo=Be,ti=No,ei=C?C.prototype:void 0,ni=ei?ei.toString:void 0;var ri=function t(e){if("string"==typeof e)return e;if(Zo(e))return Yo(e,t)+"";if(ti(e))return ni?ni.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n},oi=ri;var ii=function(t){return null==t?"":oi(t)},ui=Be,ai=Go,ci=Ko,fi=ii;var li=function(t,e){return ui(t)?t:ai(t,e)?[t]:ci(fi(t))},si=No;var vi=function(t){if("string"==typeof t||si(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},pi=li,di=vi;var hi=function(t,e){for(var n=0,r=(e=pi(e,t)).length;null!=t&&n<r;)t=t[di(e[n++])];return n&&n==r?t:void 0},yi=hi;var bi=function(t,e,n){var r=null==t?void 0:yi(t,e);return void 0===r?n:r};var gi=qt,ji=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},wi=function(t){return this.__data__.has(t)};function _i(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new gi;++e<n;)this.add(t[e])}_i.prototype.add=_i.prototype.push=ji,_i.prototype.has=wi;var mi=_i,Ai=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},Oi=function(t,e){return t.has(e)};var xi=function(t,e,n,r,o,i){var u=1&n,a=t.length,c=e.length;if(a!=c&&!(u&&c>a))return!1;var f=i.get(t),l=i.get(e);if(f&&l)return f==e&&l==t;var s=-1,v=!0,p=2&n?new mi:void 0;for(i.set(t,e),i.set(e,t);++s<a;){var d=t[s],h=e[s];if(r)var y=u?r(h,d,s,e,t,i):r(d,h,s,t,e,i);if(void 0!==y){if(y)continue;v=!1;break}if(p){if(!Ai(e,(function(t,e){if(!Oi(p,e)&&(d===t||o(d,t,n,r,i)))return p.push(e)}))){v=!1;break}}else if(d!==h&&!o(d,h,n,r,i)){v=!1;break}}return i.delete(t),i.delete(e),v};var Si=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n};var Bi=Br,ki=c,Ui=xi,Pi=Si,zi=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Ci=C?C.prototype:void 0,Ei=Ci?Ci.valueOf:void 0;var Mi=function(t,e,n,r,o,i,u){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Bi(t),new Bi(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ki(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Pi;case"[object Set]":var c=1&r;if(a||(a=zi),t.size!=e.size&&!c)return!1;var f=u.get(t);if(f)return f==e;r|=2,u.set(t,e);var l=Ui(a(t),a(e),r,o,i,u);return u.delete(t),l;case"[object Symbol]":if(Ei)return Ei.call(t)==Ei.call(e)}return!1},Ii=er,Ti=Object.prototype.hasOwnProperty;var Di=re,Fi=xi,Ni=Mi,Li=function(t,e,n,r,o,i){var u=1&n,a=Ii(t),c=a.length;if(c!=Ii(e).length&&!u)return!1;for(var f=c;f--;){var l=a[f];if(!(u?l in e:Ti.call(e,l)))return!1}var s=i.get(t),v=i.get(e);if(s&&v)return s==e&&v==t;var p=!0;i.set(t,e),i.set(e,t);for(var d=u;++f<c;){var h=t[l=a[f]],y=e[l];if(r)var b=u?r(y,h,l,e,t,i):r(h,y,l,t,e,i);if(!(void 0===b?h===y||o(h,y,n,r,i):b)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var g=t.constructor,j=e.constructor;g==j||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof j&&j instanceof j||(p=!1)}return i.delete(t),i.delete(e),p},$i=Or,Ri=Be,Qi=ke,Gi=Qe,Wi="[object Arguments]",qi="[object Array]",Vi="[object Object]",Hi=Object.prototype.hasOwnProperty;var Ji=function(t,e,n,r,o,i){var u=Ri(t),a=Ri(e),c=u?qi:$i(t),f=a?qi:$i(e),l=(c=c==Wi?Vi:c)==Vi,s=(f=f==Wi?Vi:f)==Vi,v=c==f;if(v&&Qi(t)){if(!Qi(e))return!1;u=!0,l=!1}if(v&&!l)return i||(i=new Di),u||Gi(t)?Fi(t,e,n,r,o,i):Ni(t,e,c,n,r,o,i);if(!(1&n)){var p=l&&Hi.call(t,"__wrapped__"),d=s&&Hi.call(e,"__wrapped__");if(p||d){var h=p?t.value():t,y=d?e.value():e;return i||(i=new Di),o(h,y,n,r,i)}}return!!v&&(i||(i=new Di),Li(t,e,n,r,o,i))},Ki=be;var Xi=function t(e,n,r,o,i){return e===n||(null==e||null==n||!Ki(e)&&!Ki(n)?e!=e&&n!=n:Ji(e,n,r,o,t,i))},Yi=re,Zi=Xi;var tu=G;var eu=function(t){return t==t&&!tu(t)},nu=eu,ru=pn;var ou=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}},iu=function(t,e,n,r){var o=n.length,i=o,u=!r;if(null==t)return!i;for(t=Object(t);o--;){var a=n[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=n[o])[0],f=t[c],l=a[1];if(u&&a[2]){if(void 0===f&&!(c in t))return!1}else{var s=new Yi;if(r)var v=r(f,l,c,t,e,s);if(!(void 0===v?Zi(l,f,3,r,s):v))return!1}}return!0},uu=function(t){for(var e=ru(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,nu(o)]}return e},au=ou;var cu=li,fu=Se,lu=Be,su=ze,vu=Ce,pu=vi;var du=function(t,e){return null!=t&&e in Object(t)},hu=function(t,e,n){for(var r=-1,o=(e=cu(e,t)).length,i=!1;++r<o;){var u=pu(e[r]);if(!(i=null!=t&&n(t,u)))break;t=t[u]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&vu(o)&&su(u,o)&&(lu(t)||fu(t))};var yu=Xi,bu=bi,gu=function(t,e){return null!=t&&hu(t,e,du)},ju=Go,wu=eu,_u=ou,mu=vi;var Au=function(t){return t};var Ou=function(t){return function(e){return null==e?void 0:e[t]}},xu=hi;var Su=Ou,Bu=function(t){return function(e){return xu(e,t)}},ku=Go,Uu=vi;var Pu=function(t){var e=uu(t);return 1==e.length&&e[0][2]?au(e[0][0],e[0][1]):function(n){return n===t||iu(n,t,e)}},zu=function(t,e){return ju(t)&&wu(e)?_u(mu(t),e):function(n){var r=bu(n,t);return void 0===r&&r===e?gu(n,t):yu(e,r,3)}},Cu=Au,Eu=Be,Mu=function(t){return ku(t)?Su(Uu(t)):Bu(t)};var Iu=function(t){return"function"==typeof t?t:null==t?Cu:"object"==typeof t?Eu(t)?zu(t[0],t[1]):Pu(t):Mu(t)};var Tu=function(t){return function(e,n,r){for(var o=-1,i=Object(e),u=r(e),a=u.length;a--;){var c=u[t?a:++o];if(!1===n(i[c],c,i))break}return e}}(),Du=pn;var Fu=fn;var Nu=function(t,e){return function(n,r){if(null==n)return n;if(!Fu(n))return t(n,r);for(var o=n.length,i=e?o:-1,u=Object(n);(e?i--:++i<o)&&!1!==r(u[i],i,u););return n}}((function(t,e){return t&&Tu(t,e,Du)})),Lu=Nu,$u=fn;var Ru=Xo,Qu=Iu,Gu=function(t,e){var n=-1,r=$u(t)?Array(t.length):[];return Lu(t,(function(t,o,i){r[++n]=e(t,o,i)})),r},Wu=Be;var qu=function(t,e){return(Wu(t)?Ru:Gu)(t,Qu(e))},Vu=/\s/;var Hu=function(t){for(var e=t.length;e--&&Vu.test(t.charAt(e)););return e},Ju=/^\s+/;var Ku=function(t){return t?t.slice(0,Hu(t)+1).replace(Ju,""):t},Xu=G,Yu=No,Zu=/^[-+]0x[0-9a-f]+$/i,ta=/^0b[01]+$/i,ea=/^0o[0-7]+$/i,na=parseInt;var ra=function(t){if("number"==typeof t)return t;if(Yu(t))return NaN;if(Xu(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Xu(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ku(t);var n=ta.test(t);return n||ea.test(t)?na(t.slice(2),n?2:8):Zu.test(t)?NaN:+t},oa=ra,ia=1/0;var ua=function(t){return t?(t=oa(t))===ia||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},aa=ua;var ca=function(t){var e=aa(t),n=e%1;return e==e?n?e-n:e:0},fa=ca;var la=function(t){return"number"==typeof t&&t==fa(t)};function sa(t){return"[object String]"===Object.prototype.toString.call(t)}function va(t){return!(!sa(t)||""===t)}function pa(t){let e=!1;return va(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function da(t){if(!pa(t))return 0;return ua(t)}function ha(t){return!!pa(t)&&(t=da(t),la(t))}var ya=ca,ba=ra,ga=ii,ja=z.isFinite,wa=Math.min;var _a=function(t){var e=Math[t];return function(t,n){if(t=ba(t),(n=null==n?0:wa(ya(n),292))&&ja(t)){var r=(ga(t)+"e").split("e"),o=e(r[0]+"e"+(+r[1]+n));return+((r=(ga(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round");function ma(t){if(!pa(t))return 0;t=da(t);let e=_a(t);return"0"===String(e)?0:e}let Aa="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Oa=Aa.length;function xa(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];var n;t=ha(n=t)&&ma(n)>0?ma(t):32;for(let n=0;n<t;n++)e[n]=Aa[0|Math.random()*Oa];return e.join("")}var Sa={};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,u){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,i||t,u),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,u=new Array(i);o<i;o++)u[o]=r[o].fn;return u},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,o,i,u){var a=n?n+t:t;if(!this._events[a])return!1;var c,f,l=this._events[a],s=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),s){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,o),!0;case 5:return l.fn.call(l.context,e,r,o,i),!0;case 6:return l.fn.call(l.context,e,r,o,i,u),!0}for(f=1,c=new Array(s-1);f<s;f++)c[f-1]=arguments[f];l.fn.apply(l.context,c)}else{var v,p=l.length;for(f=0;f<p;f++)switch(l[f].once&&this.removeListener(t,l[f].fn,void 0,!0),s){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,e);break;case 3:l[f].fn.call(l[f].context,e,r);break;case 4:l[f].fn.call(l[f].context,e,r,o);break;default:if(!c)for(v=1,c=new Array(s-1);v<s;v++)c[v-1]=arguments[v];l[f].fn.apply(l[f].context,c)}}return!0},a.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||u(this,i);else{for(var c=0,f=[],l=a.length;c<l;c++)(a[c].fn!==e||o&&!a[c].once||r&&a[c].context!==r)&&f.push(a[c]);f.length?this._events[i]=1===f.length?f[0]:f:u(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&u(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}({get exports(){return Sa},set exports(t){Sa=t}});var Ba=Sa;var ka=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i},Ua=c,Pa=fn,za=ze,Ca=G;var Ea=function(t,e,n){if(!Ca(n))return!1;var r=typeof e;return!!("number"==r?Pa(n)&&za(e,n.length):"string"==r&&e in n)&&Ua(n[e],t)},Ma=ka,Ia=Ea,Ta=ca,Da=Math.ceil,Fa=Math.max;var Na=function(t,e,n){e=(n?Ia(t,e,n):void 0===e)?1:Fa(Ta(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var o=0,i=0,u=Array(Da(r/e));o<r;)u[i++]=Ma(t,o,o+=e);return u},La=Array.prototype.join;var $a=function(t,e){return null==t?"":La.call(t,e)},Ra={},Qa=Au;var Ga=oe,Wa=Nu,qa=function(t){return"function"==typeof t?t:Qa},Va=Be;var Ha=function(t,e){return(Va(t)?Ga:Wa)(t,qa(e))};!function(t){t.exports=Ha}({get exports(){return Ra},set exports(t){Ra=t}});var Ja=i(Ra);function Ka(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function Xa(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function Ya(t){if(!ha(t))return!1;return ma(t)>=0}function Za(t,e){return va(t)&&Ya(e)?0===(e=ma(e))?"":t.substring(0,e):""}function tc(t,e){return va(t)&&Ya(e)?0===(e=ma(e))?t:function(t,e){if(!va(t))return"";if(!Ya(e))return"";if(0===(e=ma(e)))return"";let n=t.length-e;return n<0&&(n=0),t.substr(n,e)}(t,t.length-e):""}var ec={},nc={get exports(){return ec},set exports(t){ec=t}};var rc,oc={},ic={get exports(){return oc},set exports(t){oc=t}},uc=u(Object.freeze({__proto__:null,default:{}}));function ac(){return rc||(rc=1,function(t,e){var n;t.exports=(n=n||function(t,e){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==o&&o.crypto&&(n=o.crypto),!n)try{n=uc}catch(t){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),u={},a=u.lib={},c=a.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},f=a.WordArray=c.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var u=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=u<<24-(r+i)%4*8}else for(var a=0;a<o;a+=4)e[r+a>>>2]=n[a>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(r());return new f.init(e,t)}}),l=u.enc={},s=l.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new f.init(n,e/2)}},v=l.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new f.init(n,e)}},p=l.Utf8={stringify:function(t){try{return decodeURIComponent(escape(v.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return v.parse(unescape(encodeURIComponent(t)))}},d=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n,r=this._data,o=r.words,i=r.sigBytes,u=this.blockSize,a=i/(4*u),c=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*u,l=t.min(4*c,i);if(c){for(var s=0;s<c;s+=u)this._doProcessBlock(o,s);n=o.splice(0,c),r.sigBytes-=l}return new f.init(n,l)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=d.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=u.algo={};return u}(Math),n)}(ic)),oc}!function(t,e){var n;t.exports=(n=ac(),function(){var t=n,e=t.lib.WordArray;function r(t,n,r){for(var o=[],i=0,u=0;u<n;u++)if(u%4){var a=r[t.charCodeAt(u-1)]<<u%4*2|r[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return e.create(o,i)}t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var o=[],i=0;i<n;i+=3)for(var u=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<n;a++)o.push(r.charAt(u>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var e=t.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var u=n.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(e=a)}return r(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)}(nc);var cc=ec,fc={};!function(t,e){var n;t.exports=(n=ac(),function(){if("function"==typeof ArrayBuffer){var t=n.lib.WordArray,e=t.init,r=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=t[o]<<24-o%4*8;e.call(this,r,n)}else e.apply(this,arguments)};r.prototype=t}}(),n.lib.WordArray)}({get exports(){return fc},set exports(t){fc=t}});var lc=fc;function sc(t){if(!Ka(t))return"";return lc.create(t).toString(cc)}function vc(t){if(!sa(t))return new Uint8Array;let e=cc.parse(t),n=e.words,r=e.sigBytes,o=new Uint8Array(r);for(let t=0;t<r;t++){let e=n[t>>>2]>>>24-t%4*8&255;o[t]=e}return o}function pc(t){return Xa(t)?sc(function(t){return Xa(t)?new Uint8Array(t):new Uint8Array}(t)):""}function dc(t){if(!sa(t))return new Uint16Array;let e=function(t){return Ka(t)?new Uint16Array(t):new Uint16Array}(vc(t));return e}let hc="[Uint8Array]::";let yc="[Uint16Array]::";let bc={tagU8A:hc,u8arr2b64:function(t){return Ka(t)?hc+sc(t):t},b642u8arr:function(t){return sa(t)&&Za(t,hc.length)===hc?vc(t=tc(t,hc.length)):t},tagU16A:yc,u16arr2b64:function(t){return Xa(t)?yc+pc(t):t},b642u16arr:function(t){return sa(t)&&Za(t,yc.length)===yc?dc(t=tc(t,yc.length)):t}};function gc(t){return"[object Array]"===Object.prototype.toString.call(t)}function jc(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(n=t,"[object Undefined]"===Object.prototype.toString.call(n))return"";var n;if(sa(e))e=[e];else if(!gc(e))return"";let r="";try{r=JSON.stringify(t,(function(t,n){return e.indexOf("Uint8Array")>=0&&(n=bc.u8arr2b64(n)),e.indexOf("Uint16Array")>=0&&(n=bc.u16arr2b64(n)),n}))}catch(t){r=""}return r}var wc=ka;var _c=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:wc(t,e,n)},mc=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Ac=function(t){return mc.test(t)},Oc=Q,xc=be;var Sc=function(t){return xc(t)&&"[object RegExp]"==Oc(t)},Bc=Fe,kc=Ne&&Ne.isRegExp,Uc=kc?Bc(kc):Sc;var Pc=function(t){return t.split("")},zc="\\ud800-\\udfff",Cc="["+zc+"]",Ec="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Mc="\\ud83c[\\udffb-\\udfff]",Ic="[^"+zc+"]",Tc="(?:\\ud83c[\\udde6-\\uddff]){2}",Dc="[\\ud800-\\udbff][\\udc00-\\udfff]",Fc="(?:"+Ec+"|"+Mc+")"+"?",Nc="[\\ufe0e\\ufe0f]?",Lc=Nc+Fc+("(?:\\u200d(?:"+[Ic,Tc,Dc].join("|")+")"+Nc+Fc+")*"),$c="(?:"+[Ic+Ec+"?",Ec,Tc,Dc,Cc].join("|")+")",Rc=RegExp(Mc+"(?="+Mc+")|"+$c+Lc,"g");var Qc=Pc,Gc=Ac,Wc=function(t){return t.match(Rc)||[]};var qc=ri,Vc=_c,Hc=Ac,Jc=Ea,Kc=Uc,Xc=function(t){return Gc(t)?Wc(t):Qc(t)},Yc=ii;var Zc=function(t,e,n){return n&&"number"!=typeof n&&Jc(t,e,n)&&(e=n=void 0),(n=void 0===n?4294967295:n>>>0)?(t=Yc(t))&&("string"==typeof e||null!=e&&!Kc(e))&&!(e=qc(e))&&Hc(t)?Vc(Xc(t),0,n):t.split(e,n):[]},tf=ka,ef=ca;var nf=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:ef(e),tf(t,e<0?0:e,r)):[]},rf=Math.ceil,of=Math.max;var uf=function(t,e,n,r){for(var o=-1,i=of(rf((e-t)/(n||1)),0),u=Array(i);i--;)u[r?i:++o]=t,t+=n;return u},af=Ea,cf=ua;var ff=function(t){return function(e,n,r){return r&&"number"!=typeof r&&af(e,n,r)&&(n=r=void 0),e=cf(e),void 0===n?(n=e,e=0):n=cf(n),r=void 0===r?e<n?1:-1:cf(r),uf(e,n,r,t)}}();function lf(t){return"[object Object]"===Object.prototype.toString.call(t)}let sf={};function vf(t,e){let n=Zc(t,"|"),r=n[0],o=ra(n[1]),i=ra(n[2]),u=$a(nf(n,3),"|");var a,c;if(c=r,lf(a=sf)&&(va(c)||pa(c))&&c in a||(sf[r]={}),sf[r]["_"+o]=u,o===i-1){let t="";Ja(ff(i),(function(e){t+=sf[r]["_"+e]})),delete sf[r];let n=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(sa(e))e=[e];else if(!gc(e))return{};let n={};try{n=JSON.parse(t,(function(t,n){return e.indexOf("Uint8Array")>=0&&(n=bc.b642u8arr(n)),e.indexOf("Uint16Array")>=0&&(n=bc.b642u16arr(n)),n}))}catch(t){n={}}return n}(t);e(n)}}function pf(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.port||(e.port=8080),e.strSplitLength||(e.strSplitLength=1e6);let n=new Ba;function r(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];setTimeout((()=>{n.emit(t,...r)}),1)}let o={port:e.port,perMessageDeflate:{zlibDeflateOptions:{chunkSize:1024,memLevel:7,level:3},zlibInflateOptions:{chunkSize:10240},clientNoContextTakeover:!0,serverNoContextTakeover:!0,serverMaxWindowBits:10,concurrencyLimit:10,threshold:1024}},i=null;try{i=new t.WebSocketServer(o)}catch(t){u({msg:"can not create websocket",err:t})}if(!i)return n;function u(t){r("error",t)}function a(){r("clientChange",c)}r("open");let c=[];return i.on("connection",(function(o,i){function f(n,r){o.readyState===t.OPEN&&function(t,e,n,r,o){let i=jc(n),u=Na(i,e),a=xa(),c=u.length;Ja(u,(function(e,n){e=$a(e,"");let i=`${a}|${n}|${c}|${e}`;t.send(i,(function(t){t&&H(o)&&o(t)})),H(r)&&r((n+1)/c*100)}))}(o,e.strSplitLength,n,r,(function(t){u({msg:"can not send message",err:t})}))}function l(t){let e=bi(t,"_mode","");if("execute"===e){r("execute",bi(t,"func",""),bi(t,"input"),(function(e){t.output=e,delete t.input,f(t,null)}),f)}else"broadcast"===e?r("broadcast",bi(t,"data")):"deliver"===e?r("deliver",bi(t,"data")):u({msg:"can not find _mode in data",err:t})}c.push(o),a(),o.on("close",(function(){c=c.filter((function(t){return t!==o})),a()})),o.sendData=f,o.on("message",(function(t){vf(t,l)})),n.on("triggerBroadcast",(function(t,e){f({_mode:"broadcast",data:t},e)}))})),n.broadcast=function(t){r("triggerBroadcast",t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){})},n}var df=hi,hf=ka;var yf=li,bf=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},gf=function(t,e){return e.length<2?t:df(t,hf(e,0,-1))},jf=vi;var wf=function(t,e){return e=yf(e,t),null==(t=gf(t,e))||delete t[jf(bf(e))]},_f=Q,mf=Ln,Af=be,Of=Function.prototype,xf=Object.prototype,Sf=Of.toString,Bf=xf.hasOwnProperty,kf=Sf.call(Object);var Uf=function(t){if(!Af(t)||"[object Object]"!=_f(t))return!1;var e=mf(t);if(null===e)return!0;var n=Bf.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Sf.call(n)==kf};var Pf=function(t){return Uf(t)?void 0:t},zf=Se,Cf=Be,Ef=C?C.isConcatSpreadable:void 0;var Mf=Nn,If=function(t){return Cf(t)||zf(t)||!!(Ef&&t&&t[Ef])};var Tf=function t(e,n,r,o,i){var u=-1,a=e.length;for(r||(r=If),i||(i=[]);++u<a;){var c=e[u];n>0&&r(c)?n>1?t(c,n-1,r,o,i):Mf(i,c):o||(i[i.length]=c)}return i},Df=Tf;var Ff=function(t){return(null==t?0:t.length)?Df(t,1):[]};var Nf=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Lf=Math.max;var $f=function(t,e,n){return e=Lf(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Lf(r.length-e,0),u=Array(i);++o<i;)u[o]=r[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=r[o];return a[e]=n(u),Nf(t,this,a)}};var Rf=function(t){return function(){return t}},Qf=ue,Gf=Qf?function(t,e){return Qf(t,"toString",{configurable:!0,enumerable:!1,value:Rf(e),writable:!0})}:Au,Wf=Date.now;var qf=function(t){var e=0,n=0;return function(){var r=Wf(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Vf=qf(Gf),Hf=Ff,Jf=$f,Kf=Vf;var Xf=Xo,Yf=Mo,Zf=wf,tl=li,el=he,nl=Pf,rl=ir,ol=function(t){return Kf(Jf(t,void 0,Hf),t+"")}((function(t,e){var n={};if(null==t)return n;var r=!1;e=Xf(e,(function(e){return e=tl(e,t),r||(r=e.length>1),e})),el(t,rl(t),n),r&&(n=Yf(n,7,nl));for(var o=e.length;o--;)Zf(n,e[o]);return n})),il=Q,ul=Be,al=be;var cl=function(t){return"string"==typeof t||!ul(t)&&al(t)&&"[object String]"==il(t)},fl=Ou("length"),ll="\\ud800-\\udfff",sl="["+ll+"]",vl="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",pl="\\ud83c[\\udffb-\\udfff]",dl="[^"+ll+"]",hl="(?:\\ud83c[\\udde6-\\uddff]){2}",yl="[\\ud800-\\udbff][\\udc00-\\udfff]",bl="(?:"+vl+"|"+pl+")"+"?",gl="[\\ufe0e\\ufe0f]?",jl=gl+bl+("(?:\\u200d(?:"+[dl,hl,yl].join("|")+")"+gl+bl+")*"),wl="(?:"+[dl+vl+"?",vl,hl,yl,sl].join("|")+")",_l=RegExp(pl+"(?="+pl+")|"+wl+jl,"g");var ml=fl,Al=Ac,Ol=function(t){for(var e=_l.lastIndex=0;_l.test(t);)++e;return e};var xl=un,Sl=Or,Bl=fn,kl=cl,Ul=function(t){return Al(t)?Ol(t):ml(t)};var Pl=function(t){if(null==t)return 0;if(Bl(t))return kl(t)?Ul(t):t.length;var e=Sl(t);return"[object Map]"==e||"[object Set]"==e?t.size:xl(t).length};function zl(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}function Cl(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function El(t,e){let n=zl();if(!gc(t)&&!lf(t))return n.reject("rs is not an array or object"),n;let r=!1;if(lf(t)){r=!0;let e=[];Ja(t,((t,n)=>{e.push({k:n,v:t})})),t=e}Cl(e)||(e=function(t){return t});let o=-1,i=[];return t.reduce((function(t,n){return t.then((function(t){i.push(t),o+=1;let u=o,a=n;return r&&(u=n.k,a=n.v),Cl(e)?e(a,u):a}))}),Promise.resolve()).then((function(t){i.push(t),i=nf(i),n.resolve(i)})).catch((function(t){n.reject(t)})),n}let Ml={useNewUrlParser:!0,useUnifiedTopology:!0};function Il(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.url||(t.url="mongodb://127.0.0.1:27017"),t.db||(t.db="worm"),t.cl||(t.cl="test");let o=new e.EventEmitter,i=n.MongoClient;async function u(e){let n=!1;e=To(e);let r=new i(t.url,Ml),u=null;try{let i=r.db(t.db).collection(t.cl);gc(e)||(e=[e]),e=qu(e,(function(t){return t.id||(t.id=xa()),t})),u=await i.insertMany(e),u.insertedCount>0?(u={n:Pl(e),nInserted:u.insertedCount,ok:u.acknowledged?1:0},o.emit("change","insert",e,u)):(n=!0,u="no insert data")}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u}async function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=!1,r=null;try{let n=e.find(t);r=await n.toArray()}catch(t){n=!0,r=t}return n?Promise.reject(r):r}return o.select=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,r=new i(t.url,Ml),o=null;try{let n=r.db(t.db).collection(t.cl).find(e);o=await n.toArray(),o=qu(o,(function(t){return t=ol(t,"_id")}))}catch(t){n=!0,o=t}finally{await r.close()}return n?Promise.reject(o):o},o.insert=u,o.save=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!1;e=To(e);let a=bi(n,"autoInsert",!0),c=bi(n,"atomic",!1),f=new i(t.url,Ml),l=null;try{let n=f.db(t.db).collection(t.cl);gc(e)||(e=[e]);let r=null;r=c?"findOneAndUpdate":"updateOne",l=await El(e,(async t=>{let e=null;return e=await n[r]({id:t.id},{$set:t}),e=e.lastErrorObject?{n:e.lastErrorObject.n,nModified:e.lastErrorObject.updatedExisting?1:0,ok:1}:{n:e.matchedCount,nModified:e.modifiedCount,ok:e.acknowledged?1:0},a&&0===e.n&&(e=await u(t)),e})),o.emit("change","save",e,l)}catch(t){r=!0,l=t}finally{await f.close()}return r?Promise.reject(l):l},o.del=async function(e){let n=!1;e=To(e);let r=new i(t.url,Ml),u=null;try{let n=r.db(t.db).collection(t.cl);gc(e)||(e=[e]),u=await El(e,(async t=>{let e=null;return e=await n.deleteOne({id:t.id}),e={n:e.deletedCount,nDeleted:e.deletedCount,ok:e.acknowledged?1:0},e})),o.emit("change","del",e,u)}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u},o.delAll=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,r=new i(t.url,Ml),u=null;try{let n=r.db(t.db).collection(t.cl);u=await n.deleteMany(e),u={n:u.deletedCount,nDeleted:u.deletedCount,ok:u.acknowledged?1:0},o.emit("change","delAll",null,u)}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u},o.selectGfs=async function(e){let r=!1,o=new i(t.url,Ml),u=null;try{u=await(async e=>{let r=zl(),i=o.db(t.db),u=new n.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:t.cl}),a=Buffer.from(""),c=u.openDownloadStreamByName(e);return c.on("data",(function(t){a=Buffer.concat([a,t])})),c.on("error",(function(t){r.reject(t)})),c.on("end",(function(){let t=new Uint8Array(a);a=null,r.resolve(t)})),r})(e)}catch(t){r=!0,u=t}finally{await o.close()}return r?Promise.reject(u):u},o.insertGfs=async function(e){let u=!1,a=xa(),c=Buffer.from(e),f=new i(t.url,Ml),l=null;try{l=await(async(e,o)=>{let i=zl(),u=f.db(t.db),a=new n.GridFSBucket(u,{chunkSizeBytes:10485760,bucketName:t.cl}),c=new r.Readable;return c._read=()=>{},c.push(o),c.push(null),c.pipe(a.openUploadStream(e)).on("error",(function(t){i.reject(t)})).on("finish",(function(){let t={n:1,ok:1,id:e};i.resolve(t)})),i})(a,c),o.emit("change","insertGfs",null,l)}catch(t){u=!0,l=t}finally{await f.close()}return u?Promise.reject(l):l},o.delGfs=async function(e){let r=!1,u=new i(t.url,Ml),c=null;try{let r=u.db(t.db),i=new n.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:t.cl});if(c=await a({filename:e},i),0===c.length)c=`can not find id[${e}]`;else if(c.length>1)c=`duplicate id[${e}]`;else{let t=c[0]._id;c=await i.delete(t),c={n:1,nDeleted:1,ok:1},o.emit("change","delGfs",null,c)}}catch(t){r=!0,c=t}finally{await u.close()}return r?Promise.reject(c):c},o.delAllGfs=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1,u=new i(t.url,Ml),c=null;try{let r=u.db(t.db),i=new n.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:t.cl});c=await a(e,i);let f=Pl(c),l=qu(c,(function(t){return async function(t,e){let n=!1,r=null;try{r=await e.delete(t),r={n:1,nDeleted:1,ok:1}}catch(t){n=!0,r=t}return n?Promise.reject(r):r}(t._id,i)}));c=await Promise.all(l),c={n:f,ok:1},o.emit("change","delAllGfs",null,c)}catch(t){r=!0,c=t}finally{await u.close()}return r?Promise.reject(c):c},o}return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=To(t),t.mongoUrl||(t.mongoUrl="mongodb://127.0.0.1:27017"),t.mongoDb||(t.mongoDb="wqws"),t.mongoCl||(t.mongoCl="queues"),t.port||(t.port=8080);let e=Il({url:t.mongoUrl,db:t.mongoDb,cl:t.mongoCl}),n=new pf(t);return n.on("execute",(async function(t,r,o,i){let u,a=bi(r,"topic",null);if("pushQueue"===t){let t=xa(),i=bi(r,"input",null),c=bi(r,"option"),f={topic:a,id:t,input:i,output:null,transData:bi(c,"transData",null),timeStart:bi(c,"timeStart",null),timeExp:bi(c,"timeExp",null),timeTakeStart:bi(c,"timeTakeStart",null),timeTakeExp:bi(c,"timeTakeExp",null),state:"ready"};await e.insert(f).then((function(e){n.emit(a,{topic:a,id:t,input:f.input,output:f.output,state:f.state}),u="success"})).catch((function(t){u={err:t}})),o(u)}else if("modifyQueue"===t){let t=bi(r,"id",null);if(null!==t){let o=bi(r,"input",null),i=bi(r,"output",null),c=bi(r,"state",null),f={id:t,output:i,state:c};await e.save(f,{atomic:!0}).then((function(e){n.emit(a,{topic:a,id:t,input:o,output:i,state:c}),u="success"})).catch((function(t){u={err:t}}))}else u={err:"can not find id"};o(u)}else if("subTopic"===t)n.deliverQueue=function(t){i({_mode:"deliver",data:t})},n.on(a,n.deliverQueue),u="success",o(u);else if("unsubTopic"===t)n.off(a,n.deliverQueue),n.deliverQueue=null,u="success",o(u);else if("delQueueByTopic"===t)await e.delAll({topic:a}).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u);else if("delQueueByID"===t){let t=bi(r,"id",null);null!==t?await e.delAll({id:t}).then((function(t){u="success"})).catch((function(t){u={err:t}})):u={err:"can not find id"},o(u)}else if("delQueueByIDs"===t){let t=bi(r,"ids",null),n=qu(t,(function(t){return e.delAll({id:t})}));await Promise.all(n).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u)}else if("delQueueByMatches"===t){let t=bi(r,"find",null);await e.delAll(t).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u)}else if("getQueueByTopic"===t)await e.select({topic:a}).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u);else if("getQueueByID"===t){let t=bi(r,"id",null);null!==t?await e.select({id:t}).then((function(t){u=t})).catch((function(t){u={err:t}})):u={err:"can not find id"},o(u)}else if("getQueueByIDs"===t){let t=bi(r,"ids",null),n=qu(t,(function(t){return e.select({id:t})}));await Promise.all(n).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u)}else if("getQueueByMatches"===t){let t=bi(r,"find",null);await e.select(t).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u)}})),n}}));
//# sourceMappingURL=w-runqws-server.umd.js.map
