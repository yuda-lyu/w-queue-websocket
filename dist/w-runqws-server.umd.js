/*!
 * w-runqws-server v1.0.16
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("ws"),require("events"),require("crypto-js/enc-base64"),require("crypto-js/lib-typedarrays"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","events","crypto-js/enc-base64","crypto-js/lib-typedarrays","mongodb","stream"],r):(t=t||self)["w-runqws-server"]=r(t.ws,t.events,t.encbase64,t.libwa,t.mongodb,t.stream)}(this,(function(t,r,e,n,o,u){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,u=u&&u.hasOwnProperty("default")?u.default:u;var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(t,r){return t(r={exports:{}},r.exports),r.exports}var f=c((function(t){var r=function(t){var r,e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},u=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function f(t,r,e,n){var o=r&&r.prototype instanceof b?r:b,u=Object.create(o.prototype),a=new E(n||[]);return u._invoke=function(t,r,e){var n=l;return function(o,u){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw u;return U()}for(e.method=o,e.arg=u;;){var a=e.delegate;if(a){var i=A(a,e);if(i){if(i===h)continue;return i}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===l)throw n=d,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=p;var c=s(t,r,e);if("normal"===c.type){if(n=e.done?d:v,c.arg===h)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n=d,e.method="throw",e.arg=c.arg)}}}(t,e,a),u}function s(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var l="suspendedStart",v="suspendedYield",p="executing",d="completed",h={};function b(){}function y(){}function g(){}var j={};j[u]=function(){return this};var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==e&&n.call(w,u)&&(j=w);var _=g.prototype=b.prototype=Object.create(j);function x(t){["next","throw","return"].forEach((function(r){t[r]=function(t){return this._invoke(r,t)}}))}function O(t){var r;this._invoke=function(e,o){function u(){return new Promise((function(r,u){!function r(e,o,u,i){var c=s(t[e],t,o);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"===a(l)&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(t){r("next",t,u,i)}),(function(t){r("throw",t,u,i)})):Promise.resolve(l).then((function(t){f.value=t,u(f)}),(function(t){return r("throw",t,u,i)}))}i(c.arg)}(e,o,r,u)}))}return r=r?r.then(u,u):u()}}function A(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,A(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var u=o.arg;return u?u.done?(e[t.resultName]=u.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,h):u:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function k(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function S(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function P(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(n.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}return{next:U}}function U(){return{value:r,done:!0}}return y.prototype=_.constructor=g,g.constructor=y,g[c]=y.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===y||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},x(O.prototype),O.prototype[i]=function(){return this},t.AsyncIterator=O,t.async=function(r,e,n,o){var u=new O(f(r,e,n,o));return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},x(_),_[c]="Generator",_[u]=function(){return this},_.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(n,o){return i.type="throw",i.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var u=this.tryEntries.length-1;u>=0;--u){var a=this.tryEntries[u],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),f=n.call(a,"finallyLoc");if(c&&f){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var u=o;break}}u&&("break"===t||"continue"===t)&&u.tryLoc<=r&&r<=u.finallyLoc&&(u=null);var a=u?u.completion:{};return a.type=t,a.arg=r,u?(this.method="next",this.next=u.finallyLoc,h):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),h},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),S(e),h}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;S(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),h}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}}));var s=function(){this.__data__=[],this.size=0};var l=function(t,r){return t===r||t!=t&&r!=r};var v=function(t,r){for(var e=t.length;e--;)if(l(t[e][0],r))return e;return-1},p=Array.prototype.splice;var d=function(t){var r=this.__data__,e=v(r,t);return!(e<0)&&(e==r.length-1?r.pop():p.call(r,e,1),--this.size,!0)};var h=function(t){var r=this.__data__,e=v(r,t);return e<0?void 0:r[e][1]};var b=function(t){return v(this.__data__,t)>-1};var y=function(t,r){var e=this.__data__,n=v(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function g(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}g.prototype.clear=s,g.prototype.delete=d,g.prototype.get=h,g.prototype.has=b,g.prototype.set=y;var j=g;var m=function(){this.__data__=new j,this.size=0};var w=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var _=function(t){return this.__data__.get(t)};var x=function(t){return this.__data__.has(t)},O="object"==a(i)&&i&&i.Object===Object&&i,A="object"==("undefined"==typeof self?"undefined":a(self))&&self&&self.Object===Object&&self,k=O||A||Function("return this")(),S=k.Symbol,E=Object.prototype,P=E.hasOwnProperty,U=E.toString,L=S?S.toStringTag:void 0;var B=function(t){var r=P.call(t,L),e=t[L];try{t[L]=void 0;var n=!0}catch(t){}var o=U.call(t);return n&&(r?t[L]=e:delete t[L]),o},R=Object.prototype.toString;var z=function(t){return R.call(t)},F="[object Null]",M="[object Undefined]",N=S?S.toStringTag:void 0;var T=function(t){return null==t?void 0===t?M:F:N&&N in Object(t)?B(t):z(t)};var D=function(t){var r=a(t);return null!=t&&("object"==r||"function"==r)},I="[object AsyncFunction]",G="[object Function]",C="[object GeneratorFunction]",$="[object Proxy]";var Q,q=function(t){if(!D(t))return!1;var r=T(t);return r==G||r==C||r==I||r==$},V=k["__core-js_shared__"],W=(Q=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"";var J=function(t){return!!W&&W in t},Y=Function.prototype.toString;var H=function(t){if(null!=t){try{return Y.call(t)}catch(t){}try{return t+""}catch(t){}}return""},K=/^\[object .+?Constructor\]$/,X=Function.prototype,Z=Object.prototype,tt=X.toString,rt=Z.hasOwnProperty,et=RegExp("^"+tt.call(rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nt=function(t){return!(!D(t)||J(t))&&(q(t)?et:K).test(H(t))};var ot=function(t,r){return null==t?void 0:t[r]};var ut=function(t,r){var e=ot(t,r);return nt(e)?e:void 0},at=ut(k,"Map"),it=ut(Object,"create");var ct=function(){this.__data__=it?it(null):{},this.size=0};var ft=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},st="__lodash_hash_undefined__",lt=Object.prototype.hasOwnProperty;var vt=function(t){var r=this.__data__;if(it){var e=r[t];return e===st?void 0:e}return lt.call(r,t)?r[t]:void 0},pt=Object.prototype.hasOwnProperty;var dt=function(t){var r=this.__data__;return it?void 0!==r[t]:pt.call(r,t)},ht="__lodash_hash_undefined__";var bt=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=it&&void 0===r?ht:r,this};function yt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}yt.prototype.clear=ct,yt.prototype.delete=ft,yt.prototype.get=vt,yt.prototype.has=dt,yt.prototype.set=bt;var gt=yt;var jt=function(){this.size=0,this.__data__={hash:new gt,map:new(at||j),string:new gt}};var mt=function(t){var r=a(t);return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var wt=function(t,r){var e=t.__data__;return mt(r)?e["string"==typeof r?"string":"hash"]:e.map};var _t=function(t){var r=wt(this,t).delete(t);return this.size-=r?1:0,r};var xt=function(t){return wt(this,t).get(t)};var Ot=function(t){return wt(this,t).has(t)};var At=function(t,r){var e=wt(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function kt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}kt.prototype.clear=jt,kt.prototype.delete=_t,kt.prototype.get=xt,kt.prototype.has=Ot,kt.prototype.set=At;var St=kt,Et=200;var Pt=function(t,r){var e=this.__data__;if(e instanceof j){var n=e.__data__;if(!at||n.length<Et-1)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new St(n)}return e.set(t,r),this.size=e.size,this};function Ut(t){var r=this.__data__=new j(t);this.size=r.size}Ut.prototype.clear=m,Ut.prototype.delete=w,Ut.prototype.get=_,Ut.prototype.has=x,Ut.prototype.set=Pt;var Lt=Ut;var Bt=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t},Rt=function(){try{var t=ut(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var zt=function(t,r,e){"__proto__"==r&&Rt?Rt(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},Ft=Object.prototype.hasOwnProperty;var Mt=function(t,r,e){var n=t[r];Ft.call(t,r)&&l(n,e)&&(void 0!==e||r in t)||zt(t,r,e)};var Nt=function(t,r,e,n){var o=!e;e||(e={});for(var u=-1,a=r.length;++u<a;){var i=r[u],c=n?n(e[i],t[i],i,e,t):void 0;void 0===c&&(c=t[i]),o?zt(e,i,c):Mt(e,i,c)}return e};var Tt=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Dt=function(t){return null!=t&&"object"==a(t)},It="[object Arguments]";var Gt=function(t){return Dt(t)&&T(t)==It},Ct=Object.prototype,$t=Ct.hasOwnProperty,Qt=Ct.propertyIsEnumerable,qt=Gt(function(){return arguments}())?Gt:function(t){return Dt(t)&&$t.call(t,"callee")&&!Qt.call(t,"callee")},Vt=Array.isArray;var Wt=function(){return!1},Jt=c((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?k.Buffer:void 0,u=(o?o.isBuffer:void 0)||Wt;t.exports=u})),Yt=9007199254740991,Ht=/^(?:0|[1-9]\d*)$/;var Kt=function(t,r){var e=a(t);return!!(r=null==r?Yt:r)&&("number"==e||"symbol"!=e&&Ht.test(t))&&t>-1&&t%1==0&&t<r},Xt=9007199254740991;var Zt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Xt},tr={};tr["[object Float32Array]"]=tr["[object Float64Array]"]=tr["[object Int8Array]"]=tr["[object Int16Array]"]=tr["[object Int32Array]"]=tr["[object Uint8Array]"]=tr["[object Uint8ClampedArray]"]=tr["[object Uint16Array]"]=tr["[object Uint32Array]"]=!0,tr["[object Arguments]"]=tr["[object Array]"]=tr["[object ArrayBuffer]"]=tr["[object Boolean]"]=tr["[object DataView]"]=tr["[object Date]"]=tr["[object Error]"]=tr["[object Function]"]=tr["[object Map]"]=tr["[object Number]"]=tr["[object Object]"]=tr["[object RegExp]"]=tr["[object Set]"]=tr["[object String]"]=tr["[object WeakMap]"]=!1;var rr=function(t){return Dt(t)&&Zt(t.length)&&!!tr[T(t)]};var er=function(t){return function(r){return t(r)}},nr=c((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&O.process,u=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=u})),or=nr&&nr.isTypedArray,ur=or?er(or):rr,ar=Object.prototype.hasOwnProperty;var ir=function(t,r){var e=Vt(t),n=!e&&qt(t),o=!e&&!n&&Jt(t),u=!e&&!n&&!o&&ur(t),a=e||n||o||u,i=a?Tt(t.length,String):[],c=i.length;for(var f in t)!r&&!ar.call(t,f)||a&&("length"==f||o&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Kt(f,c))||i.push(f);return i},cr=Object.prototype;var fr=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||cr)};var sr=function(t,r){return function(e){return t(r(e))}},lr=sr(Object.keys,Object),vr=Object.prototype.hasOwnProperty;var pr=function(t){if(!fr(t))return lr(t);var r=[];for(var e in Object(t))vr.call(t,e)&&"constructor"!=e&&r.push(e);return r};var dr=function(t){return null!=t&&Zt(t.length)&&!q(t)};var hr=function(t){return dr(t)?ir(t):pr(t)};var br=function(t,r){return t&&Nt(r,hr(r),t)};var yr=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},gr=Object.prototype.hasOwnProperty;var jr=function(t){if(!D(t))return yr(t);var r=fr(t),e=[];for(var n in t)("constructor"!=n||!r&&gr.call(t,n))&&e.push(n);return e};var mr=function(t){return dr(t)?ir(t,!0):jr(t)};var wr=function(t,r){return t&&Nt(r,mr(r),t)},_r=c((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?k.Buffer:void 0,u=o?o.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var e=t.length,n=u?u(e):new t.constructor(e);return t.copy(n),n}}));var xr=function(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r};var Or=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,u=[];++e<n;){var a=t[e];r(a,e,t)&&(u[o++]=a)}return u};var Ar=function(){return[]},kr=Object.prototype.propertyIsEnumerable,Sr=Object.getOwnPropertySymbols,Er=Sr?function(t){return null==t?[]:(t=Object(t),Or(Sr(t),(function(r){return kr.call(t,r)})))}:Ar;var Pr=function(t,r){return Nt(t,Er(t),r)};var Ur=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},Lr=sr(Object.getPrototypeOf,Object),Br=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)Ur(r,Er(t)),t=Lr(t);return r}:Ar;var Rr=function(t,r){return Nt(t,Br(t),r)};var zr=function(t,r,e){var n=r(t);return Vt(t)?n:Ur(n,e(t))};var Fr=function(t){return zr(t,hr,Er)};var Mr=function(t){return zr(t,mr,Br)},Nr=ut(k,"DataView"),Tr=ut(k,"Promise"),Dr=ut(k,"Set"),Ir=ut(k,"WeakMap"),Gr=H(Nr),Cr=H(at),$r=H(Tr),Qr=H(Dr),qr=H(Ir),Vr=T;(Nr&&"[object DataView]"!=Vr(new Nr(new ArrayBuffer(1)))||at&&"[object Map]"!=Vr(new at)||Tr&&"[object Promise]"!=Vr(Tr.resolve())||Dr&&"[object Set]"!=Vr(new Dr)||Ir&&"[object WeakMap]"!=Vr(new Ir))&&(Vr=function(t){var r=T(t),e="[object Object]"==r?t.constructor:void 0,n=e?H(e):"";if(n)switch(n){case Gr:return"[object DataView]";case Cr:return"[object Map]";case $r:return"[object Promise]";case Qr:return"[object Set]";case qr:return"[object WeakMap]"}return r});var Wr=Vr,Jr=Object.prototype.hasOwnProperty;var Yr=function(t){var r=t.length,e=new t.constructor(r);return r&&"string"==typeof t[0]&&Jr.call(t,"index")&&(e.index=t.index,e.input=t.input),e},Hr=k.Uint8Array;var Kr=function(t){var r=new t.constructor(t.byteLength);return new Hr(r).set(new Hr(t)),r};var Xr=function(t,r){var e=r?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)},Zr=/\w*$/;var te=function(t){var r=new t.constructor(t.source,Zr.exec(t));return r.lastIndex=t.lastIndex,r},re=S?S.prototype:void 0,ee=re?re.valueOf:void 0;var ne=function(t){return ee?Object(ee.call(t)):{}};var oe=function(t,r){var e=r?Kr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)},ue="[object Boolean]",ae="[object Date]",ie="[object Map]",ce="[object Number]",fe="[object RegExp]",se="[object Set]",le="[object String]",ve="[object Symbol]",pe="[object ArrayBuffer]",de="[object DataView]",he="[object Float32Array]",be="[object Float64Array]",ye="[object Int8Array]",ge="[object Int16Array]",je="[object Int32Array]",me="[object Uint8Array]",we="[object Uint8ClampedArray]",_e="[object Uint16Array]",xe="[object Uint32Array]";var Oe=function(t,r,e){var n=t.constructor;switch(r){case pe:return Kr(t);case ue:case ae:return new n(+t);case de:return Xr(t,e);case he:case be:case ye:case ge:case je:case me:case we:case _e:case xe:return oe(t,e);case ie:return new n;case ce:case le:return new n(t);case fe:return te(t);case se:return new n;case ve:return ne(t)}},Ae=Object.create,ke=function(){function t(){}return function(r){if(!D(r))return{};if(Ae)return Ae(r);t.prototype=r;var e=new t;return t.prototype=void 0,e}}();var Se=function(t){return"function"!=typeof t.constructor||fr(t)?{}:ke(Lr(t))},Ee="[object Map]";var Pe=function(t){return Dt(t)&&Wr(t)==Ee},Ue=nr&&nr.isMap,Le=Ue?er(Ue):Pe,Be="[object Set]";var Re=function(t){return Dt(t)&&Wr(t)==Be},ze=nr&&nr.isSet,Fe=ze?er(ze):Re,Me=1,Ne=2,Te=4,De="[object Arguments]",Ie="[object Function]",Ge="[object GeneratorFunction]",Ce="[object Object]",$e={};$e[De]=$e["[object Array]"]=$e["[object ArrayBuffer]"]=$e["[object DataView]"]=$e["[object Boolean]"]=$e["[object Date]"]=$e["[object Float32Array]"]=$e["[object Float64Array]"]=$e["[object Int8Array]"]=$e["[object Int16Array]"]=$e["[object Int32Array]"]=$e["[object Map]"]=$e["[object Number]"]=$e[Ce]=$e["[object RegExp]"]=$e["[object Set]"]=$e["[object String]"]=$e["[object Symbol]"]=$e["[object Uint8Array]"]=$e["[object Uint8ClampedArray]"]=$e["[object Uint16Array]"]=$e["[object Uint32Array]"]=!0,$e["[object Error]"]=$e[Ie]=$e["[object WeakMap]"]=!1;var Qe=function t(r,e,n,o,u,a){var i,c=e&Me,f=e&Ne,s=e&Te;if(n&&(i=u?n(r,o,u,a):n(r)),void 0!==i)return i;if(!D(r))return r;var l=Vt(r);if(l){if(i=Yr(r),!c)return xr(r,i)}else{var v=Wr(r),p=v==Ie||v==Ge;if(Jt(r))return _r(r,c);if(v==Ce||v==De||p&&!u){if(i=f||p?{}:Se(r),!c)return f?Rr(r,wr(i,r)):Pr(r,br(i,r))}else{if(!$e[v])return u?r:{};i=Oe(r,v,c)}}a||(a=new Lt);var d=a.get(r);if(d)return d;a.set(r,i),Fe(r)?r.forEach((function(o){i.add(t(o,e,n,o,r,a))})):Le(r)&&r.forEach((function(o,u){i.set(u,t(o,e,n,u,r,a))}));var h=s?f?Mr:Fr:f?keysIn:hr,b=l?void 0:h(r);return Bt(b||r,(function(o,u){b&&(o=r[u=o]),Mt(i,u,t(o,e,n,u,r,a))})),i},qe=1,Ve=4;var We=function(t){return Qe(t,qe|Ve)},Je="[object Symbol]";var Ye=function(t){return"symbol"==a(t)||Dt(t)&&T(t)==Je},He=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ke=/^\w*$/;var Xe=function(t,r){if(Vt(t))return!1;var e=a(t);return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!Ye(t))||(Ke.test(t)||!He.test(t)||null!=r&&t in Object(r))},Ze="Expected a function";function tn(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(Ze);var e=function e(){var n=arguments,o=r?r.apply(this,n):n[0],u=e.cache;if(u.has(o))return u.get(o);var a=t.apply(this,n);return e.cache=u.set(o,a)||u,a};return e.cache=new(tn.Cache||St),e}tn.Cache=St;var rn=tn,en=500;var nn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,on=/\\(\\)?/g,un=function(t){var r=rn(t,(function(t){return e.size===en&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(nn,(function(t,e,n,o){r.push(n?o.replace(on,"$1"):e||t)})),r}));var an=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},cn=1/0,fn=S?S.prototype:void 0,sn=fn?fn.toString:void 0;var ln=function t(r){if("string"==typeof r)return r;if(Vt(r))return an(r,t)+"";if(Ye(r))return sn?sn.call(r):"";var e=r+"";return"0"==e&&1/r==-cn?"-0":e};var vn=function(t){return null==t?"":ln(t)};var pn=function(t,r){return Vt(t)?t:Xe(t,r)?[t]:un(vn(t))},dn=1/0;var hn=function(t){if("string"==typeof t||Ye(t))return t;var r=t+"";return"0"==r&&1/t==-dn?"-0":r};var bn=function(t,r){for(var e=0,n=(r=pn(r,t)).length;null!=t&&e<n;)t=t[hn(r[e++])];return e&&e==n?t:void 0};var yn=function(t,r,e){var n=null==t?void 0:bn(t,r);return void 0===n?e:n},gn="__lodash_hash_undefined__";var jn=function(t){return this.__data__.set(t,gn),this};var mn=function(t){return this.__data__.has(t)};function wn(t){var r=-1,e=null==t?0:t.length;for(this.__data__=new St;++r<e;)this.add(t[r])}wn.prototype.add=wn.prototype.push=jn,wn.prototype.has=mn;var _n=wn;var xn=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n;)if(r(t[e],e,t))return!0;return!1};var On=function(t,r){return t.has(r)},An=1,kn=2;var Sn=function(t,r,e,n,o,u){var a=e&An,i=t.length,c=r.length;if(i!=c&&!(a&&c>i))return!1;var f=u.get(t);if(f&&u.get(r))return f==r;var s=-1,l=!0,v=e&kn?new _n:void 0;for(u.set(t,r),u.set(r,t);++s<i;){var p=t[s],d=r[s];if(n)var h=a?n(d,p,s,r,t,u):n(p,d,s,t,r,u);if(void 0!==h){if(h)continue;l=!1;break}if(v){if(!xn(r,(function(t,r){if(!On(v,r)&&(p===t||o(p,t,e,n,u)))return v.push(r)}))){l=!1;break}}else if(p!==d&&!o(p,d,e,n,u)){l=!1;break}}return u.delete(t),u.delete(r),l};var En=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t,n){e[++r]=[n,t]})),e};var Pn=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t){e[++r]=t})),e},Un=1,Ln=2,Bn="[object Boolean]",Rn="[object Date]",zn="[object Error]",Fn="[object Map]",Mn="[object Number]",Nn="[object RegExp]",Tn="[object Set]",Dn="[object String]",In="[object Symbol]",Gn="[object ArrayBuffer]",Cn="[object DataView]",$n=S?S.prototype:void 0,Qn=$n?$n.valueOf:void 0;var qn=function(t,r,e,n,o,u,a){switch(e){case Cn:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case Gn:return!(t.byteLength!=r.byteLength||!u(new Hr(t),new Hr(r)));case Bn:case Rn:case Mn:return l(+t,+r);case zn:return t.name==r.name&&t.message==r.message;case Nn:case Dn:return t==r+"";case Fn:var i=En;case Tn:var c=n&Un;if(i||(i=Pn),t.size!=r.size&&!c)return!1;var f=a.get(t);if(f)return f==r;n|=Ln,a.set(t,r);var s=Sn(i(t),i(r),n,o,u,a);return a.delete(t),s;case In:if(Qn)return Qn.call(t)==Qn.call(r)}return!1},Vn=1,Wn=Object.prototype.hasOwnProperty;var Jn=function(t,r,e,n,o,u){var a=e&Vn,i=Fr(t),c=i.length;if(c!=Fr(r).length&&!a)return!1;for(var f=c;f--;){var s=i[f];if(!(a?s in r:Wn.call(r,s)))return!1}var l=u.get(t);if(l&&u.get(r))return l==r;var v=!0;u.set(t,r),u.set(r,t);for(var p=a;++f<c;){var d=t[s=i[f]],h=r[s];if(n)var b=a?n(h,d,s,r,t,u):n(d,h,s,t,r,u);if(!(void 0===b?d===h||o(d,h,e,n,u):b)){v=!1;break}p||(p="constructor"==s)}if(v&&!p){var y=t.constructor,g=r.constructor;y!=g&&"constructor"in t&&"constructor"in r&&!("function"==typeof y&&y instanceof y&&"function"==typeof g&&g instanceof g)&&(v=!1)}return u.delete(t),u.delete(r),v},Yn=1,Hn="[object Arguments]",Kn="[object Array]",Xn="[object Object]",Zn=Object.prototype.hasOwnProperty;var to=function(t,r,e,n,o,u){var a=Vt(t),i=Vt(r),c=a?Kn:Wr(t),f=i?Kn:Wr(r),s=(c=c==Hn?Xn:c)==Xn,l=(f=f==Hn?Xn:f)==Xn,v=c==f;if(v&&Jt(t)){if(!Jt(r))return!1;a=!0,s=!1}if(v&&!s)return u||(u=new Lt),a||ur(t)?Sn(t,r,e,n,o,u):qn(t,r,c,e,n,o,u);if(!(e&Yn)){var p=s&&Zn.call(t,"__wrapped__"),d=l&&Zn.call(r,"__wrapped__");if(p||d){var h=p?t.value():t,b=d?r.value():r;return u||(u=new Lt),o(h,b,e,n,u)}}return!!v&&(u||(u=new Lt),Jn(t,r,e,n,o,u))};var ro=function t(r,e,n,o,u){return r===e||(null==r||null==e||!Dt(r)&&!Dt(e)?r!=r&&e!=e:to(r,e,n,o,t,u))},eo=1,no=2;var oo=function(t,r,e,n){var o=e.length,u=o,a=!n;if(null==t)return!u;for(t=Object(t);o--;){var i=e[o];if(a&&i[2]?i[1]!==t[i[0]]:!(i[0]in t))return!1}for(;++o<u;){var c=(i=e[o])[0],f=t[c],s=i[1];if(a&&i[2]){if(void 0===f&&!(c in t))return!1}else{var l=new Lt;if(n)var v=n(f,s,c,t,r,l);if(!(void 0===v?ro(s,f,eo|no,n,l):v))return!1}}return!0};var uo=function(t){return t==t&&!D(t)};var ao=function(t){for(var r=hr(t),e=r.length;e--;){var n=r[e],o=t[n];r[e]=[n,o,uo(o)]}return r};var io=function(t,r){return function(e){return null!=e&&(e[t]===r&&(void 0!==r||t in Object(e)))}};var co=function(t){var r=ao(t);return 1==r.length&&r[0][2]?io(r[0][0],r[0][1]):function(e){return e===t||oo(e,t,r)}};var fo=function(t,r){return null!=t&&r in Object(t)};var so=function(t,r,e){for(var n=-1,o=(r=pn(r,t)).length,u=!1;++n<o;){var a=hn(r[n]);if(!(u=null!=t&&e(t,a)))break;t=t[a]}return u||++n!=o?u:!!(o=null==t?0:t.length)&&Zt(o)&&Kt(a,o)&&(Vt(t)||qt(t))};var lo=function(t,r){return null!=t&&so(t,r,fo)},vo=1,po=2;var ho=function(t,r){return Xe(t)&&uo(r)?io(hn(t),r):function(e){var n=yn(e,t);return void 0===n&&n===r?lo(e,t):ro(r,n,vo|po)}};var bo=function(t){return t};var yo=function(t){return function(r){return null==r?void 0:r[t]}};var go=function(t){return function(r){return bn(r,t)}};var jo=function(t){return Xe(t)?yo(hn(t)):go(t)};var mo=function(t){return"function"==typeof t?t:null==t?bo:"object"==a(t)?Vt(t)?ho(t[0],t[1]):co(t):jo(t)};var wo=function(t){return function(r,e,n){for(var o=-1,u=Object(r),a=n(r),i=a.length;i--;){var c=a[t?i:++o];if(!1===e(u[c],c,u))break}return r}}();var _o=function(t,r){return function(e,n){if(null==e)return e;if(!dr(e))return t(e,n);for(var o=e.length,u=r?o:-1,a=Object(e);(r?u--:++u<o)&&!1!==n(a[u],u,a););return e}}((function(t,r){return t&&wo(t,r,hr)}));var xo=function(t,r){var e=-1,n=dr(t)?Array(t.length):[];return _o(t,(function(t,o,u){n[++e]=r(t,o,u)})),n};var Oo=function(t,r){return(Vt(t)?an:xo)(t,mo(r))},Ao=NaN,ko=/^\s+|\s+$/g,So=/^[-+]0x[0-9a-f]+$/i,Eo=/^0b[01]+$/i,Po=/^0o[0-7]+$/i,Uo=parseInt;var Lo=function(t){if("number"==typeof t)return t;if(Ye(t))return Ao;if(D(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=D(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(ko,"");var e=Eo.test(t);return e||Po.test(t)?Uo(t.slice(2),e?2:8):So.test(t)?Ao:+t},Bo=1/0,Ro=17976931348623157e292;var zo=function(t){return t?(t=Lo(t))===Bo||t===-Bo?(t<0?-1:1)*Ro:t==t?t:0:0===t?t:0};var Fo=function(t){var r=zo(t),e=r%1;return r==r?e?r-e:r:0};var Mo=function(t){return"number"==typeof t&&t==Fo(t)};function No(t){return"[object String]"===Object.prototype.toString.call(t)}function To(t){return!(!No(t)||""===t)}function Do(t){var r=!1;return To(t)?r=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(r=!0),r}function Io(t){return Do(t)?zo(t):0}var Go=k.isFinite,Co=Math.min;var $o=function(t){var r=Math[t];return function(t,e){if(t=Lo(t),(e=null==e?0:Co(Fo(e),292))&&Go(t)){var n=(vn(t)+"e").split("e"),o=r(n[0]+"e"+(+n[1]+e));return+((n=(vn(o)+"e").split("e"))[0]+"e"+(+n[1]-e))}return r(t)}}("round");function Qo(t){return!!function(t){return!!Do(t)&&(t=Io(t),Mo(t))}(t)&&function(t){if(!Do(t))return 0;t=Io(t);var r=$o(t);return"0"===String(r)?0:r}(t)>0}function qo(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],o=e.length;if(Qo(r))for(t=0;t<r;t++)n[t]=e[0|Math.random()*o];else{if("rfc4122"!==r)return"";var u;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(u=0|16*Math.random(),n[t]=e[19===t?3&u|8:u])}return n.join("")}function Vo(){var t,r,e=new Promise((function(){t=arguments[0],r=arguments[1]}));return e.resolve=t,e.reject=r,e}var Wo=function(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var u=Array(o);++n<o;)u[n]=t[n+r];return u};var Jo=function(t,r,e){var n=t.length;return e=void 0===e?n:e,!r&&e>=n?t:Wo(t,r,e)},Yo=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Ho=function(t){return Yo.test(t)};var Ko=function(t,r,e){if(!D(e))return!1;var n=a(r);return!!("number"==n?dr(e)&&Kt(r,e.length):"string"==n&&r in e)&&l(e[r],t)},Xo="[object RegExp]";var Zo=function(t){return Dt(t)&&T(t)==Xo},tu=nr&&nr.isRegExp,ru=tu?er(tu):Zo;var eu=function(t){return t.split("")},nu="[\\ud800-\\udfff]",ou="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",uu="\\ud83c[\\udffb-\\udfff]",au="[^\\ud800-\\udfff]",iu="(?:\\ud83c[\\udde6-\\uddff]){2}",cu="[\\ud800-\\udbff][\\udc00-\\udfff]",fu="(?:"+ou+"|"+uu+")"+"?",su="[\\ufe0e\\ufe0f]?"+fu+("(?:\\u200d(?:"+[au,iu,cu].join("|")+")[\\ufe0e\\ufe0f]?"+fu+")*"),lu="(?:"+[au+ou+"?",ou,iu,cu,nu].join("|")+")",vu=RegExp(uu+"(?="+uu+")|"+lu+su,"g");var pu=function(t){return t.match(vu)||[]};var du=function(t){return Ho(t)?pu(t):eu(t)},hu=4294967295;var bu=function(t,r,e){return e&&"number"!=typeof e&&Ko(t,r,e)&&(r=e=void 0),(e=void 0===e?hu:e>>>0)?(t=vn(t))&&("string"==typeof r||null!=r&&!ru(r))&&!(r=ln(r))&&Ho(t)?Jo(du(t),0,e):t.split(r,e):[]};var yu=function(t){for(var r=-1,e=null==t?0:t.length,n={};++r<e;){var o=t[r];n[o[0]]=o[1]}return n};function gu(t){return"[object Object]"===Object.prototype.toString.call(t)}function ju(t,r){return function(t){if(gu(t)){for(var r in t)return!0;return!1}return!1}(t)&&To(r)?yn(t,r,""):""}function mu(t,r){var e,n=ju(t,r);return n=To(e=n)||Do(e)?String(e):""}function wu(t){var r=Object.prototype.toString.call(t);return"[object Function]"===r||"[object AsyncFunction]"===r}var _u=Math.ceil,xu=Math.max;var Ou=function(t,r,e){r=(e?Ko(t,r,e):void 0===r)?1:xu(Fo(r),0);var n=null==t?0:t.length;if(!n||r<1)return[];for(var o=0,u=0,a=Array(_u(n/r));o<n;)a[u++]=Wo(t,o,o+=r);return a},Au=Array.prototype.join;var ku=function(t,r){return null==t?"":Au.call(t,r)};var Su=function(t){return"function"==typeof t?t:bo};var Eu=function(t,r){return(Vt(t)?Bt:_o)(t,Su(r))};function Pu(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function Uu(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function Lu(t,r){return To(t)&&Qo(r)?t.substr(0,r):""}function Bu(t,r){return To(t)&&Qo(r)?function(t,r){if(!To(t))return"";if(!Qo(r))return"";var e=t.length-r;return e<0&&(e=0),t.substr(e,r)}(t,t.length-r):""}function Ru(t){return Pu(t)?n.create(t).toString(e):""}function zu(t){if(!No(t))return new Uint8Array;for(var r=e.parse(t),n=r.words,o=r.sigBytes,u=new Uint8Array(o),a=0;a<o;a++){var i=n[a>>>2]>>>24-a%4*8&255;u[a]=i}return u}function Fu(t){return Uu(t)?Ru(function(t){return Uu(t)?new Uint8Array(t):new Uint8Array}(t)):""}function Mu(t){return No(t)?function(t){return Pu(t)?new Uint16Array(t):new Uint16Array}(zu(t)):new Uint16Array}var Nu="[Uint8Array]::";var Tu="[Uint16Array]::";var Du={tagU8A:Nu,u8arr2b64:function(t){return Pu(t)?Nu+Ru(t):t},b642u8arr:function(t){return No(t)&&Lu(t,Nu.length)===Nu?zu(t=Bu(t,Nu.length)):t},tagU16A:Tu,u16arr2b64:function(t){return Uu(t)?Tu+Fu(t):t},b642u16arr:function(t){return No(t)&&Lu(t,Tu.length)===Tu?Mu(t=Bu(t,Tu.length)):t}};function Iu(t){return"[object Array]"===Object.prototype.toString.call(t)}function Gu(t){var r,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(r=t,"[object Undefined]"===Object.prototype.toString.call(r))return"";if(No(e))e=[e];else if(!Iu(e))return"";var n="";try{n=JSON.stringify(t,(function(t,r){return e.indexOf("Uint8Array")>=0&&(r=Du.u8arr2b64(r)),e.indexOf("Uint16Array")>=0&&(r=Du.u16arr2b64(r)),r}))}catch(t){n=""}return n}var Cu=function(t,r,e){var n=null==t?0:t.length;return n?(r=e||void 0===r?1:Fo(r),Wo(t,r<0?0:r,n)):[]},$u=Math.ceil,Qu=Math.max;var qu=function(t,r,e,n){for(var o=-1,u=Qu($u((r-t)/(e||1)),0),a=Array(u);u--;)a[n?u:++o]=t,t+=e;return a};var Vu=function(t){return function(r,e,n){return n&&"number"!=typeof n&&Ko(r,e,n)&&(e=n=void 0),r=zo(r),void 0===e?(e=r,r=0):e=zo(e),n=void 0===n?r<e?1:-1:zo(n),qu(r,e,n,t)}}();var Wu={};function Ju(t,r){var e,n,o=bu(t,"|"),u=o[0],a=Lo(o[1]),i=Lo(o[2]),c=ku(Cu(o,3),"|");if(n=u,gu(e=Wu)&&To(n)&&n in e||(Wu[u]={}),Wu[u]["_"+a]=c,a===i-1){var f="";Eu(Vu(i),(function(t){f+=Wu[u]["_"+t]})),delete Wu[u],r(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(No(r))r=[r];else if(!Iu(r))return{};var e={};try{e=JSON.parse(t,(function(t,e){return r.indexOf("Uint8Array")>=0&&(e=Du.b642u8arr(e)),r.indexOf("Uint16Array")>=0&&(e=Du.b642u16arr(e)),e}))}catch(t){e={}}return e}(f))}}function Yu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.port||(e.port=8080),e.strSplitLength||(e.strSplitLength=1e6);var n=new r.EventEmitter;function o(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];setTimeout((function(){n.emit.apply(n,[t].concat(e))}),1)}var u=t.Server;var a={port:e.port,verifyClient:function(t,r){(function(t){var r=Vo();return wu(e.authenticate)?e.authenticate(t).then((function(t){r.resolve(t)})):r.resolve(!0),r})(mu(function(t){if(!To(t))return{};if(t=bu(t,"?"),!To(t=yn(t,"[1]")))return{};var r=bu(t,"&");return r=Oo(r,(function(t){return bu(t,"=")})),r=yu(r)}(t.req.url),"token")).then((function(t){r(t)}))}},i=null;try{i=new u(a)}catch(t){c({msg:"can not create websocket",err:t})}if(!i)return n;function c(t){o("error",t)}function f(){o("clientChange",s)}o("open");var s=[];return i.on("connection",(function(r,u){function a(n,o){r.readyState===t.OPEN&&function(t,r,e,n,o){var u=Gu(e),a=Ou(u,r),i=qo(),c=a.length;Eu(a,(function(r,e){r=ku(r,"");var u="".concat(i,"|").concat(e,"|").concat(c,"|").concat(r);t.send(u,(function(t){t&&q(o)&&o(t)})),q(n)&&n((e+1)/c*100)}))}(r,e.strSplitLength,n,o,(function(t){c({msg:"can not send message",err:t})}))}function i(t){var r=mu(t,"_mode");"execute"===r?o("execute",mu(t,"func"),yn(t,"input"),(function(r){t.output=r,delete t.input,a(t,null)}),a):"broadcast"===r?o("broadcast",yn(t,"data")):"deliver"===r?o("deliver",yn(t,"data")):c({msg:"can not find _mode in data",err:t})}s.push(r),f(),r.on("close",(function(){s=s.filter((function(t){return t!==r})),f()})),r.sendData=a,r.on("message",(function(t){Ju(t,i)})),n.on("triggerBroadcast",(function(t,r){a({_mode:"broadcast",data:t},r)}))})),n.broadcast=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};o("triggerBroadcast",t,r)},n}var Hu=function(t){var r=null==t?0:t.length;return r?t[r-1]:void 0};var Ku=function(t,r){return r.length<2?t:bn(t,Wo(r,0,-1))};var Xu=function(t,r){return r=pn(r,t),null==(t=Ku(t,r))||delete t[hn(Hu(r))]},Zu="[object Object]",ta=Function.prototype,ra=Object.prototype,ea=ta.toString,na=ra.hasOwnProperty,oa=ea.call(Object);var ua=function(t){if(!Dt(t)||T(t)!=Zu)return!1;var r=Lr(t);if(null===r)return!0;var e=na.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&ea.call(e)==oa};var aa=function(t){return ua(t)?void 0:t},ia=S?S.isConcatSpreadable:void 0;var ca=function(t){return Vt(t)||qt(t)||!!(ia&&t&&t[ia])};var fa=function t(r,e,n,o,u){var a=-1,i=r.length;for(n||(n=ca),u||(u=[]);++a<i;){var c=r[a];e>0&&n(c)?e>1?t(c,e-1,n,o,u):Ur(u,c):o||(u[u.length]=c)}return u};var sa=function(t){return(null==t?0:t.length)?fa(t,1):[]};var la=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},va=Math.max;var pa=function(t,r,e){return r=va(void 0===r?t.length-1:r,0),function(){for(var n=arguments,o=-1,u=va(n.length-r,0),a=Array(u);++o<u;)a[o]=n[r+o];o=-1;for(var i=Array(r+1);++o<r;)i[o]=n[o];return i[r]=e(a),la(t,this,i)}};var da=function(t){return function(){return t}},ha=Rt?function(t,r){return Rt(t,"toString",{configurable:!0,enumerable:!1,value:da(r),writable:!0})}:bo,ba=800,ya=16,ga=Date.now;var ja=function(t){var r=0,e=0;return function(){var n=ga(),o=ya-(n-e);if(e=n,o>0){if(++r>=ba)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(ha);var ma=function(t){return ja(pa(t,void 0,sa),t+"")}((function(t,r){var e={};if(null==t)return e;var n=!1;r=an(r,(function(r){return r=pn(r,t),n||(n=r.length>1),r})),Nt(t,Mr(t),e),n&&(e=Qe(e,7,aa));for(var o=r.length;o--;)Xu(e,r[o]);return e})),wa="[object String]";var _a=function(t){return"string"==typeof t||!Vt(t)&&Dt(t)&&T(t)==wa},xa=yo("length"),Oa="[\\ud800-\\udfff]",Aa="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ka="\\ud83c[\\udffb-\\udfff]",Sa="[^\\ud800-\\udfff]",Ea="(?:\\ud83c[\\udde6-\\uddff]){2}",Pa="[\\ud800-\\udbff][\\udc00-\\udfff]",Ua="(?:"+Aa+"|"+ka+")"+"?",La="[\\ufe0e\\ufe0f]?"+Ua+("(?:\\u200d(?:"+[Sa,Ea,Pa].join("|")+")[\\ufe0e\\ufe0f]?"+Ua+")*"),Ba="(?:"+[Sa+Aa+"?",Aa,Ea,Pa,Oa].join("|")+")",Ra=RegExp(ka+"(?="+ka+")|"+Ba+La,"g");var za=function(t){for(var r=Ra.lastIndex=0;Ra.test(t);)++r;return r};var Fa=function(t){return Ho(t)?za(t):xa(t)},Ma="[object Map]",Na="[object Set]";var Ta=function(t){if(null==t)return 0;if(dr(t))return _a(t)?Fa(t):t.length;var r=Wr(t);return r==Ma||r==Na?t.size:pr(t).length};function Da(t,r){var e=Vo();if(!Iu(t))return e.reject("rs is not array"),e;wu(r)||(r=function(t){return t});var n=-1,o=[];return t.reduce((function(t,e){return t.then((function(t){return o.push(t),r(e,n+=1)}))}),Promise.resolve()).then((function(t){o.push(t),o=Cu(o),e.resolve(o)})).catch((function(t){e.reject(t)})),e}var Ia={useNewUrlParser:!0,useUnifiedTopology:!0};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=We(t)).mongoUrl||(t.mongoUrl="mongodb://127.0.0.1:27017"),t.mongoDb||(t.mongoDb="wqws"),t.mongoCl||(t.mongoCl="queues"),t.port||(t.port=8080);var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.url||(t.url="mongodb://127.0.0.1:27017"),t.db||(t.db="worm"),t.cl||(t.cl="test");var e=new r.EventEmitter,n=o.MongoClient;function a(r){var o,u,a,i;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return r=We(r),o=Vo(),c.next=4,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 4:return u=c.sent,a=u.db(t.db),i=a.collection(t.cl),Iu(r)||(r=[r]),r=Oo(r,(function(t){return t.id||(t.id=qo()),t})),i.insertMany(r,(function(t,n){t?o.reject(t):n.insertedCount>0?(n=n.result,o.resolve(n),e.emit("change","insert",r,n)):o.reject(t),u.close()})),c.abrupt("return",o);case 11:case"end":return c.stop()}}))}function i(){var r,e,u,a,i,c=arguments;return regeneratorRuntime.async((function(f){for(;;)switch(f.prev=f.next){case 0:if(r=c.length>0&&void 0!==c[0]?c[0]:{},e=c.length>1&&void 0!==c[1]?c[1]:null,u=Vo(),null!==e){f.next=9;break}return f.next=6,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 6:a=f.sent,i=a.db(t.db),e=new o.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:t.cl});case 9:return e.find(r).toArray((function(t,r){t?u.reject(t):u.resolve(r)})),f.abrupt("return",u);case 11:case"end":return f.stop()}}))}function c(t,r){var e;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=Vo(),r.delete(t,(function(t){t?e.reject(t):e.resolve({n:1,nDeleted:1,ok:1})})),n.abrupt("return",e);case 3:case"end":return n.stop()}}))}return e.select=function(){var r,e,o,u,a=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},e=Vo(),i.next=4,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 4:return o=i.sent,u=o.db(t.db),u.collection(t.cl).find(r).toArray((function(t,r){t?e.reject(t):(r=Oo(r,(function(t){return t=ma(t,"_id")})),e.resolve(r)),o.close()})),i.abrupt("return",e);case 9:case"end":return i.stop()}}))},e.insert=a,e.save=function(r){var o,u,i,c,f,s,l,v,p=arguments;return regeneratorRuntime.async((function(d){for(;;)switch(d.prev=d.next){case 0:return o=p.length>1&&void 0!==p[1]?p[1]:{},r=We(r),u=yn(o,"autoInsert",!0),i=yn(o,"atomic",!1),c=Vo(),d.next=7,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 7:return f=d.sent,s=f.db(t.db),l=s.collection(t.cl),Iu(r)||(r=[r]),v=null,v=i?"findOneAndUpdate":"updateOne",Da(r,(function(t){var r=Vo();return l[v]({id:t.id},{$set:t},(function(e,n){e?r.reject(e):(n.lastErrorObject&&(n.result={n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}),u&&0===n.result.n?a(t).then((function(t){t.nInserted=1,r.resolve(t)})).catch((function(t){r.reject(t)})):r.resolve(n.result))})),r})).then((function(t){c.resolve(t),e.emit("change","save",r,t)})).catch((function(t){c.reject(t)})).finally((function(){f.close()})),d.abrupt("return",c);case 15:case"end":return d.stop()}}))},e.del=function(r){var o,u,a,i;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return r=We(r),o=Vo(),c.next=4,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 4:return u=c.sent,a=u.db(t.db),i=a.collection(t.cl),Iu(r)||(r=[r]),Da(r,(function(t){var r=Vo();return i.deleteOne({id:t.id},(function(t,e){t?r.resolve(t):((e=e.result).nDeleted=1,r.resolve(e))})),r})).then((function(t){o.resolve(t),e.emit("change","del",r,t)})).catch((function(t){o.reject(t)})).finally((function(){u.close()})),c.abrupt("return",o);case 10:case"end":return c.stop()}}))},e.delAll=function(){var r,o,u,a,i=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:{},o=Vo(),c.next=4,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 4:return u=c.sent,a=u.db(t.db),a.collection(t.cl).deleteMany(r,(function(t,r){t?o.resolve(t):(r=r.result,o.resolve(r),e.emit("change","delAll",null,r)),u.close()})),c.abrupt("return",o);case 9:case"end":return c.stop()}}))},e.selectGfs=function(r){var e,u,a,i,c,f;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return e=Vo(),s.next=3,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 3:return u=s.sent,a=u.db(t.db),i=new o.GridFSBucket(a,{chunkSizeBytes:10485760,bucketName:t.cl}),c=Buffer.from(""),(f=i.openDownloadStreamByName(r)).on("data",(function(t){c=Buffer.concat([c,t])})),f.on("error",(function(t){e.reject(t),u.close()})),f.on("end",(function(){var t=new Uint8Array(c);c=null,e.resolve(t),u.close()})),s.abrupt("return",e);case 12:case"end":return s.stop()}}))},e.insertGfs=function(r){var a,i,c,f,s,l,v;return regeneratorRuntime.async((function(p){for(;;)switch(p.prev=p.next){case 0:return a=Vo(),i=qo(),c=Buffer.from(r),p.next=5,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 5:return f=p.sent,s=f.db(t.db),l=new o.GridFSBucket(s,{chunkSizeBytes:10485760,bucketName:t.cl}),(v=new u.Readable)._read=function(){},v.push(c),v.push(null),v.pipe(l.openUploadStream(i)).on("error",(function(t){a.reject(t),f.close()})).on("finish",(function(){var t={n:1,ok:1,id:i};a.resolve(t),e.emit("change","insertGfs",null,t),f.close()})),p.abrupt("return",a);case 14:case"end":return p.stop()}}))},e.delGfs=function(r){var u,a,c,f,s,l;return regeneratorRuntime.async((function(v){for(;;)switch(v.prev=v.next){case 0:return u=Vo(),v.next=3,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 3:return a=v.sent,c=a.db(t.db),f=new o.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:t.cl}),v.next=8,regeneratorRuntime.awrap(i({filename:r},f));case 8:return 0===(s=v.sent).length?(u.reject("can not find id"),a.close()):s.length>1?(u.reject("duplicate id"),a.close()):(l=s[0]._id,f.delete(l,(function(t){if(t)u.reject(t);else{var r={n:1,nDeleted:1,ok:1};u.resolve(r),e.emit("change","delGfs",null,r)}a.close()}))),v.abrupt("return",u);case 11:case"end":return v.stop()}}))},e.delAllGfs=function(){var r,u,a,f,s,l,v,p,d=arguments;return regeneratorRuntime.async((function(h){for(;;)switch(h.prev=h.next){case 0:return r=d.length>0&&void 0!==d[0]?d[0]:{},u=Vo(),h.next=4,regeneratorRuntime.awrap(n.connect(t.url,Ia));case 4:return a=h.sent,f=a.db(t.db),s=new o.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:t.cl}),h.next=9,regeneratorRuntime.awrap(i(r,s));case 9:return l=h.sent,v=Ta(l),p=Oo(l,(function(t){return c(t._id,s)})),Promise.all(p).then((function(t){var r={n:v,ok:1};u.resolve(r),e.emit("change","delAllGfs",null,r)})).catch((function(t){u.reject(t)})).finally((function(){a.close()})),h.abrupt("return",u);case 14:case"end":return h.stop()}}))},e}({url:t.mongoUrl,db:t.mongoDb,cl:t.mongoCl}),n=new Yu(t);return n.on("execute",(function(t,r,o,u){var a,i,c,s,l,v,p,d,h,b,y,g,j,m,w,_,x,O,A,k;return f.async((function(S){for(;;)switch(S.prev=S.next){case 0:if(i=function(t){u({_mode:"deliver",data:t})},a=yn(r,"topic",null),"pushQueue"!==t){S.next=12;break}return s=qo(),l=yn(r,"input",null),v=yn(r,"option"),p={topic:a,id:s,input:l,output:null,transData:yn(v,"transData",null),timeStart:yn(v,"timeStart",null),timeExp:yn(v,"timeExp",null),timeTakeStart:yn(v,"timeTakeStart",null),timeTakeExp:yn(v,"timeTakeExp",null),state:"ready"},S.next=9,f.awrap(e.insert(p).then((function(t){n.emit(a,{topic:a,id:s,input:p.input,output:p.output,state:p.state}),c="success"})).catch((function(t){c={err:t}})));case 9:o(c),S.next=105;break;case 12:if("modifyQueue"!==t){S.next=27;break}if(null===(d=yn(r,"id",null))){S.next=23;break}return h=yn(r,"input",null),b=yn(r,"output",null),y=yn(r,"state",null),g={id:d,output:b,state:y},S.next=21,f.awrap(e.save(g,{atomic:!0}).then((function(t){n.emit(a,{topic:a,id:d,input:h,output:b,state:y}),c="success"})).catch((function(t){c={err:t}})));case 21:S.next=24;break;case 23:c={err:"can not find id"};case 24:o(c),S.next=105;break;case 27:if("subTopic"!==t){S.next=34;break}n.deliverQueue=i,n.on(a,n.deliverQueue),o(c="success"),S.next=105;break;case 34:if("unsubTopic"!==t){S.next=41;break}n.off(a,n.deliverQueue),n.deliverQueue=null,o(c="success"),S.next=105;break;case 41:if("delQueueByTopic"!==t){S.next=47;break}return S.next=44,f.awrap(e.delAll({topic:a}).then((function(t){c="success"})).catch((function(t){c={err:t}})));case 44:o(c),S.next=105;break;case 47:if("delQueueByID"!==t){S.next=58;break}if(null===(j=yn(r,"id",null))){S.next=54;break}return S.next=52,f.awrap(e.delAll({id:j}).then((function(t){c="success"})).catch((function(t){c={err:t}})));case 52:S.next=55;break;case 54:c={err:"can not find id"};case 55:o(c),S.next=105;break;case 58:if("delQueueByIDs"!==t){S.next=66;break}return m=yn(r,"ids",null),w=Oo(m,(function(t){return e.delAll({id:t})})),S.next=63,f.awrap(Promise.all(w).then((function(t){c="success"})).catch((function(t){c={err:t}})));case 63:o(c),S.next=105;break;case 66:if("delQueueByMatches"!==t){S.next=73;break}return _=yn(r,"find",null),S.next=70,f.awrap(e.delAll(_).then((function(t){c="success"})).catch((function(t){c={err:t}})));case 70:o(c),S.next=105;break;case 73:if("getQueueByTopic"!==t){S.next=79;break}return S.next=76,f.awrap(e.select({topic:a}).then((function(t){c=t})).catch((function(t){c={err:t}})));case 76:o(c),S.next=105;break;case 79:if("getQueueByID"!==t){S.next=90;break}if(null===(x=yn(r,"id",null))){S.next=86;break}return S.next=84,f.awrap(e.select({id:x}).then((function(t){c=t})).catch((function(t){c={err:t}})));case 84:S.next=87;break;case 86:c={err:"can not find id"};case 87:o(c),S.next=105;break;case 90:if("getQueueByIDs"!==t){S.next=98;break}return O=yn(r,"ids",null),A=Oo(O,(function(t){return e.select({id:t})})),S.next=95,f.awrap(Promise.all(A).then((function(t){c=t})).catch((function(t){c={err:t}})));case 95:o(c),S.next=105;break;case 98:if("getQueueByMatches"!==t){S.next=105;break}return k=yn(r,"find",null),S.next=102,f.awrap(e.select(k).then((function(t){c=t})).catch((function(t){c={err:t}})));case 102:o(c),S.next=105;break;case 105:case"end":return S.stop()}}))})),n}}));
//# sourceMappingURL=w-runqws-server.umd.js.map
