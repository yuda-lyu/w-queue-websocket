/*!
 * w-runqws-server v1.0.27
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ws"),require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","events","mongodb","stream"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-runqws-server"]=e(t.ws,t.events,t.mongodb,t.stream)}(this,(function(t,e,n,r){"use strict";function o(t,e){return t===e||t!=t&&e!=e}function i(t,e){for(var n=t.length;n--;)if(o(t[n][0],e))return n;return-1}var u=Array.prototype.splice;function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=function(){this.__data__=[],this.size=0},c.prototype.delete=function(t){var e=this.__data__,n=i(e,t);return!(n<0)&&(n==e.length-1?e.pop():u.call(e,n,1),--this.size,!0)},c.prototype.get=function(t){var e=this.__data__,n=i(e,t);return n<0?void 0:e[n][1]},c.prototype.has=function(t){return i(this.__data__,t)>-1},c.prototype.set=function(t,e){var n=this.__data__,r=i(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var a="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,l=a||f||Function("return this")(),s=l.Symbol,p=Object.prototype,d=p.hasOwnProperty,h=p.toString,v=s?s.toStringTag:void 0;var y=Object.prototype.toString;var b="[object Null]",g="[object Undefined]",j=s?s.toStringTag:void 0;function w(t){return null==t?void 0===t?g:b:j&&j in Object(t)?function(t){var e=d.call(t,v),n=t[v];try{t[v]=void 0;var r=!0}catch(t){}var o=h.call(t);return r&&(e?t[v]=n:delete t[v]),o}(t):function(t){return y.call(t)}(t)}function _(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var m="[object AsyncFunction]",A="[object Function]",O="[object GeneratorFunction]",x="[object Proxy]";function S(t){if(!_(t))return!1;var e=w(t);return e==A||e==O||e==m||e==x}var B,k=l["__core-js_shared__"],U=(B=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"";var P=Function.prototype.toString;function z(t){if(null!=t){try{return P.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var C=/^\[object .+?Constructor\]$/,E=Function.prototype,M=Object.prototype,I=E.toString,T=M.hasOwnProperty,D=RegExp("^"+I.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function F(t){return!(!_(t)||(e=t,U&&U in e))&&(S(t)?D:C).test(z(t));var e}function N(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return F(n)?n:void 0}var L=N(l,"Map"),$=N(Object,"create");var R=Object.prototype.hasOwnProperty;var Q=Object.prototype.hasOwnProperty;function G(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function W(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function q(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}G.prototype.clear=function(){this.__data__=$?$(null):{},this.size=0},G.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},G.prototype.get=function(t){var e=this.__data__;if($){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return R.call(e,t)?e[t]:void 0},G.prototype.has=function(t){var e=this.__data__;return $?void 0!==e[t]:Q.call(e,t)},G.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=$&&void 0===e?"__lodash_hash_undefined__":e,this},q.prototype.clear=function(){this.size=0,this.__data__={hash:new G,map:new(L||c),string:new G}},q.prototype.delete=function(t){var e=W(this,t).delete(t);return this.size-=e?1:0,e},q.prototype.get=function(t){return W(this,t).get(t)},q.prototype.has=function(t){return W(this,t).has(t)},q.prototype.set=function(t,e){var n=W(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function V(t){var e=this.__data__=new c(t);this.size=e.size}function H(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}V.prototype.clear=function(){this.__data__=new c,this.size=0},V.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},V.prototype.get=function(t){return this.__data__.get(t)},V.prototype.has=function(t){return this.__data__.has(t)},V.prototype.set=function(t,e){var n=this.__data__;if(n instanceof c){var r=n.__data__;if(!L||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new q(r)}return n.set(t,e),this.size=n.size,this};var J=function(){try{var t=N(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),K=J;function X(t,e,n){"__proto__"==e&&K?K(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var Y=Object.prototype.hasOwnProperty;function Z(t,e,n){var r=t[e];Y.call(t,e)&&o(r,n)&&(void 0!==n||e in t)||X(t,e,n)}function tt(t,e,n,r){var o=!n;n||(n={});for(var i=-1,u=e.length;++i<u;){var c=e[i],a=r?r(n[c],t[c],c,n,t):void 0;void 0===a&&(a=t[c]),o?X(n,c,a):Z(n,c,a)}return n}function et(t){return null!=t&&"object"==typeof t}function nt(t){return et(t)&&"[object Arguments]"==w(t)}var rt=Object.prototype,ot=rt.hasOwnProperty,it=rt.propertyIsEnumerable,ut=nt(function(){return arguments}())?nt:function(t){return et(t)&&ot.call(t,"callee")&&!it.call(t,"callee")},ct=ut,at=Array.isArray;var ft="object"==typeof exports&&exports&&!exports.nodeType&&exports,lt=ft&&"object"==typeof module&&module&&!module.nodeType&&module,st=lt&&lt.exports===ft?l.Buffer:void 0,pt=(st?st.isBuffer:void 0)||function(){return!1},dt=9007199254740991,ht=/^(?:0|[1-9]\d*)$/;function vt(t,e){var n=typeof t;return!!(e=null==e?dt:e)&&("number"==n||"symbol"!=n&&ht.test(t))&&t>-1&&t%1==0&&t<e}var yt=9007199254740991;function bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=yt}var gt={};function jt(t){return function(e){return t(e)}}gt["[object Float32Array]"]=gt["[object Float64Array]"]=gt["[object Int8Array]"]=gt["[object Int16Array]"]=gt["[object Int32Array]"]=gt["[object Uint8Array]"]=gt["[object Uint8ClampedArray]"]=gt["[object Uint16Array]"]=gt["[object Uint32Array]"]=!0,gt["[object Arguments]"]=gt["[object Array]"]=gt["[object ArrayBuffer]"]=gt["[object Boolean]"]=gt["[object DataView]"]=gt["[object Date]"]=gt["[object Error]"]=gt["[object Function]"]=gt["[object Map]"]=gt["[object Number]"]=gt["[object Object]"]=gt["[object RegExp]"]=gt["[object Set]"]=gt["[object String]"]=gt["[object WeakMap]"]=!1;var wt="object"==typeof exports&&exports&&!exports.nodeType&&exports,_t=wt&&"object"==typeof module&&module&&!module.nodeType&&module,mt=_t&&_t.exports===wt&&a.process,At=function(){try{var t=_t&&_t.require&&_t.require("util").types;return t||mt&&mt.binding&&mt.binding("util")}catch(t){}}(),Ot=At&&At.isTypedArray,xt=Ot?jt(Ot):function(t){return et(t)&&bt(t.length)&&!!gt[w(t)]},St=Object.prototype.hasOwnProperty;function Bt(t,e){var n=at(t),r=!n&&ct(t),o=!n&&!r&&pt(t),i=!n&&!r&&!o&&xt(t),u=n||r||o||i,c=u?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],a=c.length;for(var f in t)!e&&!St.call(t,f)||u&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||vt(f,a))||c.push(f);return c}var kt=Object.prototype;function Ut(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||kt)}function Pt(t,e){return function(n){return t(e(n))}}var zt=Pt(Object.keys,Object),Ct=Object.prototype.hasOwnProperty;function Et(t){if(!Ut(t))return zt(t);var e=[];for(var n in Object(t))Ct.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Mt(t){return null!=t&&bt(t.length)&&!S(t)}function It(t){return Mt(t)?Bt(t):Et(t)}var Tt=Object.prototype.hasOwnProperty;function Dt(t){if(!_(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Ut(t),n=[];for(var r in t)("constructor"!=r||!e&&Tt.call(t,r))&&n.push(r);return n}function Ft(t){return Mt(t)?Bt(t,!0):Dt(t)}var Nt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Lt=Nt&&"object"==typeof module&&module&&!module.nodeType&&module,$t=Lt&&Lt.exports===Nt?l.Buffer:void 0,Rt=$t?$t.allocUnsafe:void 0;function Qt(){return[]}var Gt=Object.prototype.propertyIsEnumerable,Wt=Object.getOwnPropertySymbols,qt=Wt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var u=t[n];e(u,n,t)&&(i[o++]=u)}return i}(Wt(t),(function(e){return Gt.call(t,e)})))}:Qt,Vt=qt;function Ht(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}var Jt=Pt(Object.getPrototypeOf,Object),Kt=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Ht(e,Vt(t)),t=Jt(t);return e}:Qt,Xt=Kt;function Yt(t,e,n){var r=e(t);return at(t)?r:Ht(r,n(t))}function Zt(t){return Yt(t,It,Vt)}function te(t){return Yt(t,Ft,Xt)}var ee=N(l,"DataView"),ne=N(l,"Promise"),re=N(l,"Set"),oe=N(l,"WeakMap"),ie="[object Map]",ue="[object Promise]",ce="[object Set]",ae="[object WeakMap]",fe="[object DataView]",le=z(ee),se=z(L),pe=z(ne),de=z(re),he=z(oe),ve=w;(ee&&ve(new ee(new ArrayBuffer(1)))!=fe||L&&ve(new L)!=ie||ne&&ve(ne.resolve())!=ue||re&&ve(new re)!=ce||oe&&ve(new oe)!=ae)&&(ve=function(t){var e=w(t),n="[object Object]"==e?t.constructor:void 0,r=n?z(n):"";if(r)switch(r){case le:return fe;case se:return ie;case pe:return ue;case de:return ce;case he:return ae}return e});var ye=ve,be=Object.prototype.hasOwnProperty;var ge=l.Uint8Array;function je(t){var e=new t.constructor(t.byteLength);return new ge(e).set(new ge(t)),e}var we=/\w*$/;var _e=s?s.prototype:void 0,me=_e?_e.valueOf:void 0;var Ae="[object Boolean]",Oe="[object Date]",xe="[object Map]",Se="[object Number]",Be="[object RegExp]",ke="[object Set]",Ue="[object String]",Pe="[object Symbol]",ze="[object ArrayBuffer]",Ce="[object DataView]",Ee="[object Float32Array]",Me="[object Float64Array]",Ie="[object Int8Array]",Te="[object Int16Array]",De="[object Int32Array]",Fe="[object Uint8Array]",Ne="[object Uint8ClampedArray]",Le="[object Uint16Array]",$e="[object Uint32Array]";function Re(t,e,n){var r,o,i,u=t.constructor;switch(e){case ze:return je(t);case Ae:case Oe:return new u(+t);case Ce:return function(t,e){var n=e?je(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case Ee:case Me:case Ie:case Te:case De:case Fe:case Ne:case Le:case $e:return function(t,e){var n=e?je(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case xe:return new u;case Se:case Ue:return new u(t);case Be:return(i=new(o=t).constructor(o.source,we.exec(o))).lastIndex=o.lastIndex,i;case ke:return new u;case Pe:return r=t,me?Object(me.call(r)):{}}}var Qe=Object.create,Ge=function(){function t(){}return function(e){if(!_(e))return{};if(Qe)return Qe(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),We=Ge;var qe=At&&At.isMap,Ve=qe?jt(qe):function(t){return et(t)&&"[object Map]"==ye(t)};var He=At&&At.isSet,Je=He?jt(He):function(t){return et(t)&&"[object Set]"==ye(t)},Ke=1,Xe=2,Ye=4,Ze="[object Arguments]",tn="[object Function]",en="[object GeneratorFunction]",nn="[object Object]",rn={};function on(t,e,n,r,o,i){var u,c=e&Ke,a=e&Xe,f=e&Ye;if(n&&(u=o?n(t,r,o,i):n(t)),void 0!==u)return u;if(!_(t))return t;var l=at(t);if(l){if(u=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&be.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!c)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,u)}else{var s=ye(t),p=s==tn||s==en;if(pt(t))return function(t,e){if(e)return t.slice();var n=t.length,r=Rt?Rt(n):new t.constructor(n);return t.copy(r),r}(t,c);if(s==nn||s==Ze||p&&!o){if(u=a||p?{}:function(t){return"function"!=typeof t.constructor||Ut(t)?{}:We(Jt(t))}(t),!c)return a?function(t,e){return tt(t,Xt(t),e)}(t,function(t,e){return t&&tt(e,Ft(e),t)}(u,t)):function(t,e){return tt(t,Vt(t),e)}(t,function(t,e){return t&&tt(e,It(e),t)}(u,t))}else{if(!rn[s])return o?t:{};u=Re(t,s,c)}}i||(i=new V);var d=i.get(t);if(d)return d;i.set(t,u),Je(t)?t.forEach((function(r){u.add(on(r,e,n,r,t,i))})):Ve(t)&&t.forEach((function(r,o){u.set(o,on(r,e,n,o,t,i))}));var h=l?void 0:(f?a?te:Zt:a?Ft:It)(t);return H(h||t,(function(r,o){h&&(r=t[o=r]),Z(u,o,on(r,e,n,o,t,i))})),u}rn[Ze]=rn["[object Array]"]=rn["[object ArrayBuffer]"]=rn["[object DataView]"]=rn["[object Boolean]"]=rn["[object Date]"]=rn["[object Float32Array]"]=rn["[object Float64Array]"]=rn["[object Int8Array]"]=rn["[object Int16Array]"]=rn["[object Int32Array]"]=rn["[object Map]"]=rn["[object Number]"]=rn[nn]=rn["[object RegExp]"]=rn["[object Set]"]=rn["[object String]"]=rn["[object Symbol]"]=rn["[object Uint8Array]"]=rn["[object Uint8ClampedArray]"]=rn["[object Uint16Array]"]=rn["[object Uint32Array]"]=!0,rn["[object Error]"]=rn[tn]=rn["[object WeakMap]"]=!1;var un=1,cn=4;function an(t){return on(t,un|cn)}var fn="[object Symbol]";function ln(t){return"symbol"==typeof t||et(t)&&w(t)==fn}var sn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,pn=/^\w*$/;function dn(t,e){if(at(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!ln(t))||(pn.test(t)||!sn.test(t)||null!=e&&t in Object(e))}var hn="Expected a function";function vn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(hn);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var u=t.apply(this,r);return n.cache=i.set(o,u)||i,u};return n.cache=new(vn.Cache||q),n}vn.Cache=q;var yn,bn,gn,jn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wn=/\\(\\)?/g,_n=(yn=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(jn,(function(t,n,r,o){e.push(r?o.replace(wn,"$1"):n||t)})),e},bn=vn(yn,(function(t){return 500===gn.size&&gn.clear(),t})),gn=bn.cache,bn),mn=_n;function An(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}var On=1/0,xn=s?s.prototype:void 0,Sn=xn?xn.toString:void 0;function Bn(t){if("string"==typeof t)return t;if(at(t))return An(t,Bn)+"";if(ln(t))return Sn?Sn.call(t):"";var e=t+"";return"0"==e&&1/t==-On?"-0":e}function kn(t){return null==t?"":Bn(t)}function Un(t,e){return at(t)?t:dn(t,e)?[t]:mn(kn(t))}var Pn=1/0;function zn(t){if("string"==typeof t||ln(t))return t;var e=t+"";return"0"==e&&1/t==-Pn?"-0":e}function Cn(t,e){for(var n=0,r=(e=Un(e,t)).length;null!=t&&n<r;)t=t[zn(e[n++])];return n&&n==r?t:void 0}function En(t,e,n){var r=null==t?void 0:Cn(t,e);return void 0===r?n:r}function Mn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new q;++e<n;)this.add(t[e])}function In(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function Tn(t,e){return t.has(e)}Mn.prototype.add=Mn.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Mn.prototype.has=function(t){return this.__data__.has(t)};var Dn=1,Fn=2;function Nn(t,e,n,r,o,i){var u=n&Dn,c=t.length,a=e.length;if(c!=a&&!(u&&a>c))return!1;var f=i.get(t),l=i.get(e);if(f&&l)return f==e&&l==t;var s=-1,p=!0,d=n&Fn?new Mn:void 0;for(i.set(t,e),i.set(e,t);++s<c;){var h=t[s],v=e[s];if(r)var y=u?r(v,h,s,e,t,i):r(h,v,s,t,e,i);if(void 0!==y){if(y)continue;p=!1;break}if(d){if(!In(e,(function(t,e){if(!Tn(d,e)&&(h===t||o(h,t,n,r,i)))return d.push(e)}))){p=!1;break}}else if(h!==v&&!o(h,v,n,r,i)){p=!1;break}}return i.delete(t),i.delete(e),p}function Ln(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function $n(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Rn=1,Qn=2,Gn="[object Boolean]",Wn="[object Date]",qn="[object Error]",Vn="[object Map]",Hn="[object Number]",Jn="[object RegExp]",Kn="[object Set]",Xn="[object String]",Yn="[object Symbol]",Zn="[object ArrayBuffer]",tr="[object DataView]",er=s?s.prototype:void 0,nr=er?er.valueOf:void 0;var rr=1,or=Object.prototype.hasOwnProperty;var ir=1,ur="[object Arguments]",cr="[object Array]",ar="[object Object]",fr=Object.prototype.hasOwnProperty;function lr(t,e,n,r,i,u){var c=at(t),a=at(e),f=c?cr:ye(t),l=a?cr:ye(e),s=(f=f==ur?ar:f)==ar,p=(l=l==ur?ar:l)==ar,d=f==l;if(d&&pt(t)){if(!pt(e))return!1;c=!0,s=!1}if(d&&!s)return u||(u=new V),c||xt(t)?Nn(t,e,n,r,i,u):function(t,e,n,r,i,u,c){switch(n){case tr:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Zn:return!(t.byteLength!=e.byteLength||!u(new ge(t),new ge(e)));case Gn:case Wn:case Hn:return o(+t,+e);case qn:return t.name==e.name&&t.message==e.message;case Jn:case Xn:return t==e+"";case Vn:var a=Ln;case Kn:var f=r&Rn;if(a||(a=$n),t.size!=e.size&&!f)return!1;var l=c.get(t);if(l)return l==e;r|=Qn,c.set(t,e);var s=Nn(a(t),a(e),r,i,u,c);return c.delete(t),s;case Yn:if(nr)return nr.call(t)==nr.call(e)}return!1}(t,e,f,n,r,i,u);if(!(n&ir)){var h=s&&fr.call(t,"__wrapped__"),v=p&&fr.call(e,"__wrapped__");if(h||v){var y=h?t.value():t,b=v?e.value():e;return u||(u=new V),i(y,b,n,r,u)}}return!!d&&(u||(u=new V),function(t,e,n,r,o,i){var u=n&rr,c=Zt(t),a=c.length;if(a!=Zt(e).length&&!u)return!1;for(var f=a;f--;){var l=c[f];if(!(u?l in e:or.call(e,l)))return!1}var s=i.get(t),p=i.get(e);if(s&&p)return s==e&&p==t;var d=!0;i.set(t,e),i.set(e,t);for(var h=u;++f<a;){var v=t[l=c[f]],y=e[l];if(r)var b=u?r(y,v,l,e,t,i):r(v,y,l,t,e,i);if(!(void 0===b?v===y||o(v,y,n,r,i):b)){d=!1;break}h||(h="constructor"==l)}if(d&&!h){var g=t.constructor,j=e.constructor;g==j||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof j&&j instanceof j||(d=!1)}return i.delete(t),i.delete(e),d}(t,e,n,r,i,u))}function sr(t,e,n,r,o){return t===e||(null==t||null==e||!et(t)&&!et(e)?t!=t&&e!=e:lr(t,e,n,r,sr,o))}var pr=1,dr=2;function hr(t){return t==t&&!_(t)}function vr(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function yr(t){var e=function(t){for(var e=It(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,hr(o)]}return e}(t);return 1==e.length&&e[0][2]?vr(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var o=n.length,i=o,u=!r;if(null==t)return!i;for(t=Object(t);o--;){var c=n[o];if(u&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++o<i;){var a=(c=n[o])[0],f=t[a],l=c[1];if(u&&c[2]){if(void 0===f&&!(a in t))return!1}else{var s=new V;if(r)var p=r(f,l,a,t,e,s);if(!(void 0===p?sr(l,f,pr|dr,r,s):p))return!1}}return!0}(n,t,e)}}function br(t,e){return null!=t&&e in Object(t)}function gr(t,e){return null!=t&&function(t,e,n){for(var r=-1,o=(e=Un(e,t)).length,i=!1;++r<o;){var u=zn(e[r]);if(!(i=null!=t&&n(t,u)))break;t=t[u]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&bt(o)&&vt(u,o)&&(at(t)||ct(t))}(t,e,br)}var jr=1,wr=2;function _r(t){return t}function mr(t){return function(e){return null==e?void 0:e[t]}}function Ar(t){return dn(t)?mr(zn(t)):function(t){return function(e){return Cn(e,t)}}(t)}function Or(t){return"function"==typeof t?t:null==t?_r:"object"==typeof t?at(t)?(e=t[0],n=t[1],dn(e)&&hr(n)?vr(zn(e),n):function(t){var r=En(t,e);return void 0===r&&r===n?gr(t,e):sr(n,r,jr|wr)}):yr(t):Ar(t);var e,n}var xr,Sr=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),u=i.length;u--;){var c=i[xr?u:++r];if(!1===e(o[c],c,o))break}return t};var Br=function(t,e){return function(n,r){if(null==n)return n;if(!Mt(n))return t(n,r);for(var o=n.length,i=e?o:-1,u=Object(n);(e?i--:++i<o)&&!1!==r(u[i],i,u););return n}}((function(t,e){return t&&Sr(t,e,It)})),kr=Br;function Ur(t,e){var n=-1,r=Mt(t)?Array(t.length):[];return kr(t,(function(t,o,i){r[++n]=e(t,o,i)})),r}function Pr(t,e){return(at(t)?An:Ur)(t,Or(e))}var zr=/\s/;var Cr=/^\s+/;function Er(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&zr.test(t.charAt(e)););return e}(t)+1).replace(Cr,""):t}var Mr=NaN,Ir=/^[-+]0x[0-9a-f]+$/i,Tr=/^0b[01]+$/i,Dr=/^0o[0-7]+$/i,Fr=parseInt;function Nr(t){if("number"==typeof t)return t;if(ln(t))return Mr;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Er(t);var n=Tr.test(t);return n||Dr.test(t)?Fr(t.slice(2),n?2:8):Ir.test(t)?Mr:+t}var Lr=1/0,$r=17976931348623157e292;function Rr(t){return t?(t=Nr(t))===Lr||t===-Lr?(t<0?-1:1)*$r:t==t?t:0:0===t?t:0}function Qr(t){var e=Rr(t),n=e%1;return e==e?n?e-n:e:0}function Gr(t){return"[object String]"===Object.prototype.toString.call(t)}function Wr(t){return!(!Gr(t)||""===t)}function qr(t){let e=!1;if(Wr(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(function(t){return t!=t}(t))return!1;e=!0}return e}function Vr(t){if(!qr(t))return 0;return Rr(t)}function Hr(t){return!!qr(t)&&(t=Vr(t),"number"==typeof(e=t)&&e==Qr(e));var e}var Jr=l.isFinite,Kr=Math.min;var Xr=function(t){var e=Math[t];return function(t,n){if(t=Nr(t),(n=null==n?0:Kr(Qr(n),292))&&Jr(t)){var r=(kn(t)+"e").split("e");return+((r=(kn(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),Yr=Xr;function Zr(t){if(!qr(t))return 0;t=Vr(t);let e=Yr(t);return"0"===String(e)?0:e}let to="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),eo=to.length;function no(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];var n;t=Hr(n=t)&&Zr(n)>0?Zr(t):32;for(let n=0;n<t;n++)e[n]=to[0|Math.random()*eo];return e.join("")}var ro="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function oo(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(e,n))}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var io={};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,u){if("function"!=typeof r)throw new TypeError("The listener must be a function");var c=new o(r,i||t,u),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},c.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,u=new Array(i);o<i;o++)u[o]=r[o].fn;return u},c.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},c.prototype.emit=function(t,e,r,o,i,u){var c=n?n+t:t;if(!this._events[c])return!1;var a,f,l=this._events[c],s=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),s){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,o),!0;case 5:return l.fn.call(l.context,e,r,o,i),!0;case 6:return l.fn.call(l.context,e,r,o,i,u),!0}for(f=1,a=new Array(s-1);f<s;f++)a[f-1]=arguments[f];l.fn.apply(l.context,a)}else{var p,d=l.length;for(f=0;f<d;f++)switch(l[f].once&&this.removeListener(t,l[f].fn,void 0,!0),s){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,e);break;case 3:l[f].fn.call(l[f].context,e,r);break;case 4:l[f].fn.call(l[f].context,e,r,o);break;default:if(!a)for(p=1,a=new Array(s-1);p<s;p++)a[p-1]=arguments[p];l[f].fn.apply(l[f].context,a)}}return!0},c.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var c=this._events[i];if(c.fn)c.fn!==e||o&&!c.once||r&&c.context!==r||u(this,i);else{for(var a=0,f=[],l=c.length;a<l;a++)(c[a].fn!==e||o&&!c[a].once||r&&c[a].context!==r)&&f.push(c[a]);f.length?this._events[i]=1===f.length?f[0]:f:u(this,i)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&u(this,e)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c}({get exports(){return io},set exports(t){io=t}});var uo=io;function co(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}function ao(t,e,n){if(!_(n))return!1;var r=typeof e;return!!("number"==r?Mt(n)&&vt(e,n.length):"string"==r&&e in n)&&o(n[e],t)}var fo=Math.ceil,lo=Math.max;var so=Array.prototype.join;function po(t,e){return null==t?"":so.call(t,e)}function ho(t,e){var n;return(at(t)?H:kr)(t,"function"==typeof(n=e)?n:_r)}function vo(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function yo(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function bo(t){if(!Hr(t))return!1;return Zr(t)>=0}function go(t,e){return Wr(t)&&bo(e)?0===(e=Zr(e))?"":t.substring(0,e):""}function jo(t,e){return Wr(t)&&bo(e)?0===(e=Zr(e))?t:function(t,e){if(!Wr(t))return"";if(!bo(e))return"";if(0===(e=Zr(e)))return"";let n=t.length-e;return n<0&&(n=0),t.substr(n,e)}(t,t.length-e):""}var wo={},_o={get exports(){return wo},set exports(t){wo=t}};var mo,Ao={},Oo={get exports(){return Ao},set exports(t){Ao=t}},xo=oo(Object.freeze({__proto__:null,default:{}}));function So(){return mo||(mo=1,function(t,e){var n;t.exports=(n=n||function(t,e){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==ro&&ro.crypto&&(n=ro.crypto),!n)try{n=xo}catch(t){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),i={},u=i.lib={},c=u.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=u.WordArray=c.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var u=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=u<<24-(r+i)%4*8}else for(var c=0;c<o;c+=4)e[r+c>>>2]=n[c>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(r());return new a.init(e,t)}}),f=i.enc={},l=f.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new a.init(n,e/2)}},s=f.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new a.init(n,e)}},p=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(s.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return s.parse(unescape(encodeURIComponent(t)))}},d=u.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n,r=this._data,o=r.words,i=r.sigBytes,u=this.blockSize,c=i/(4*u),f=(c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0))*u,l=t.min(4*f,i);if(f){for(var s=0;s<f;s+=u)this._doProcessBlock(o,s);n=o.splice(0,f),r.sigBytes-=l}return new a.init(n,l)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});u.Hasher=d.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=i.algo={};return i}(Math),n)}(Oo)),Ao}!function(t,e){var n;t.exports=(n=So(),function(){var t=n,e=t.lib.WordArray;function r(t,n,r){for(var o=[],i=0,u=0;u<n;u++)if(u%4){var c=r[t.charCodeAt(u-1)]<<u%4*2|r[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=c<<24-i%4*8,i++}return e.create(o,i)}t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var o=[],i=0;i<n;i+=3)for(var u=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,c=0;c<4&&i+.75*c<n;c++)o.push(r.charAt(u>>>6*(3-c)&63));var a=r.charAt(64);if(a)for(;o.length%4;)o.push(a);return o.join("")},parse:function(t){var e=t.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var u=n.charAt(64);if(u){var c=t.indexOf(u);-1!==c&&(e=c)}return r(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)}(_o);var Bo=wo,ko={};!function(t,e){var n;t.exports=(n=So(),function(){if("function"==typeof ArrayBuffer){var t=n.lib.WordArray,e=t.init,r=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=t[o]<<24-o%4*8;e.call(this,r,n)}else e.apply(this,arguments)};r.prototype=t}}(),n.lib.WordArray)}({get exports(){return ko},set exports(t){ko=t}});var Uo=ko;function Po(t){if(!vo(t))return"";return Uo.create(t).toString(Bo)}function zo(t){if(!Gr(t))return new Uint8Array;let e=Bo.parse(t),n=e.words,r=e.sigBytes,o=new Uint8Array(r);for(let t=0;t<r;t++){let e=n[t>>>2]>>>24-t%4*8&255;o[t]=e}return o}function Co(t){return yo(t)?Po(function(t){return yo(t)?new Uint8Array(t):new Uint8Array}(t)):""}function Eo(t){if(!Gr(t))return new Uint16Array;let e=function(t){return vo(t)?new Uint16Array(t):new Uint16Array}(zo(t));return e}let Mo="[Uint8Array]::";let Io="[Uint16Array]::";let To={tagU8A:Mo,u8arr2b64:function(t){return vo(t)?Mo+Po(t):t},b642u8arr:function(t){return Gr(t)&&go(t,Mo.length)===Mo?zo(t=jo(t,Mo.length)):t},tagU16A:Io,u16arr2b64:function(t){return yo(t)?Io+Co(t):t},b642u16arr:function(t){return Gr(t)&&go(t,Io.length)===Io?Eo(t=jo(t,Io.length)):t}};function Do(t){return"[object Array]"===Object.prototype.toString.call(t)}function Fo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(n=t,"[object Undefined]"===Object.prototype.toString.call(n))return"";var n;if(Gr(e))e=[e];else if(!Do(e))return"";let r="";try{r=JSON.stringify(t,(function(t,n){return e.indexOf("Uint8Array")>=0&&(n=To.u8arr2b64(n)),e.indexOf("Uint16Array")>=0&&(n=To.u16arr2b64(n)),n}))}catch(t){r=""}return r}function No(t,e,n,r,o){let i=function(t,e,n){e=(n?ao(t,e,n):void 0===e)?1:lo(Qr(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var o=0,i=0,u=Array(fo(r/e));o<r;)u[i++]=co(t,o,o+=e);return u}(Fo(n),e),u=no(),c=i.length;ho(i,(function(e,n){e=po(e,"");let i=`${u}|${n}|${c}|${e}`;t.send(i,(function(t){t&&S(o)&&o(t)})),S(r)&&r((n+1)/c*100)}))}var Lo=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function $o(t){return Lo.test(t)}var Ro=At&&At.isRegExp,Qo=Ro?jt(Ro):function(t){return et(t)&&"[object RegExp]"==w(t)};var Go="\\ud800-\\udfff",Wo="["+Go+"]",qo="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Vo="\\ud83c[\\udffb-\\udfff]",Ho="[^"+Go+"]",Jo="(?:\\ud83c[\\udde6-\\uddff]){2}",Ko="[\\ud800-\\udbff][\\udc00-\\udfff]",Xo="(?:"+qo+"|"+Vo+")"+"?",Yo="[\\ufe0e\\ufe0f]?",Zo=Yo+Xo+("(?:\\u200d(?:"+[Ho,Jo,Ko].join("|")+")"+Yo+Xo+")*"),ti="(?:"+[Ho+qo+"?",qo,Jo,Ko,Wo].join("|")+")",ei=RegExp(Vo+"(?="+Vo+")|"+ti+Zo,"g");function ni(t){return $o(t)?function(t){return t.match(ei)||[]}(t):function(t){return t.split("")}(t)}var ri=4294967295;function oi(t,e,n){return n&&"number"!=typeof n&&ao(t,e,n)&&(e=n=void 0),(n=void 0===n?ri:n>>>0)?(t=kn(t))&&("string"==typeof e||null!=e&&!Qo(e))&&!(e=Bn(e))&&$o(t)?(r=ni(t),o=0,i=n,u=r.length,i=void 0===i?u:i,!o&&i>=u?r:co(r,o,i)):t.split(e,n):[];var r,o,i,u}function ii(t,e,n){var r=null==t?0:t.length;return r?co(t,(e=n||void 0===e?1:Qr(e))<0?0:e,r):[]}var ui=Math.ceil,ci=Math.max;var ai=function(t){return function(e,n,r){return r&&"number"!=typeof r&&ao(e,n,r)&&(n=r=void 0),e=Rr(e),void 0===n?(n=e,e=0):n=Rr(n),function(t,e,n,r){for(var o=-1,i=ci(ui((e-t)/(n||1)),0),u=Array(i);i--;)u[r?i:++o]=t,t+=n;return u}(e,n,r=void 0===r?e<n?1:-1:Rr(r),t)}}(),fi=ai;function li(t){return"[object Object]"===Object.prototype.toString.call(t)}let si={};function pi(t,e){let n=oi(t,"|"),r=n[0],o=Nr(n[1]),i=Nr(n[2]),u=po(ii(n,3),"|");var c,a;if(a=r,li(c=si)&&(Wr(a)||qr(a))&&a in c||(si[r]={}),si[r]["_"+o]=u,o===i-1){let t="";ho(fi(i),(function(e){t+=si[r]["_"+e]})),delete si[r];let n=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(Gr(e))e=[e];else if(!Do(e))return{};let n={};try{n=JSON.parse(t,(function(t,n){return e.indexOf("Uint8Array")>=0&&(n=To.b642u8arr(n)),e.indexOf("Uint16Array")>=0&&(n=To.b642u16arr(n)),n}))}catch(t){n={}}return n}(t);e(n)}}function di(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.port||(e.port=8080),e.strSplitLength||(e.strSplitLength=1e6);let n=new uo;function r(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];setTimeout((()=>{n.emit(t,...r)}),1)}let o={port:e.port,perMessageDeflate:{zlibDeflateOptions:{chunkSize:1024,memLevel:7,level:3},zlibInflateOptions:{chunkSize:10240},clientNoContextTakeover:!0,serverNoContextTakeover:!0,serverMaxWindowBits:10,concurrencyLimit:10,threshold:1024}},i=null;try{i=new t.WebSocketServer(o)}catch(t){u({msg:"can not create websocket",err:t})}if(!i)return n;function u(t){r("error",t)}function c(){r("clientChange",a)}r("open");let a=[];return i.on("connection",(function(o,i){function f(n,r){o.readyState===t.OPEN&&No(o,e.strSplitLength,n,r,(function(t){u({msg:"can not send message",err:t})}))}function l(t){let e=En(t,"_mode","");if("execute"===e){r("execute",En(t,"func",""),En(t,"input"),(function(e){t.output=e,delete t.input,f(t,null)}),f)}else"broadcast"===e?r("broadcast",En(t,"data")):"deliver"===e?r("deliver",En(t,"data")):u({msg:"can not find _mode in data",err:t})}a.push(o),c(),o.on("close",(function(){a=a.filter((function(t){return t!==o})),c()})),o.sendData=f,o.on("message",(function(t){pi(t,l)})),n.on("triggerBroadcast",(function(t,e){f({_mode:"broadcast",data:t},e)}))})),n.broadcast=function(t){r("triggerBroadcast",t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){})},n}function hi(t,e){return null==(t=function(t,e){return e.length<2?t:Cn(t,co(e,0,-1))}(t,e=Un(e,t)))||delete t[zn((n=e,r=null==n?0:n.length,r?n[r-1]:void 0))];var n,r}var vi="[object Object]",yi=Function.prototype,bi=Object.prototype,gi=yi.toString,ji=bi.hasOwnProperty,wi=gi.call(Object);function _i(t){return function(t){if(!et(t)||w(t)!=vi)return!1;var e=Jt(t);if(null===e)return!0;var n=ji.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&gi.call(n)==wi}(t)?void 0:t}var mi=s?s.isConcatSpreadable:void 0;function Ai(t){return at(t)||ct(t)||!!(mi&&t&&t[mi])}function Oi(t,e,n,r,o){var i=-1,u=t.length;for(n||(n=Ai),o||(o=[]);++i<u;){var c=t[i];e>0&&n(c)?e>1?Oi(c,e-1,n,r,o):Ht(o,c):r||(o[o.length]=c)}return o}function xi(t){return(null==t?0:t.length)?Oi(t,1):[]}var Si=Math.max;var Bi=K?function(t,e){return K(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:_r,ki=Bi,Ui=Date.now;var Pi=function(t){var e=0,n=0;return function(){var r=Ui(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(ki),zi=Pi;var Ci=function(t){return zi(function(t,e,n){return e=Si(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Si(r.length-e,0),u=Array(i);++o<i;)u[o]=r[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=r[o];return c[e]=n(u),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,c)}}(t,void 0,xi),t+"")}((function(t,e){var n={};if(null==t)return n;var r=!1;e=An(e,(function(e){return e=Un(e,t),r||(r=e.length>1),e})),tt(t,te(t),n),r&&(n=on(n,7,_i));for(var o=e.length;o--;)hi(n,e[o]);return n})),Ei=Ci,Mi="[object String]";var Ii=mr("length"),Ti="\\ud800-\\udfff",Di="["+Ti+"]",Fi="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ni="\\ud83c[\\udffb-\\udfff]",Li="[^"+Ti+"]",$i="(?:\\ud83c[\\udde6-\\uddff]){2}",Ri="[\\ud800-\\udbff][\\udc00-\\udfff]",Qi="(?:"+Fi+"|"+Ni+")"+"?",Gi="[\\ufe0e\\ufe0f]?",Wi=Gi+Qi+("(?:\\u200d(?:"+[Li,$i,Ri].join("|")+")"+Gi+Qi+")*"),qi="(?:"+[Li+Fi+"?",Fi,$i,Ri,Di].join("|")+")",Vi=RegExp(Ni+"(?="+Ni+")|"+qi+Wi,"g");function Hi(t){return $o(t)?function(t){for(var e=Vi.lastIndex=0;Vi.test(t);)++e;return e}(t):Ii(t)}var Ji="[object Map]",Ki="[object Set]";function Xi(t){if(null==t)return 0;if(Mt(t))return"string"==typeof(e=t)||!at(e)&&et(e)&&w(e)==Mi?Hi(t):t.length;var e,n=ye(t);return n==Ji||n==Ki?t.size:Et(t).length}function Yi(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}function Zi(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function tu(t,e){let n=Yi();if(!Do(t)&&!li(t))return n.reject("rs is not an array or object"),n;let r=!1;if(li(t)){r=!0;let e=[];ho(t,((t,n)=>{e.push({k:n,v:t})})),t=e}Zi(e)||(e=function(t){return t});let o=-1,i=[];return t.reduce((function(t,n){return t.then((function(t){i.push(t),o+=1;let u=o,c=n;return r&&(u=n.k,c=n.v),Zi(e)?e(c,u):c}))}),Promise.resolve()).then((function(t){i.push(t),i=ii(i),n.resolve(i)})).catch((function(t){n.reject(t)})),n}function eu(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.url||(t.url="mongodb://127.0.0.1:27017"),t.db||(t.db="worm"),t.cl||(t.cl="test");let o=new e.EventEmitter,i=n.MongoClient;async function u(e){let n=!1;e=an(e);let r=new i(t.url),u=null;try{let i=r.db(t.db).collection(t.cl);Do(e)||(e=[e]),e=Pr(e,(function(t){return t.id||(t.id=no()),t})),u=await i.insertMany(e),u.insertedCount>0?(u={n:Xi(e),nInserted:u.insertedCount,ok:u.acknowledged?1:0},o.emit("change","insert",e,u)):(n=!0,u="no insert data")}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u}async function c(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=!1,r=null;try{let n=e.find(t);r=await n.toArray()}catch(t){n=!0,r=t}return n?Promise.reject(r):r}return o.select=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,r=new i(t.url),o=null;try{let n=r.db(t.db).collection(t.cl).find(e);o=await n.toArray(),o=Pr(o,(function(t){return t=Ei(t,"_id")}))}catch(t){n=!0,o=t}finally{await r.close()}return n?Promise.reject(o):o},o.insert=u,o.save=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!1;e=an(e);let c=En(n,"autoInsert",!0),a=En(n,"atomic",!1),f=new i(t.url),l=null;try{let n=f.db(t.db).collection(t.cl);Do(e)||(e=[e]);let r=null;r=a?"findOneAndUpdate":"updateOne",l=await tu(e,(async t=>{let e=null;return e=await n[r]({id:t.id},{$set:t}),e=e.lastErrorObject?{n:e.lastErrorObject.n,nModified:e.lastErrorObject.updatedExisting?1:0,ok:1}:{n:e.matchedCount,nModified:e.modifiedCount,ok:e.acknowledged?1:0},c&&0===e.n&&(e=await u(t)),e})),o.emit("change","save",e,l)}catch(t){r=!0,l=t}finally{await f.close()}return r?Promise.reject(l):l},o.del=async function(e){let n=!1;e=an(e);let r=new i(t.url),u=null;try{let n=r.db(t.db).collection(t.cl);Do(e)||(e=[e]),u=await tu(e,(async t=>{let e=null;return e=await n.deleteOne({id:t.id}),e={n:e.deletedCount,nDeleted:e.deletedCount,ok:e.acknowledged?1:0},e})),o.emit("change","del",e,u)}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u},o.delAll=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1,r=new i(t.url),u=null;try{let n=r.db(t.db).collection(t.cl);u=await n.deleteMany(e),u={n:u.deletedCount,nDeleted:u.deletedCount,ok:u.acknowledged?1:0},o.emit("change","delAll",null,u)}catch(t){n=!0,u=t}finally{await r.close()}return n?Promise.reject(u):u},o.selectGfs=async function(e){let r=!1,o=new i(t.url),u=null;try{u=await(async e=>{let r=Yi(),i=o.db(t.db),u=new n.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:t.cl}),c=Buffer.from(""),a=u.openDownloadStreamByName(e);return a.on("data",(function(t){c=Buffer.concat([c,t])})),a.on("error",(function(t){r.reject(t)})),a.on("end",(function(){let t=new Uint8Array(c);c=null,r.resolve(t)})),r})(e)}catch(t){r=!0,u=t}finally{await o.close()}return r?Promise.reject(u):u},o.insertGfs=async function(e){let u=!1,c=no(),a=Buffer.from(e),f=new i(t.url),l=null;try{l=await(async(e,o)=>{let i=Yi(),u=f.db(t.db),c=new n.GridFSBucket(u,{chunkSizeBytes:10485760,bucketName:t.cl}),a=new r.Readable;return a._read=()=>{},a.push(o),a.push(null),a.pipe(c.openUploadStream(e)).on("error",(function(t){i.reject(t)})).on("finish",(function(){let t={n:1,ok:1,id:e};i.resolve(t)})),i})(c,a),o.emit("change","insertGfs",null,l)}catch(t){u=!0,l=t}finally{await f.close()}return u?Promise.reject(l):l},o.delGfs=async function(e){let r=!1,u=new i(t.url),a=null;try{let r=u.db(t.db),i=new n.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:t.cl});if(a=await c({filename:e},i),0===a.length)a=`can not find id[${e}]`;else if(a.length>1)a=`duplicate id[${e}]`;else{let t=a[0]._id;a=await i.delete(t),a={n:1,nDeleted:1,ok:1},o.emit("change","delGfs",null,a)}}catch(t){r=!0,a=t}finally{await u.close()}return r?Promise.reject(a):a},o.delAllGfs=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1,u=new i(t.url),a=null;try{let r=u.db(t.db),i=new n.GridFSBucket(r,{chunkSizeBytes:10485760,bucketName:t.cl});a=await c(e,i);let f=Xi(a),l=Pr(a,(function(t){return async function(t,e){let n=!1,r=null;try{r=await e.delete(t),r={n:1,nDeleted:1,ok:1}}catch(t){n=!0,r=t}return n?Promise.reject(r):r}(t._id,i)}));a=await Promise.all(l),a={n:f,ok:1},o.emit("change","delAllGfs",null,a)}catch(t){r=!0,a=t}finally{await u.close()}return r?Promise.reject(a):a},o}return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=an(t),t.mongoUrl||(t.mongoUrl="mongodb://127.0.0.1:27017"),t.mongoDb||(t.mongoDb="wqws"),t.mongoCl||(t.mongoCl="queues"),t.port||(t.port=8080);let e=eu({url:t.mongoUrl,db:t.mongoDb,cl:t.mongoCl}),n=new di(t);return n.on("execute",(async function(t,r,o,i){let u,c=En(r,"topic",null);if("pushQueue"===t){let t=no(),i=En(r,"input",null),a=En(r,"option"),f={topic:c,id:t,input:i,output:null,transData:En(a,"transData",null),timeStart:En(a,"timeStart",null),timeExp:En(a,"timeExp",null),timeTakeStart:En(a,"timeTakeStart",null),timeTakeExp:En(a,"timeTakeExp",null),state:"ready"};await e.insert(f).then((function(e){n.emit(c,{topic:c,id:t,input:f.input,output:f.output,state:f.state}),u="success"})).catch((function(t){u={err:t}})),o(u)}else if("modifyQueue"===t){let t=En(r,"id",null);if(null!==t){let o=En(r,"input",null),i=En(r,"output",null),a=En(r,"state",null),f={id:t,output:i,state:a};await e.save(f,{atomic:!0}).then((function(e){n.emit(c,{topic:c,id:t,input:o,output:i,state:a}),u="success"})).catch((function(t){u={err:t}}))}else u={err:"can not find id"};o(u)}else if("subTopic"===t)n.deliverQueue=function(t){i({_mode:"deliver",data:t})},n.on(c,n.deliverQueue),u="success",o(u);else if("unsubTopic"===t)n.off(c,n.deliverQueue),n.deliverQueue=null,u="success",o(u);else if("delQueueByTopic"===t)await e.delAll({topic:c}).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u);else if("delQueueByID"===t){let t=En(r,"id",null);null!==t?await e.delAll({id:t}).then((function(t){u="success"})).catch((function(t){u={err:t}})):u={err:"can not find id"},o(u)}else if("delQueueByIDs"===t){let t=Pr(En(r,"ids",null),(function(t){return e.delAll({id:t})}));await Promise.all(t).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u)}else if("delQueueByMatches"===t){let t=En(r,"find",null);await e.delAll(t).then((function(t){u="success"})).catch((function(t){u={err:t}})),o(u)}else if("getQueueByTopic"===t)await e.select({topic:c}).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u);else if("getQueueByID"===t){let t=En(r,"id",null);null!==t?await e.select({id:t}).then((function(t){u=t})).catch((function(t){u={err:t}})):u={err:"can not find id"},o(u)}else if("getQueueByIDs"===t){let t=Pr(En(r,"ids",null),(function(t){return e.select({id:t})}));await Promise.all(t).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u)}else if("getQueueByMatches"===t){let t=En(r,"find",null);await e.select(t).then((function(t){u=t})).catch((function(t){u={err:t}})),o(u)}})),n}}));
//# sourceMappingURL=w-runqws-server.umd.js.map
