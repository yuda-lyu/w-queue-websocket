/*!
 * w-runqws-server v1.0.24
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ws"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","mongodb","stream"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-runqws-server"]=e(t.ws,t.mongodb,t.stream)}(this,(function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(t),i=r(e),u=r(n);function a(t,e,n,r,o,i,u){try{var a=t[i](u),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function u(t){a(i,r,o,u,c,"next",t)}function c(t){a(i,r,o,u,c,"throw",t)}u(void 0)}))}}function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}function v(t){var e={exports:{}};return t(e,e.exports),e.exports}var p=v((function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),u=new E(r||[]);return i._invoke=function(t,e,n){var r=v;return function(o,i){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw i;return U()}for(n.method=o,n.arg=i;;){var u=n.delegate;if(u){var a=k(u,n);if(a){if(a===y)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===v)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?d:p,c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=d,n.method="throw",n.arg=c.arg)}}}(t,n,u),i}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var v="suspendedStart",p="suspendedYield",h="executing",d="completed",y={};function b(){}function g(){}function m(){}var w={};c(w,i,(function(){return this}));var _=Object.getPrototypeOf,j=_&&_(_(B([])));j&&j!==n&&r.call(j,i)&&(w=j);var x=m.prototype=b.prototype=Object.create(w);function O(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function A(t,e){function n(o,i,u,a){var c=l(t[o],t,i);if("throw"!==c.type){var s=c.arg,v=s.value;return v&&"object"===f(v)&&r.call(v,"__await")?e.resolve(v.__await).then((function(t){n("next",t,u,a)}),(function(t){n("throw",t,u,a)})):e.resolve(v).then((function(t){s.value=t,u(s)}),(function(t){return n("throw",t,u,a)}))}a(c.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}}function k(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,k(t,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=l(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function B(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,u=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return u.next=u}}return{next:U}}function U(){return{value:e,done:!0}}return g.prototype=m,c(x,"constructor",m),c(m,"constructor",g),g.displayName=c(m,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,a,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},O(A.prototype),c(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var u=new A(s(e,n,r,o),i);return t.isGeneratorFunction(n)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},O(x),c(x,a,"Generator"),c(x,i,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=B,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var u=this.tryEntries[i],a=u.completion;if("root"===u.tryLoc)return o("end");if(u.tryLoc<=this.prev){var c=r.call(u,"catchLoc"),f=r.call(u,"finallyLoc");if(c&&f){if(this.prev<u.catchLoc)return o(u.catchLoc,!0);if(this.prev<u.finallyLoc)return o(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return o(u.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return o(u.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=t,u.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(u)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;L(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:B(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":f(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),h=p;var d=function(){this.__data__=[],this.size=0};var y=function(t,e){return t===e||t!=t&&e!=e};var b=function(t,e){for(var n=t.length;n--;)if(y(t[n][0],e))return n;return-1},g=Array.prototype.splice;var m=function(t){var e=this.__data__,n=b(e,t);return!(n<0)&&(n==e.length-1?e.pop():g.call(e,n,1),--this.size,!0)};var w=function(t){var e=this.__data__,n=b(e,t);return n<0?void 0:e[n][1]};var _=function(t){return b(this.__data__,t)>-1};var j=function(t,e){var n=this.__data__,r=b(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function x(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}x.prototype.clear=d,x.prototype.delete=m,x.prototype.get=w,x.prototype.has=_,x.prototype.set=j;var O=x;var A=function(){this.__data__=new O,this.size=0};var k=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var S=function(t){return this.__data__.get(t)};var L=function(t){return this.__data__.has(t)},E="object"==f(s)&&s&&s.Object===Object&&s,B="object"==("undefined"==typeof self?"undefined":f(self))&&self&&self.Object===Object&&self,U=E||B||Function("return this")(),C=U.Symbol,P=Object.prototype,T=P.hasOwnProperty,z=P.toString,M=C?C.toStringTag:void 0;var N=function(t){var e=T.call(t,M),n=t[M];try{t[M]=void 0;var r=!0}catch(t){}var o=z.call(t);return r&&(e?t[M]=n:delete t[M]),o},F=Object.prototype.toString;var I=function(t){return F.call(t)},D=C?C.toStringTag:void 0;var R=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":D&&D in Object(t)?N(t):I(t)};var G=function(t){var e=f(t);return null!=t&&("object"==e||"function"==e)};var $,Q=function(t){if(!G(t))return!1;var e=R(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},W=U["__core-js_shared__"],q=($=/[^.]+$/.exec(W&&W.keys&&W.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var V=function(t){return!!q&&q in t},H=Function.prototype.toString;var J=function(t){if(null!=t){try{return H.call(t)}catch(t){}try{return t+""}catch(t){}}return""},K=/^\[object .+?Constructor\]$/,Y=Function.prototype,X=Object.prototype,Z=Y.toString,tt=X.hasOwnProperty,et=RegExp("^"+Z.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nt=function(t){return!(!G(t)||V(t))&&(Q(t)?et:K).test(J(t))};var rt=function(t,e){return null==t?void 0:t[e]};var ot=function(t,e){var n=rt(t,e);return nt(n)?n:void 0},it=ot(U,"Map"),ut=ot(Object,"create");var at=function(){this.__data__=ut?ut(null):{},this.size=0};var ct=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ft=Object.prototype.hasOwnProperty;var st=function(t){var e=this.__data__;if(ut){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ft.call(e,t)?e[t]:void 0},lt=Object.prototype.hasOwnProperty;var vt=function(t){var e=this.__data__;return ut?void 0!==e[t]:lt.call(e,t)};var pt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ut&&void 0===e?"__lodash_hash_undefined__":e,this};function ht(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ht.prototype.clear=at,ht.prototype.delete=ct,ht.prototype.get=st,ht.prototype.has=vt,ht.prototype.set=pt;var dt=ht;var yt=function(){this.size=0,this.__data__={hash:new dt,map:new(it||O),string:new dt}};var bt=function(t){var e=f(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var gt=function(t,e){var n=t.__data__;return bt(e)?n["string"==typeof e?"string":"hash"]:n.map};var mt=function(t){var e=gt(this,t).delete(t);return this.size-=e?1:0,e};var wt=function(t){return gt(this,t).get(t)};var _t=function(t){return gt(this,t).has(t)};var jt=function(t,e){var n=gt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function xt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}xt.prototype.clear=yt,xt.prototype.delete=mt,xt.prototype.get=wt,xt.prototype.has=_t,xt.prototype.set=jt;var Ot=xt;var At=function(t,e){var n=this.__data__;if(n instanceof O){var r=n.__data__;if(!it||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ot(r)}return n.set(t,e),this.size=n.size,this};function kt(t){var e=this.__data__=new O(t);this.size=e.size}kt.prototype.clear=A,kt.prototype.delete=k,kt.prototype.get=S,kt.prototype.has=L,kt.prototype.set=At;var St=kt;var Lt=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},Et=function(){try{var t=ot(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Bt=function(t,e,n){"__proto__"==e&&Et?Et(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Ut=Object.prototype.hasOwnProperty;var Ct=function(t,e,n){var r=t[e];Ut.call(t,e)&&y(r,n)&&(void 0!==n||e in t)||Bt(t,e,n)};var Pt=function(t,e,n,r){var o=!n;n||(n={});for(var i=-1,u=e.length;++i<u;){var a=e[i],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),o?Bt(n,a,c):Ct(n,a,c)}return n};var Tt=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r};var zt=function(t){return null!=t&&"object"==f(t)};var Mt=function(t){return zt(t)&&"[object Arguments]"==R(t)},Nt=Object.prototype,Ft=Nt.hasOwnProperty,It=Nt.propertyIsEnumerable,Dt=Mt(function(){return arguments}())?Mt:function(t){return zt(t)&&Ft.call(t,"callee")&&!It.call(t,"callee")},Rt=Dt,Gt=Array.isArray;var $t=function(){return!1},Qt=v((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?U.Buffer:void 0,i=(o?o.isBuffer:void 0)||$t;t.exports=i})),Wt=/^(?:0|[1-9]\d*)$/;var qt=function(t,e){var n=f(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Wt.test(t))&&t>-1&&t%1==0&&t<e};var Vt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Ht={};Ht["[object Float32Array]"]=Ht["[object Float64Array]"]=Ht["[object Int8Array]"]=Ht["[object Int16Array]"]=Ht["[object Int32Array]"]=Ht["[object Uint8Array]"]=Ht["[object Uint8ClampedArray]"]=Ht["[object Uint16Array]"]=Ht["[object Uint32Array]"]=!0,Ht["[object Arguments]"]=Ht["[object Array]"]=Ht["[object ArrayBuffer]"]=Ht["[object Boolean]"]=Ht["[object DataView]"]=Ht["[object Date]"]=Ht["[object Error]"]=Ht["[object Function]"]=Ht["[object Map]"]=Ht["[object Number]"]=Ht["[object Object]"]=Ht["[object RegExp]"]=Ht["[object Set]"]=Ht["[object String]"]=Ht["[object WeakMap]"]=!1;var Jt=function(t){return zt(t)&&Vt(t.length)&&!!Ht[R(t)]};var Kt=function(t){return function(e){return t(e)}},Yt=v((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n&&E.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Xt=Yt&&Yt.isTypedArray,Zt=Xt?Kt(Xt):Jt,te=Object.prototype.hasOwnProperty;var ee=function(t,e){var n=Gt(t),r=!n&&Rt(t),o=!n&&!r&&Qt(t),i=!n&&!r&&!o&&Zt(t),u=n||r||o||i,a=u?Tt(t.length,String):[],c=a.length;for(var f in t)!e&&!te.call(t,f)||u&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||qt(f,c))||a.push(f);return a},ne=Object.prototype;var re=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ne)};var oe=function(t,e){return function(n){return t(e(n))}},ie=oe(Object.keys,Object),ue=Object.prototype.hasOwnProperty;var ae=function(t){if(!re(t))return ie(t);var e=[];for(var n in Object(t))ue.call(t,n)&&"constructor"!=n&&e.push(n);return e};var ce=function(t){return null!=t&&Vt(t.length)&&!Q(t)};var fe=function(t){return ce(t)?ee(t):ae(t)};var se=function(t,e){return t&&Pt(e,fe(e),t)};var le=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},ve=Object.prototype.hasOwnProperty;var pe=function(t){if(!G(t))return le(t);var e=re(t),n=[];for(var r in t)("constructor"!=r||!e&&ve.call(t,r))&&n.push(r);return n};var he=function(t){return ce(t)?ee(t,!0):pe(t)};var de=function(t,e){return t&&Pt(e,he(e),t)},ye=v((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?U.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=i?i(n):new t.constructor(n);return t.copy(r),r}}));var be=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e};var ge=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var u=t[n];e(u,n,t)&&(i[o++]=u)}return i};var me=function(){return[]},we=Object.prototype.propertyIsEnumerable,_e=Object.getOwnPropertySymbols,je=_e?function(t){return null==t?[]:(t=Object(t),ge(_e(t),(function(e){return we.call(t,e)})))}:me;var xe=function(t,e){return Pt(t,je(t),e)};var Oe=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t},Ae=oe(Object.getPrototypeOf,Object),ke=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Oe(e,je(t)),t=Ae(t);return e}:me;var Se=function(t,e){return Pt(t,ke(t),e)};var Le=function(t,e,n){var r=e(t);return Gt(t)?r:Oe(r,n(t))};var Ee=function(t){return Le(t,fe,je)};var Be=function(t){return Le(t,he,ke)},Ue=ot(U,"DataView"),Ce=ot(U,"Promise"),Pe=ot(U,"Set"),Te=ot(U,"WeakMap"),ze="[object Map]",Me="[object Promise]",Ne="[object Set]",Fe="[object WeakMap]",Ie="[object DataView]",De=J(Ue),Re=J(it),Ge=J(Ce),$e=J(Pe),Qe=J(Te),We=R;(Ue&&We(new Ue(new ArrayBuffer(1)))!=Ie||it&&We(new it)!=ze||Ce&&We(Ce.resolve())!=Me||Pe&&We(new Pe)!=Ne||Te&&We(new Te)!=Fe)&&(We=function(t){var e=R(t),n="[object Object]"==e?t.constructor:void 0,r=n?J(n):"";if(r)switch(r){case De:return Ie;case Re:return ze;case Ge:return Me;case $e:return Ne;case Qe:return Fe}return e});var qe=We,Ve=Object.prototype.hasOwnProperty;var He=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ve.call(t,"index")&&(n.index=t.index,n.input=t.input),n},Je=U.Uint8Array;var Ke=function(t){var e=new t.constructor(t.byteLength);return new Je(e).set(new Je(t)),e};var Ye=function(t,e){var n=e?Ke(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},Xe=/\w*$/;var Ze=function(t){var e=new t.constructor(t.source,Xe.exec(t));return e.lastIndex=t.lastIndex,e},tn=C?C.prototype:void 0,en=tn?tn.valueOf:void 0;var nn=function(t){return en?Object(en.call(t)):{}};var rn=function(t,e){var n=e?Ke(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var on=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return Ke(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return Ye(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return rn(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return Ze(t);case"[object Symbol]":return nn(t)}},un=Object.create,an=function(){function t(){}return function(e){if(!G(e))return{};if(un)return un(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var cn=function(t){return"function"!=typeof t.constructor||re(t)?{}:an(Ae(t))};var fn=function(t){return zt(t)&&"[object Map]"==qe(t)},sn=Yt&&Yt.isMap,ln=sn?Kt(sn):fn;var vn=function(t){return zt(t)&&"[object Set]"==qe(t)},pn=Yt&&Yt.isSet,hn=pn?Kt(pn):vn,dn="[object Arguments]",yn="[object Function]",bn="[object Object]",gn={};gn[dn]=gn["[object Array]"]=gn["[object ArrayBuffer]"]=gn["[object DataView]"]=gn["[object Boolean]"]=gn["[object Date]"]=gn["[object Float32Array]"]=gn["[object Float64Array]"]=gn["[object Int8Array]"]=gn["[object Int16Array]"]=gn["[object Int32Array]"]=gn["[object Map]"]=gn["[object Number]"]=gn[bn]=gn["[object RegExp]"]=gn["[object Set]"]=gn["[object String]"]=gn["[object Symbol]"]=gn["[object Uint8Array]"]=gn["[object Uint8ClampedArray]"]=gn["[object Uint16Array]"]=gn["[object Uint32Array]"]=!0,gn["[object Error]"]=gn[yn]=gn["[object WeakMap]"]=!1;var mn=function t(e,n,r,o,i,u){var a,c=1&n,f=2&n,s=4&n;if(r&&(a=i?r(e,o,i,u):r(e)),void 0!==a)return a;if(!G(e))return e;var l=Gt(e);if(l){if(a=He(e),!c)return be(e,a)}else{var v=qe(e),p=v==yn||"[object GeneratorFunction]"==v;if(Qt(e))return ye(e,c);if(v==bn||v==dn||p&&!i){if(a=f||p?{}:cn(e),!c)return f?Se(e,de(a,e)):xe(e,se(a,e))}else{if(!gn[v])return i?e:{};a=on(e,v,c)}}u||(u=new St);var h=u.get(e);if(h)return h;u.set(e,a),hn(e)?e.forEach((function(o){a.add(t(o,n,r,o,e,u))})):ln(e)&&e.forEach((function(o,i){a.set(i,t(o,n,r,i,e,u))}));var d=l?void 0:(s?f?Be:Ee:f?he:fe)(e);return Lt(d||e,(function(o,i){d&&(o=e[i=o]),Ct(a,i,t(o,n,r,i,e,u))})),a};var wn=function(t){return mn(t,5)};var _n=function(t){return"symbol"==f(t)||zt(t)&&"[object Symbol]"==R(t)},jn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xn=/^\w*$/;var On=function(t,e){if(Gt(t))return!1;var n=f(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!_n(t))||(xn.test(t)||!jn.test(t)||null!=e&&t in Object(e))};function An(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function n(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var u=t.apply(this,r);return n.cache=i.set(o,u)||i,u};return n.cache=new(An.Cache||Ot),n}An.Cache=Ot;var kn=An;var Sn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ln=/\\(\\)?/g,En=function(t){var e=kn(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Sn,(function(t,n,r,o){e.push(r?o.replace(Ln,"$1"):n||t)})),e}));var Bn=function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o},Un=C?C.prototype:void 0,Cn=Un?Un.toString:void 0;var Pn=function t(e){if("string"==typeof e)return e;if(Gt(e))return Bn(e,t)+"";if(_n(e))return Cn?Cn.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n};var Tn=function(t){return null==t?"":Pn(t)};var zn=function(t,e){return Gt(t)?t:On(t,e)?[t]:En(Tn(t))};var Mn=function(t){if("string"==typeof t||_n(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var Nn=function(t,e){for(var n=0,r=(e=zn(e,t)).length;null!=t&&n<r;)t=t[Mn(e[n++])];return n&&n==r?t:void 0};var Fn=function(t,e,n){var r=null==t?void 0:Nn(t,e);return void 0===r?n:r};var In=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Dn=function(t){return this.__data__.has(t)};function Rn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Ot;++e<n;)this.add(t[e])}Rn.prototype.add=Rn.prototype.push=In,Rn.prototype.has=Dn;var Gn=Rn;var $n=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var Qn=function(t,e){return t.has(e)};var Wn=function(t,e,n,r,o,i){var u=1&n,a=t.length,c=e.length;if(a!=c&&!(u&&c>a))return!1;var f=i.get(t),s=i.get(e);if(f&&s)return f==e&&s==t;var l=-1,v=!0,p=2&n?new Gn:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var h=t[l],d=e[l];if(r)var y=u?r(d,h,l,e,t,i):r(h,d,l,t,e,i);if(void 0!==y){if(y)continue;v=!1;break}if(p){if(!$n(e,(function(t,e){if(!Qn(p,e)&&(h===t||o(h,t,n,r,i)))return p.push(e)}))){v=!1;break}}else if(h!==d&&!o(h,d,n,r,i)){v=!1;break}}return i.delete(t),i.delete(e),v};var qn=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n};var Vn=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Hn=C?C.prototype:void 0,Jn=Hn?Hn.valueOf:void 0;var Kn=function(t,e,n,r,o,i,u){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Je(t),new Je(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return y(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=qn;case"[object Set]":var c=1&r;if(a||(a=Vn),t.size!=e.size&&!c)return!1;var f=u.get(t);if(f)return f==e;r|=2,u.set(t,e);var s=Wn(a(t),a(e),r,o,i,u);return u.delete(t),s;case"[object Symbol]":if(Jn)return Jn.call(t)==Jn.call(e)}return!1},Yn=Object.prototype.hasOwnProperty;var Xn=function(t,e,n,r,o,i){var u=1&n,a=Ee(t),c=a.length;if(c!=Ee(e).length&&!u)return!1;for(var f=c;f--;){var s=a[f];if(!(u?s in e:Yn.call(e,s)))return!1}var l=i.get(t),v=i.get(e);if(l&&v)return l==e&&v==t;var p=!0;i.set(t,e),i.set(e,t);for(var h=u;++f<c;){var d=t[s=a[f]],y=e[s];if(r)var b=u?r(y,d,s,e,t,i):r(d,y,s,t,e,i);if(!(void 0===b?d===y||o(d,y,n,r,i):b)){p=!1;break}h||(h="constructor"==s)}if(p&&!h){var g=t.constructor,m=e.constructor;g==m||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m||(p=!1)}return i.delete(t),i.delete(e),p},Zn="[object Arguments]",tr="[object Array]",er="[object Object]",nr=Object.prototype.hasOwnProperty;var rr=function(t,e,n,r,o,i){var u=Gt(t),a=Gt(e),c=u?tr:qe(t),f=a?tr:qe(e),s=(c=c==Zn?er:c)==er,l=(f=f==Zn?er:f)==er,v=c==f;if(v&&Qt(t)){if(!Qt(e))return!1;u=!0,s=!1}if(v&&!s)return i||(i=new St),u||Zt(t)?Wn(t,e,n,r,o,i):Kn(t,e,c,n,r,o,i);if(!(1&n)){var p=s&&nr.call(t,"__wrapped__"),h=l&&nr.call(e,"__wrapped__");if(p||h){var d=p?t.value():t,y=h?e.value():e;return i||(i=new St),o(d,y,n,r,i)}}return!!v&&(i||(i=new St),Xn(t,e,n,r,o,i))};var or=function t(e,n,r,o,i){return e===n||(null==e||null==n||!zt(e)&&!zt(n)?e!=e&&n!=n:rr(e,n,r,o,t,i))};var ir=function(t,e,n,r){var o=n.length,i=o,u=!r;if(null==t)return!i;for(t=Object(t);o--;){var a=n[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=n[o])[0],f=t[c],s=a[1];if(u&&a[2]){if(void 0===f&&!(c in t))return!1}else{var l=new St;if(r)var v=r(f,s,c,t,e,l);if(!(void 0===v?or(s,f,3,r,l):v))return!1}}return!0};var ur=function(t){return t==t&&!G(t)};var ar=function(t){for(var e=fe(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,ur(o)]}return e};var cr=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}};var fr=function(t){var e=ar(t);return 1==e.length&&e[0][2]?cr(e[0][0],e[0][1]):function(n){return n===t||ir(n,t,e)}};var sr=function(t,e){return null!=t&&e in Object(t)};var lr=function(t,e,n){for(var r=-1,o=(e=zn(e,t)).length,i=!1;++r<o;){var u=Mn(e[r]);if(!(i=null!=t&&n(t,u)))break;t=t[u]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&Vt(o)&&qt(u,o)&&(Gt(t)||Rt(t))};var vr=function(t,e){return null!=t&&lr(t,e,sr)};var pr=function(t,e){return On(t)&&ur(e)?cr(Mn(t),e):function(n){var r=Fn(n,t);return void 0===r&&r===e?vr(n,t):or(e,r,3)}};var hr=function(t){return t};var dr=function(t){return function(e){return null==e?void 0:e[t]}};var yr=function(t){return function(e){return Nn(e,t)}};var br=function(t){return On(t)?dr(Mn(t)):yr(t)};var gr=function(t){return"function"==typeof t?t:null==t?hr:"object"==f(t)?Gt(t)?pr(t[0],t[1]):fr(t):br(t)};var mr=function(t){return function(e,n,r){for(var o=-1,i=Object(e),u=r(e),a=u.length;a--;){var c=u[t?a:++o];if(!1===n(i[c],c,i))break}return e}}();var wr=function(t,e){return function(n,r){if(null==n)return n;if(!ce(n))return t(n,r);for(var o=n.length,i=e?o:-1,u=Object(n);(e?i--:++i<o)&&!1!==r(u[i],i,u););return n}}((function(t,e){return t&&mr(t,e,fe)}));var _r=function(t,e){var n=-1,r=ce(t)?Array(t.length):[];return wr(t,(function(t,o,i){r[++n]=e(t,o,i)})),r};var jr=function(t,e){return(Gt(t)?Bn:_r)(t,gr(e))},xr=/\s/;var Or=function(t){for(var e=t.length;e--&&xr.test(t.charAt(e)););return e},Ar=/^\s+/;var kr=function(t){return t?t.slice(0,Or(t)+1).replace(Ar,""):t},Sr=/^[-+]0x[0-9a-f]+$/i,Lr=/^0b[01]+$/i,Er=/^0o[0-7]+$/i,Br=parseInt;var Ur=function(t){if("number"==typeof t)return t;if(_n(t))return NaN;if(G(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=G(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=kr(t);var n=Lr.test(t);return n||Er.test(t)?Br(t.slice(2),n?2:8):Sr.test(t)?NaN:+t},Cr=1/0;var Pr=function(t){return t?(t=Ur(t))===Cr||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Tr=function(t){var e=Pr(t),n=e%1;return e==e?n?e-n:e:0};var zr=function(t){return"number"==typeof t&&t==Tr(t)};function Mr(t){return"[object String]"===Object.prototype.toString.call(t)}function Nr(t){return!(!Mr(t)||""===t)}function Fr(t){var e=!1;return Nr(t)?e=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0),e}function Ir(t){return Fr(t)?Pr(t):0}var Dr=U.isFinite,Rr=Math.min;var Gr=function(t){var e=Math[t];return function(t,n){if(t=Ur(t),(n=null==n?0:Rr(Tr(n),292))&&Dr(t)){var r=(Tn(t)+"e").split("e"),o=e(r[0]+"e"+(+r[1]+n));return+((r=(Tn(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round");function $r(t){if(!Fr(t))return 0;t=Ir(t);var e=Gr(t);return"0"===String(e)?0:e}function Qr(t){return!!function(t){return!!Fr(t)&&(t=Ir(t),zr(t))}(t)&&$r(t)>0}var Wr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),qr=Wr.length;function Vr(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=Qr(t)?$r(t):32;for(var n=0;n<t;n++)e[n]=Wr[0|Math.random()*qr];var r=e.join("");return r}var Hr=v((function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,u){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,i||t,u),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,u=new Array(i);o<i;o++)u[o]=r[o].fn;return u},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,o,i,u){var a=n?n+t:t;if(!this._events[a])return!1;var c,f,s=this._events[a],l=arguments.length;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,e),!0;case 3:return s.fn.call(s.context,e,r),!0;case 4:return s.fn.call(s.context,e,r,o),!0;case 5:return s.fn.call(s.context,e,r,o,i),!0;case 6:return s.fn.call(s.context,e,r,o,i,u),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];s.fn.apply(s.context,c)}else{var v,p=s.length;for(f=0;f<p;f++)switch(s[f].once&&this.removeListener(t,s[f].fn,void 0,!0),l){case 1:s[f].fn.call(s[f].context);break;case 2:s[f].fn.call(s[f].context,e);break;case 3:s[f].fn.call(s[f].context,e,r);break;case 4:s[f].fn.call(s[f].context,e,r,o);break;default:if(!c)for(v=1,c=new Array(l-1);v<l;v++)c[v-1]=arguments[v];s[f].fn.apply(s[f].context,c)}}return!0},a.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||u(this,i);else{for(var c=0,f=[],s=a.length;c<s;c++)(a[c].fn!==e||o&&!a[c].once||r&&a[c].context!==r)&&f.push(a[c]);f.length?this._events[i]=1===f.length?f[0]:f:u(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&u(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}));function Jr(){return new Hr}var Kr=function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i};var Yr=function(t,e,n){if(!G(n))return!1;var r=f(e);return!!("number"==r?ce(n)&&qt(e,n.length):"string"==r&&e in n)&&y(n[e],t)},Xr=Math.ceil,Zr=Math.max;var to=function(t,e,n){e=(n?Yr(t,e,n):void 0===e)?1:Zr(Tr(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var o=0,i=0,u=Array(Xr(r/e));o<r;)u[i++]=Kr(t,o,o+=e);return u},eo=Array.prototype.join;var no=function(t,e){return null==t?"":eo.call(t,e)};var ro=function(t){return"function"==typeof t?t:hr};var oo=function(t,e){return(Gt(t)?Lt:wr)(t,ro(e))};function io(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function uo(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function ao(t,e){return Nr(t)&&Qr(e)?t.substring(0,e):""}function co(t,e){return Nr(t)&&Qr(e)?function(t,e){if(!Nr(t))return"";if(!Qr(e))return"";var n=t.length-e;return n<0&&(n=0),t.substr(n,e)}(t,t.length-e):""}var fo=l(Object.freeze({__proto__:null,default:{}})),so=v((function(t,e){var n;t.exports=(n=n||function(t,e){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==s&&s.crypto&&(n=s.crypto),!n)try{n=fo}catch(t){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),i={},u=i.lib={},a=u.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=u.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var u=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=u<<24-(r+i)%4*8}else for(var a=0;a<o;a+=4)e[r+a>>>2]=n[a>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],n=0;n<t;n+=4)e.push(r());return new c.init(e,t)}}),f=i.enc={},l=f.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new c.init(n,e/2)}},v=f.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new c.init(n,e)}},p=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(v.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return v.parse(unescape(encodeURIComponent(t)))}},h=u.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n,r=this._data,o=r.words,i=r.sigBytes,u=this.blockSize,a=i/(4*u),f=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*u,s=t.min(4*f,i);if(f){for(var l=0;l<f;l+=u)this._doProcessBlock(o,l);n=o.splice(0,f),r.sigBytes-=s}return new c.init(n,s)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});u.Hasher=h.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}});var d=i.algo={};return i}(Math),n)})),lo=v((function(t,e){var n;t.exports=(n=so,function(){var t=n,e=t.lib.WordArray;function r(t,n,r){for(var o=[],i=0,u=0;u<n;u++)if(u%4){var a=r[t.charCodeAt(u-1)]<<u%4*2|r[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return e.create(o,i)}t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var o=[],i=0;i<n;i+=3)for(var u=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<n;a++)o.push(r.charAt(u>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var e=t.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var u=n.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(e=a)}return r(t,e,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)})),vo=v((function(t,e){var n;t.exports=(n=so,function(){if("function"==typeof ArrayBuffer){var t=n.lib.WordArray,e=t.init,r=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=t[o]<<24-o%4*8;e.call(this,r,n)}else e.apply(this,arguments)};r.prototype=t}}(),n.lib.WordArray)}));function po(t){return io(t)?vo.create(t).toString(lo):""}function ho(t){if(!Mr(t))return new Uint8Array;for(var e=lo.parse(t),n=e.words,r=e.sigBytes,o=new Uint8Array(r),i=0;i<r;i++){var u=n[i>>>2]>>>24-i%4*8&255;o[i]=u}return o}function yo(t){return uo(t)?po(function(t){return uo(t)?new Uint8Array(t):new Uint8Array}(t)):""}function bo(t){if(!Mr(t))return new Uint16Array;var e=function(t){return io(t)?new Uint16Array(t):new Uint16Array}(ho(t));return e}var go="[Uint8Array]::";var mo="[Uint16Array]::";var wo={tagU8A:go,u8arr2b64:function(t){return io(t)?go+po(t):t},b642u8arr:function(t){return Mr(t)&&ao(t,go.length)===go?ho(t=co(t,go.length)):t},tagU16A:mo,u16arr2b64:function(t){return uo(t)?mo+yo(t):t},b642u16arr:function(t){return Mr(t)&&ao(t,mo.length)===mo?bo(t=co(t,mo.length)):t}};function _o(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function jo(t){return"[object Array]"===Object.prototype.toString.call(t)}function xo(t,e,n,r,o){var i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(_o(t))return"";if(Mr(e))e=[e];else if(!jo(e))return"";function n(t,n){return e.indexOf("Uint8Array")>=0&&(n=wo.u8arr2b64(n)),e.indexOf("Uint16Array")>=0&&(n=wo.u16arr2b64(n)),n}var r="";try{r=JSON.stringify(t,n)}catch(t){r=""}return r}(n),u=to(i,e),a=Vr(),c=u.length;oo(u,(function(e,n){e=no(e,"");var i="".concat(a,"|").concat(n,"|").concat(c,"|").concat(e);t.send(i,(function(t){t&&Q(o)&&o(t)})),Q(r)&&r((n+1)/c*100)}))}var Oo=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:Kr(t,e,n)},Ao=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var ko=function(t){return Ao.test(t)};var So=function(t){return zt(t)&&"[object RegExp]"==R(t)},Lo=Yt&&Yt.isRegExp,Eo=Lo?Kt(Lo):So;var Bo=function(t){return t.split("")},Uo="[\\ud800-\\udfff]",Co="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Po="\\ud83c[\\udffb-\\udfff]",To="[^\\ud800-\\udfff]",zo="(?:\\ud83c[\\udde6-\\uddff]){2}",Mo="[\\ud800-\\udbff][\\udc00-\\udfff]",No="(?:"+Co+"|"+Po+")"+"?",Fo="[\\ufe0e\\ufe0f]?",Io=Fo+No+("(?:\\u200d(?:"+[To,zo,Mo].join("|")+")"+Fo+No+")*"),Do="(?:"+[To+Co+"?",Co,zo,Mo,Uo].join("|")+")",Ro=RegExp(Po+"(?="+Po+")|"+Do+Io,"g");var Go=function(t){return t.match(Ro)||[]};var $o=function(t){return ko(t)?Go(t):Bo(t)};var Qo=function(t,e,n){return n&&"number"!=typeof n&&Yr(t,e,n)&&(e=n=void 0),(n=void 0===n?4294967295:n>>>0)?(t=Tn(t))&&("string"==typeof e||null!=e&&!Eo(e))&&!(e=Pn(e))&&ko(t)?Oo($o(t),0,n):t.split(e,n):[]};var Wo=function(t,e,n){var r=null==t?0:t.length;return r?(e=n||void 0===e?1:Tr(e),Kr(t,e<0?0:e,r)):[]},qo=Math.ceil,Vo=Math.max;var Ho=function(t,e,n,r){for(var o=-1,i=Vo(qo((e-t)/(n||1)),0),u=Array(i);i--;)u[r?i:++o]=t,t+=n;return u};var Jo=function(t){return function(e,n,r){return r&&"number"!=typeof r&&Yr(e,n,r)&&(n=r=void 0),e=Pr(e),void 0===n?(n=e,e=0):n=Pr(n),r=void 0===r?e<n?1:-1:Pr(r),Ho(e,n,r,t)}}();function Ko(t){return"[object Object]"===Object.prototype.toString.call(t)}var Yo={};function Xo(t,e){var n,r,o=Qo(t,"|"),i=o[0],u=Ur(o[1]),a=Ur(o[2]),c=no(Wo(o,3),"|");if(r=i,Ko(n=Yo)&&(Nr(r)||Fr(r))&&r in n||(Yo[i]={}),Yo[i]["_"+u]=c,u===a-1){var f="";oo(Jo(a),(function(t){f+=Yo[i]["_"+t]})),delete Yo[i];var s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(Mr(e))e=[e];else if(!jo(e))return{};function n(t,n){return e.indexOf("Uint8Array")>=0&&(n=wo.b642u8arr(n)),e.indexOf("Uint16Array")>=0&&(n=wo.b642u16arr(n)),n}var r={};try{r=JSON.parse(t,n)}catch(t){r={}}return r}(f);e(s)}}function Zo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.port||(e.port=8080),e.strSplitLength||(e.strSplitLength=1e6);var n=Jr();function r(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];setTimeout((function(){n.emit.apply(n,[t].concat(r))}),1)}var i={port:e.port,perMessageDeflate:{zlibDeflateOptions:{chunkSize:1024,memLevel:7,level:3},zlibInflateOptions:{chunkSize:10240},clientNoContextTakeover:!0,serverNoContextTakeover:!0,serverMaxWindowBits:10,concurrencyLimit:10,threshold:1024}},u=null;try{u=new t.WebSocketServer(i)}catch(t){c({msg:"can not create websocket",err:t})}if(!u)return n;function a(){r("open")}function c(t){r("error",t)}function f(){r("clientChange",s)}a();var s=[];return u.on("connection",(function(t,i){function u(n,r){t.readyState===o.default.OPEN&&xo(t,e.strSplitLength,n,r,(function(t){c({msg:"can not send message",err:t})}))}function a(t){var e=Fn(t,"_mode","");"execute"===e?r("execute",Fn(t,"func",""),Fn(t,"input"),(function(e){t.output=e,delete t.input,u(t,null)}),u):"broadcast"===e?r("broadcast",Fn(t,"data")):"deliver"===e?r("deliver",Fn(t,"data")):c({msg:"can not find _mode in data",err:t})}s.push(t),f(),t.on("close",(function(){s=s.filter((function(e){return e!==t})),f()})),t.sendData=u,t.on("message",(function(t){Xo(t,a)})),n.on("triggerBroadcast",(function(t,e){u({_mode:"broadcast",data:t},e)}))})),n.broadcast=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};r("triggerBroadcast",t,e)},n}var ti,ei="object"===("undefined"==typeof Reflect?"undefined":f(Reflect))?Reflect:null,ni=ei&&"function"==typeof ei.apply?ei.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};ti=ei&&"function"==typeof ei.ownKeys?ei.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var ri=Number.isNaN||function(t){return t!=t};function oi(){oi.init.call(this)}var ii=oi,ui=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}yi(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&yi(t,"error",e,n)}(t,o,{once:!0})}))};oi.EventEmitter=oi,oi.prototype._events=void 0,oi.prototype._eventsCount=0,oi.prototype._maxListeners=void 0;var ai=10;function ci(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+f(t))}function fi(t){return void 0===t._maxListeners?oi.defaultMaxListeners:t._maxListeners}function si(t,e,n,r){var o,i,u,a;if(ci(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),u=i[e]),void 0===u)u=i[e]=n,++t._eventsCount;else if("function"==typeof u?u=i[e]=r?[n,u]:[u,n]:r?u.unshift(n):u.push(n),(o=fi(t))>0&&u.length>o&&!u.warned){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=u.length,a=c,console&&console.warn&&console.warn(a)}return t}function li(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function vi(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=li.bind(r);return o.listener=n,r.wrapFn=o,o}function pi(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):di(o,o.length)}function hi(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function di(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function yi(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+f(t));t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(oi,"defaultMaxListeners",{enumerable:!0,get:function(){return ai},set:function(t){if("number"!=typeof t||t<0||ri(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ai=t}}),oi.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},oi.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||ri(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},oi.prototype.getMaxListeners=function(){return fi(this)},oi.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(e.length>0&&(i=e[0]),i instanceof Error)throw i;var u=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw u.context=i,u}var a=o[t];if(void 0===a)return!1;if("function"==typeof a)ni(a,this,e);else{var c=a.length,f=di(a,c);for(n=0;n<c;++n)ni(f[n],this,e)}return!0},oi.prototype.addListener=function(t,e){return si(this,t,e,!1)},oi.prototype.on=oi.prototype.addListener,oi.prototype.prependListener=function(t,e){return si(this,t,e,!0)},oi.prototype.once=function(t,e){return ci(e),this.on(t,vi(this,t,e)),this},oi.prototype.prependOnceListener=function(t,e){return ci(e),this.prependListener(t,vi(this,t,e)),this},oi.prototype.removeListener=function(t,e){var n,r,o,i,u;if(ci(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){u=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,u||e)}return this},oi.prototype.off=oi.prototype.removeListener,oi.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},oi.prototype.listeners=function(t){return pi(this,t,!0)},oi.prototype.rawListeners=function(t){return pi(this,t,!1)},oi.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):hi.call(t,e)},oi.prototype.listenerCount=hi,oi.prototype.eventNames=function(){return this._eventsCount>0?ti(this._events):[]},ii.once=ui;var bi=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};var gi=function(t,e){return e.length<2?t:Nn(t,Kr(e,0,-1))};var mi=function(t,e){return e=zn(e,t),null==(t=gi(t,e))||delete t[Mn(bi(e))]},wi=Function.prototype,_i=Object.prototype,ji=wi.toString,xi=_i.hasOwnProperty,Oi=ji.call(Object);var Ai=function(t){if(!zt(t)||"[object Object]"!=R(t))return!1;var e=Ae(t);if(null===e)return!0;var n=xi.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ji.call(n)==Oi};var ki=function(t){return Ai(t)?void 0:t},Si=C?C.isConcatSpreadable:void 0;var Li=function(t){return Gt(t)||Rt(t)||!!(Si&&t&&t[Si])};var Ei=function t(e,n,r,o,i){var u=-1,a=e.length;for(r||(r=Li),i||(i=[]);++u<a;){var c=e[u];n>0&&r(c)?n>1?t(c,n-1,r,o,i):Oe(i,c):o||(i[i.length]=c)}return i};var Bi=function(t){return(null==t?0:t.length)?Ei(t,1):[]};var Ui=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},Ci=Math.max;var Pi=function(t,e,n){return e=Ci(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Ci(r.length-e,0),u=Array(i);++o<i;)u[o]=r[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=r[o];return a[e]=n(u),Ui(t,this,a)}};var Ti=function(t){return function(){return t}},zi=Et?function(t,e){return Et(t,"toString",{configurable:!0,enumerable:!1,value:Ti(e),writable:!0})}:hr,Mi=Date.now;var Ni=function(t){var e=0,n=0;return function(){var r=Mi(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},Fi=Ni(zi);var Ii=function(t){return Fi(Pi(t,void 0,Bi),t+"")}((function(t,e){var n={};if(null==t)return n;var r=!1;e=Bn(e,(function(e){return e=zn(e,t),r||(r=e.length>1),e})),Pt(t,Be(t),n),r&&(n=mn(n,7,ki));for(var o=e.length;o--;)mi(n,e[o]);return n}));var Di=function(t){return"string"==typeof t||!Gt(t)&&zt(t)&&"[object String]"==R(t)},Ri=dr("length"),Gi="[\\ud800-\\udfff]",$i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Qi="\\ud83c[\\udffb-\\udfff]",Wi="[^\\ud800-\\udfff]",qi="(?:\\ud83c[\\udde6-\\uddff]){2}",Vi="[\\ud800-\\udbff][\\udc00-\\udfff]",Hi="(?:"+$i+"|"+Qi+")"+"?",Ji="[\\ufe0e\\ufe0f]?",Ki=Ji+Hi+("(?:\\u200d(?:"+[Wi,qi,Vi].join("|")+")"+Ji+Hi+")*"),Yi="(?:"+[Wi+$i+"?",$i,qi,Vi,Gi].join("|")+")",Xi=RegExp(Qi+"(?="+Qi+")|"+Yi+Ki,"g");var Zi=function(t){for(var e=Xi.lastIndex=0;Xi.test(t);)++e;return e};var tu=function(t){return ko(t)?Zi(t):Ri(t)};var eu=function(t){if(null==t)return 0;if(ce(t))return Di(t)?tu(t):t.length;var e=qe(t);return"[object Map]"==e||"[object Set]"==e?t.size:ae(t).length};function nu(){var t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}function ru(t){var e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function ou(t,e){var n=nu();if(!jo(t)&&!Ko(t))return n.reject("rs is not array or object"),n;var r=!1;if(Ko(t)){r=!0;var o=[];oo(t,(function(t,e){o.push({k:e,v:t})})),t=o}ru(e)||(e=function(t){return t});var i=-1,u=[];return t.reduce((function(t,n){return t.then((function(t){u.push(t);var o=i+=1,a=n;return r&&(o=n.k,a=n.v),ru(e)?e(a,o):a}))}),Promise.resolve()).then((function(t){u.push(t),u=Wo(u),n.resolve(u)})).catch((function(t){n.reject(t)})),n}var iu={useNewUrlParser:!0,useUnifiedTopology:!0};function uu(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.url||(t.url="mongodb://127.0.0.1:27017"),t.db||(t.db="worm"),t.cl||(t.cl="test");var e=new ii.EventEmitter,n=i.default.MongoClient;function r(){return o.apply(this,arguments)}function o(){return o=c(h.mark((function e(){var r,o,i,u,a=arguments;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},o=nu(),e.next=4,n.connect(t.url,iu);case 4:return i=e.sent,u=i.db(t.db),u.collection(t.cl).find(r).toArray((function(t,e){t?o.reject(t):(e=jr(e,(function(t){return t=Ii(t,"_id")})),o.resolve(e)),i.close()})),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function a(t){return f.apply(this,arguments)}function f(){return(f=c(h.mark((function r(o){var i,u,a,c;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=wn(o),i=nu(),r.next=4,n.connect(t.url,iu);case 4:return u=r.sent,a=u.db(t.db),c=a.collection(t.cl),jo(o)||(o=[o]),o=jr(o,(function(t){return t.id||(t.id=Vr()),t})),c.insertMany(o,(function(t,n){t?i.reject(t):n.insertedCount>0?(n={n:eu(o),nInserted:n.insertedCount,ok:n.acknowledged?1:0},i.resolve(n),e.emit("change","insert",o,n)):i.reject(t),u.close()})),r.abrupt("return",i);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function s(t){return l.apply(this,arguments)}function l(){return l=c(h.mark((function r(o){var i,u,f,s,l,v,p,d,y=arguments;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=y.length>1&&void 0!==y[1]?y[1]:{},o=wn(o),u=Fn(i,"autoInsert",!0),f=Fn(i,"atomic",!1),s=nu(),r.next=7,n.connect(t.url,iu);case 7:return l=r.sent,v=l.db(t.db),p=v.collection(t.cl),jo(o)||(o=[o]),d=null,d=f?"findOneAndUpdate":"updateOne",ou(o,function(){var t=c(h.mark((function t(e){var n;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=nu(),p[d]({id:e.id},{$set:e},(function(t,r){t?n.reject(t):(r=r.lastErrorObject?{n:r.lastErrorObject.n,nModified:r.lastErrorObject.updatedExisting?1:0,ok:1}:{n:r.matchedCount,nModified:r.modifiedCount,ok:r.acknowledged?1:0},u&&0===r.n?a(e).then((function(t){n.resolve(t)})).catch((function(t){n.reject(t)})):n.resolve(r))})),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(t){s.resolve(t),e.emit("change","save",o,t)})).catch((function(t){s.reject(t)})).finally((function(){l.close()})),r.abrupt("return",s);case 15:case"end":return r.stop()}}),r)}))),l.apply(this,arguments)}function v(t){return p.apply(this,arguments)}function p(){return(p=c(h.mark((function r(o){var i,u,a,c;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=wn(o),i=nu(),r.next=4,n.connect(t.url,iu);case 4:return u=r.sent,a=u.db(t.db),c=a.collection(t.cl),jo(o)||(o=[o]),ou(o,(function(t){var e=nu();return c.deleteOne({id:t.id},(function(t,n){t?e.resolve(t):(n={n:n.deletedCount,nDeleted:n.deletedCount,ok:n.acknowledged?1:0},e.resolve(n))})),e})).then((function(t){i.resolve(t),e.emit("change","del",o,t)})).catch((function(t){i.reject(t)})).finally((function(){u.close()})),r.abrupt("return",i);case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function d(){return y.apply(this,arguments)}function y(){return y=c(h.mark((function r(){var o,i,u,a,c=arguments;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=c.length>0&&void 0!==c[0]?c[0]:{},i=nu(),r.next=4,n.connect(t.url,iu);case 4:return u=r.sent,a=u.db(t.db),a.collection(t.cl).deleteMany(o,(function(t,n){t?i.resolve(t):(n={n:n.deletedCount,nDeleted:n.deletedCount,ok:n.acknowledged?1:0},i.resolve(n),e.emit("change","delAll",null,n)),u.close()})),r.abrupt("return",i);case 9:case"end":return r.stop()}}),r)}))),y.apply(this,arguments)}function b(t){return g.apply(this,arguments)}function g(){return(g=c(h.mark((function r(o){var a,c,f,s,l,v,p;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=nu(),c=Vr(),f=Buffer.from(o),r.next=5,n.connect(t.url,iu);case 5:return s=r.sent,l=s.db(t.db),v=new i.default.GridFSBucket(l,{chunkSizeBytes:10485760,bucketName:t.cl}),(p=new u.default.Readable)._read=function(){},p.push(f),p.push(null),p.pipe(v.openUploadStream(c)).on("error",(function(t){a.reject(t),s.close()})).on("finish",(function(){var t={n:1,ok:1,id:c};a.resolve(t),e.emit("change","insertGfs",null,t),s.close()})),r.abrupt("return",a);case 14:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function m(t){return w.apply(this,arguments)}function w(){return w=c(h.mark((function e(r){var o,u,a,c,f,s;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=nu(),e.next=3,n.connect(t.url,iu);case 3:return u=e.sent,a=u.db(t.db),c=new i.default.GridFSBucket(a,{chunkSizeBytes:10485760,bucketName:t.cl}),f=Buffer.from(""),(s=c.openDownloadStreamByName(r)).on("data",(function(t){f=Buffer.concat([f,t])})),s.on("error",(function(t){o.reject(t),u.close()})),s.on("end",(function(){var t=new Uint8Array(f);f=null,o.resolve(t),u.close()})),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function _(){return j.apply(this,arguments)}function j(){return j=c(h.mark((function e(){var r,o,u,a,c,f=arguments;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=f.length>0&&void 0!==f[0]?f[0]:{},o=f.length>1&&void 0!==f[1]?f[1]:null,u=nu(),null!==o){e.next=9;break}return e.next=6,n.connect(t.url,iu);case 6:a=e.sent,c=a.db(t.db),o=new i.default.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:t.cl});case 9:return o.find(r).toArray((function(t,e){t?u.reject(t):u.resolve(e)})),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}function x(t){return O.apply(this,arguments)}function O(){return(O=c(h.mark((function r(o){var u,a,c,f,s,l;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=nu(),r.next=3,n.connect(t.url,iu);case 3:return a=r.sent,c=a.db(t.db),f=new i.default.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:t.cl}),r.next=8,_({filename:o},f);case 8:return 0===(s=r.sent).length?(u.reject("can not find id"),a.close()):s.length>1?(u.reject("duplicate id"),a.close()):(l=s[0]._id,f.delete(l,(function(t){if(t)u.reject(t);else{var n={n:1,nDeleted:1,ok:1};u.resolve(n),e.emit("change","delGfs",null,n)}a.close()}))),r.abrupt("return",u);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function A(t,e){return k.apply(this,arguments)}function k(){return(k=c(h.mark((function t(e,n){var r;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=nu(),n.delete(e,(function(t){t?r.reject(t):r.resolve({n:1,nDeleted:1,ok:1})})),t.abrupt("return",r);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(){return L.apply(this,arguments)}function L(){return L=c(h.mark((function r(){var o,u,a,c,f,s,l,v,p=arguments;return h.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=p.length>0&&void 0!==p[0]?p[0]:{},u=nu(),r.next=4,n.connect(t.url,iu);case 4:return a=r.sent,c=a.db(t.db),f=new i.default.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:t.cl}),r.next=9,_(o,f);case 9:return s=r.sent,l=eu(s),v=jr(s,(function(t){return A(t._id,f)})),Promise.all(v).then((function(t){var n={n:l,ok:1};u.resolve(n),e.emit("change","delAllGfs",null,n)})).catch((function(t){u.reject(t)})).finally((function(){a.close()})),r.abrupt("return",u);case 14:case"end":return r.stop()}}),r)}))),L.apply(this,arguments)}return e.select=r,e.insert=a,e.save=s,e.del=v,e.delAll=d,e.selectGfs=m,e.insertGfs=b,e.delGfs=x,e.delAllGfs=S,e}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=wn(t)).mongoUrl||(t.mongoUrl="mongodb://127.0.0.1:27017"),t.mongoDb||(t.mongoDb="wqws"),t.mongoCl||(t.mongoCl="queues"),t.port||(t.port=8080);var e=uu({url:t.mongoUrl,db:t.mongoDb,cl:t.mongoCl}),n=new Zo(t);return n.on("execute",function(){var t=c(h.mark((function t(r,o,i,u){var a,c,f,s,l,v,p,d,y,b,g,m,w,_,j,x,O,A,k,S;return h.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=function(t){u({_mode:"deliver",data:t})},a=Fn(o,"topic",null),"pushQueue"!==r){t.next=12;break}return s=Vr(),l=Fn(o,"input",null),v=Fn(o,"option"),p={topic:a,id:s,input:l,output:null,transData:Fn(v,"transData",null),timeStart:Fn(v,"timeStart",null),timeExp:Fn(v,"timeExp",null),timeTakeStart:Fn(v,"timeTakeStart",null),timeTakeExp:Fn(v,"timeTakeExp",null),state:"ready"},t.next=9,e.insert(p).then((function(t){n.emit(a,{topic:a,id:s,input:p.input,output:p.output,state:p.state}),f="success"})).catch((function(t){f={err:t}}));case 9:i(f),t.next=105;break;case 12:if("modifyQueue"!==r){t.next=27;break}if(null===(d=Fn(o,"id",null))){t.next=23;break}return y=Fn(o,"input",null),b=Fn(o,"output",null),g=Fn(o,"state",null),m={id:d,output:b,state:g},t.next=21,e.save(m,{atomic:!0}).then((function(t){n.emit(a,{topic:a,id:d,input:y,output:b,state:g}),f="success"})).catch((function(t){f={err:t}}));case 21:t.next=24;break;case 23:f={err:"can not find id"};case 24:i(f),t.next=105;break;case 27:if("subTopic"!==r){t.next=34;break}n.deliverQueue=c,n.on(a,n.deliverQueue),i(f="success"),t.next=105;break;case 34:if("unsubTopic"!==r){t.next=41;break}n.off(a,n.deliverQueue),n.deliverQueue=null,i(f="success"),t.next=105;break;case 41:if("delQueueByTopic"!==r){t.next=47;break}return t.next=44,e.delAll({topic:a}).then((function(t){f="success"})).catch((function(t){f={err:t}}));case 44:i(f),t.next=105;break;case 47:if("delQueueByID"!==r){t.next=58;break}if(null===(w=Fn(o,"id",null))){t.next=54;break}return t.next=52,e.delAll({id:w}).then((function(t){f="success"})).catch((function(t){f={err:t}}));case 52:t.next=55;break;case 54:f={err:"can not find id"};case 55:i(f),t.next=105;break;case 58:if("delQueueByIDs"!==r){t.next=66;break}return _=Fn(o,"ids",null),j=jr(_,(function(t){return e.delAll({id:t})})),t.next=63,Promise.all(j).then((function(t){f="success"})).catch((function(t){f={err:t}}));case 63:i(f),t.next=105;break;case 66:if("delQueueByMatches"!==r){t.next=73;break}return x=Fn(o,"find",null),t.next=70,e.delAll(x).then((function(t){f="success"})).catch((function(t){f={err:t}}));case 70:i(f),t.next=105;break;case 73:if("getQueueByTopic"!==r){t.next=79;break}return t.next=76,e.select({topic:a}).then((function(t){f=t})).catch((function(t){f={err:t}}));case 76:i(f),t.next=105;break;case 79:if("getQueueByID"!==r){t.next=90;break}if(null===(O=Fn(o,"id",null))){t.next=86;break}return t.next=84,e.select({id:O}).then((function(t){f=t})).catch((function(t){f={err:t}}));case 84:t.next=87;break;case 86:f={err:"can not find id"};case 87:i(f),t.next=105;break;case 90:if("getQueueByIDs"!==r){t.next=98;break}return A=Fn(o,"ids",null),k=jr(A,(function(t){return e.select({id:t})})),t.next=95,Promise.all(k).then((function(t){f=t})).catch((function(t){f={err:t}}));case 95:i(f),t.next=105;break;case 98:if("getQueueByMatches"!==r){t.next=105;break}return S=Fn(o,"find",null),t.next=102,e.select(S).then((function(t){f=t})).catch((function(t){f={err:t}}));case 102:i(f),t.next=105;break;case 105:case"end":return t.stop()}}),t)})));return function(e,n,r,o){return t.apply(this,arguments)}}()),n}}));
//# sourceMappingURL=w-runqws-server.umd.js.map
