/*!
 * w-runqws-server v1.0.0
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ws"),require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","events","mongodb","stream"],t):(e=e||self,e["w-runqws-server"]=t(e.ws,e.events,e.mongodb,e.stream))})(this,function(e,t,n,r){'use strict';function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t,n,r,o,a,c){try{var l=e[a](c),d=l.value}catch(e){return void n(e)}l.done?t(d):Promise.resolve(d).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function c(e){a(d,r,o,c,l,"next",e)}function l(e){a(d,r,o,c,l,"throw",e)}var d=e.apply(t,n);c(void 0)})}}function l(e,t){return t={exports:{}},e(t,t.exports),t.exports}function d(e,t,n,r,o,a,c){try{var l=e[a](c),d=l.value}catch(e){return void n(e)}l.done?t(d):Promise.resolve(d).then(r,o)}function i(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function p(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Se&&Se in Object(e)?xe(e):ke(e)}function s(e){var t=o(e);return null!=e&&("object"==t||"function"==t)}function u(e){return!!Te&&Te in e}function y(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function b(e){var t=o(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function f(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function h(e){var t=this.__data__=new ie(e);this.size=t.size}function g(e,t,n){var r=e[t];dt.call(e,t)&&ae(r,n)&&(n!==void 0||t in e)||ct(e,t,n)}function m(e){return null!=e&&"object"==o(e)}function j(e,t){var n=o(e);return t=null==t?9007199254740991:t,!!t&&("number"==n||"symbol"!=n&&vt.test(e))&&-1<e&&0==e%1&&e<t}function _(e,t,n,r,o,a){var c,l=1&t,d=2&t;if(n&&(c=o?n(e,r,o,a):n(e)),void 0!==c)return c;if(!Oe(e))return e;var i=_t(e);if(!i){var p=In(e),s="[object Function]"==p||"[object GeneratorFunction]"==p;if(wt(e))return Zt(e,l);if("[object Object]"!=p&&"[object Arguments]"!=p&&(!s||o)){if(!lr[p])return o?e:{};c=Zn(e,p,l)}else if(c=d||s?{}:er(e),!l)return d?bn(e,Jt(c,e)):cn(e,qt(c,e))}else if(c=Mn(e),!l)return Kt(e,c);a||(a=new nt);var u=a.get(e);if(u)return u;a.set(e,c),cr(e)?e.forEach(function(r){c.add(_(r,t,n,r,e,a))}):rr(e)&&e.forEach(function(r,o){c.set(o,_(r,t,n,o,e,a))});var y=4&t?d?gn:hn:d?keysIn:Rt,b=i?void 0:y(e);return rt(b||e,function(r,o){b&&(o=r,r=e[o]),it(c,o,_(r,t,n,o,e,a))}),c}function x(e){return"symbol"==o(e)||ut(e)&&Ae(e)=="[object Symbol]"}function w(e,t){if(_t(e))return!1;var n=o(e);return!!("number"==n||"symbol"==n||"boolean"==n||null==e||pr(e))||ur.test(e)||!sr.test(e)||null!=t&&e in Object(t)}function v(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,o=t?t.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var c=e.apply(this,r);return n.cache=a.set(o,c)||a,c};return n.cache=new(v.Cache||tt),n}function k(e){if("string"==typeof e)return e;if(_t(e))return gr(e,k)+"";if(pr(e))return _r?_r.call(e):"";var t=e+"";return"0"==t&&1/e==-mr?"-0":t}function S(e){var t=Object.prototype.toString.call(e);return"[object String]"===t}function A(e){return!!(S(e)&&""!==e)}function O(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t}function E(e){var t=!1;return A(e)?t=!isNaN(+e):O(e)&&(t=!0),t}function P(e){if(!E(e))return 0;var t=Fr(e);return t}function L(e){return!!E(e)&&(e=P(e),Ir(e))}function T(e){if(!E(e))return 0;e=P(e);var t=Cr(e);return"0"===t+""?0:t}function U(e){if(!L(e))return!1;var t=0<T(e);return t}function z(){var e,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:32,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[],a=n.length;if(U(t))for(e=0;e<t;e++)o[e]=n[0|Math.random()*a];else if("rfc4122"===t){o[8]=o[13]=o[18]=o[23]="-",o[14]="4";var c;for(e=0;36>e;e++)o[e]||(c=0|16*Math.random(),o[e]=n[19===e?8|3&c:c])}else return"";var l=o.join("");return l}function N(){var e,t,n=new Promise(function(){e=arguments[0],t=arguments[1]});return n.resolve=e,n.reject=t,n}function F(e,t,n){if(!Oe(n))return!1;var r=o(t);return!("number"==r?!(Qt(n)&&kt(t,n.length)):!("string"==r&&t in n))&&ae(n[t],e)}function B(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new tt;++t<n;)this.add(e[t])}function I(e,t,n,r,o,a){var c=1&n,l=hn(e),d=l.length,i=hn(t),p=i.length;if(d!=p&&!c)return!1;for(var s,u=d;u--;)if(s=l[u],c?!(s in t):!jo.call(t,s))return!1;var y=a.get(e);if(y&&a.get(t))return y==t;var b=!0;a.set(e,t),a.set(t,e);for(var f=c;++u<d;){s=l[u];var h=e[s],g=t[s];if(r)var m=c?r(g,h,s,t,e,a):r(h,g,s,e,t,a);if(void 0===m?!(h===g||o(h,g,n,r,a)):!m){b=!1;break}f||(f="constructor"==s)}if(b&&!f){var j=e.constructor,_=t.constructor;j!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof j&&j instanceof j&&"function"==typeof _&&_ instanceof _)&&(b=!1)}return a["delete"](e),a["delete"](t),b}function D(e,t,n,r,o){return!(e!==t)||(null!=e&&null!=t&&(ut(e)||ut(t))?wo(e,t,n,r,D,o):e!==e&&t!==t)}function G(e,t,n,r){var o=n.length,a=o,c=!r;if(null==e)return!a;for(e=Object(e);o--;){var l=n[o];if(c&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<a;){l=n[o];var d=l[0],i=e[d],p=l[1];if(!(c&&l[2])){var s=new nt;if(r)var u=r(i,p,d,e,t,s);if(void 0===u?!vo(p,i,3,r,s):!u)return!1}else if(void 0===i&&!(d in e))return!1}return!0}function M(e,t){return null!=e&&t in Object(e)}function C(e){return"function"==typeof e?e:null==e?To:"object"==o(e)?_t(e)?Lo(e[0],e[1]):Oo(e):No(e)}function Q(e){if(!A(e))return{};if(e=io(e,"?"),e=Ar(e,"[1]"),!A(e))return{};var t=io(e,"&");return t=Do(t,function(e){return io(e,"=")}),t=Go(t),t}function R(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t}function q(e){if(R(e)){for(var t in e)return!0;return!1}return!1}function V(e,t){return q(e)?A(t)?Ar(e,t,""):"":""}function W(e){if(!A(e)&&!E(e))return"";return e+""}function $(e,t){var n=V(e,t);return n=W(n),n}function Y(e){if(!A(e))return{};var t={};try{t=JSON.parse(e)}catch(e){t={}}return t}function X(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function J(){function n(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];setTimeout(function(){l.emit.apply(l,[e].concat(n))},1)}function r(e){var t=N();return X(c.authenticate)?c.authenticate(e).then(function(e){t.resolve(e)}):t.resolve(!0),t}function o(e){n("error",e)}function a(){n("clientChange",s)}var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c=ir(c),c.port||(c.port=8080);var l=new t.EventEmitter,d=e.Server,i={port:c.port,verifyClient:function(e,t){var n=Q(e.req.url),o=$(n,"token");r(o).then(function(e){t(e)})}},p=null;try{p=new d(i)}catch(e){o({msg:"can not create websocket",err:e})}if(!p)return l;(function(){n("open")})();var s=[];return p.on("connection",function(t){function r(n){t.readyState===e.OPEN&&t.send(JSON.stringify(n),function(e){e&&o({msg:"can not send message",err:e})})}function c(e){function t(t){e.output=t,r(e)}var a=$(e,"_mode");if("execute"===a){var c=$(e,"func"),l=Ar(e,"input");n("execute",c,l,t,r)}else"broadcast"===a?n("broadcast",Ar(e,"data")):"deliver"===a?n("deliver",Ar(e,"data")):o({msg:"can not find _mode in data",err:e})}function d(e){var t=Y(e);c(t)}s.push(t),a(),t.on("close",function(){s=s.filter(function(e){return e!==t}),a()}),t.sendData=r,t.on("message",d),l.on("triggerBroadcast",function(e){r({_mode:"broadcast",data:e})})}),l.broadcast=function(e){n("triggerBroadcast",e)},l}function Z(e,t,n,r,o){var a=-1,c=e.length;for(n||(n=Zo),o||(o=[]);++a<c;){var l=e[a];0<t&&n(l)?1<t?Z(l,t-1,n,r,o):ln(o,l):!r&&(o[o.length]=l)}return o}function K(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t}function H(e,n){var r=N();if(!K(e))return r.reject("rs is not array"),r;if(!X(n))return r.reject("v is not Function"),r;var o=[];return e.reduce(function(e,r){return e.then(function(e){return o.push(e),n(r)})},Promise.resolve()).then(function(e){o.push(e),o=da(o),r.resolve(o)})["catch"](function(e){r.reject(e)}),r}function ee(e){function t(){return o.apply(this,arguments)}function o(){return o=c(regeneratorRuntime.mark(function t(){var n,r,o,a,c,l=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=0<l.length&&void 0!==l[0]?l[0]:{},r=N(),t.next=4,A.connect(e.url,{useNewUrlParser:!0});case 4:return o=t.sent,a=o.db(e.db),c=a.collection(e.cl),c.find(n).toArray(function(e,t){e?r.reject(e):(t=Do(t,function(e){return e=la(e,"_id"),e}),r.resolve(t)),o.close()}),t.abrupt("return",r);case 9:case"end":return t.stop();}},t)})),o.apply(this,arguments)}function a(){return l.apply(this,arguments)}function l(){return l=c(regeneratorRuntime.mark(function t(n){var r,o,a,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=ir(n),r=N(),t.next=4,A.connect(e.url,{useNewUrlParser:!0});case 4:return o=t.sent,a=o.db(e.db),c=a.collection(e.cl),K(n)||(n=[n]),n=Do(n,function(e){return e.id||(e.id=z()),e}),c.insertMany(n,function(e,t){e?r.reject(e):0<t.insertedCount?r.resolve(t.result):r.reject(e),o.close()}),t.abrupt("return",r);case 11:case"end":return t.stop();}},t)})),l.apply(this,arguments)}function d(){return i.apply(this,arguments)}function i(){return i=c(regeneratorRuntime.mark(function t(n){var r,o,c,l,d,i,p,s,u=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=1<u.length&&void 0!==u[1]?u[1]:{},n=ir(n),o=Ar(r,"autoInsert",!0),c=Ar(r,"atomic",!1),l=N(),t.next=7,A.connect(e.url,{useNewUrlParser:!0});case 7:return d=t.sent,i=d.db(e.db),p=i.collection(e.cl),K(n)||(n=[n]),s=null,s=c?"findOneAndUpdate":"updateOne",H(n,function(e){var t=N();return p[s]({id:e.id},{$set:e},function(n,r){n?t.reject(n):(r.lastErrorObject&&(r.result={n:r.lastErrorObject.n,nModified:r.lastErrorObject.updatedExisting?1:0,ok:1}),o&&0===r.result.n?a(e).then(function(e){e.nInserted=1,t.resolve(e)})["catch"](function(e){t.reject(e)}):t.resolve(r.result))}),t}).then(function(e){l.resolve(e)})["catch"](function(e){l.reject(e)})["finally"](function(){d.close()}),t.abrupt("return",l);case 15:case"end":return t.stop();}},t)})),i.apply(this,arguments)}function p(){return s.apply(this,arguments)}function s(){return s=c(regeneratorRuntime.mark(function t(n){var r,o,a,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=ir(n),r=N(),t.next=4,A.connect(e.url,{useNewUrlParser:!0});case 4:return o=t.sent,a=o.db(e.db),c=a.collection(e.cl),K(n)||(n=[n]),H(n,function(e){var t=N();return c.deleteOne({id:e.id},function(e,n){e?t.resolve(e):(n=n.result,n.nDeleted=1,t.resolve(n))}),t}).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})["finally"](function(){o.close()}),t.abrupt("return",r);case 10:case"end":return t.stop();}},t)})),s.apply(this,arguments)}function u(){return y.apply(this,arguments)}function y(){return y=c(regeneratorRuntime.mark(function t(){var n,r,o,a,c,l=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=0<l.length&&void 0!==l[0]?l[0]:{},r=N(),t.next=4,A.connect(e.url,{useNewUrlParser:!0});case 4:return o=t.sent,a=o.db(e.db),c=a.collection(e.cl),c.deleteMany(n,function(e,t){e?r.resolve(e):(t=t.result,r.resolve(t)),o.close()}),t.abrupt("return",r);case 9:case"end":return t.stop();}},t)})),y.apply(this,arguments)}function b(){return f.apply(this,arguments)}function f(){return f=c(regeneratorRuntime.mark(function t(o){var a,c,l,d,i,p,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=N(),c=z(),l=Buffer.from(o),t.next=5,A.connect(e.url,{useNewUrlParser:!0});case 5:return d=t.sent,i=d.db(e.db),p=new n.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:e.cl}),s=new r.Readable,s._read=function(){},s.push(l),s.push(null),s.pipe(p.openUploadStream(c)).on("error",function(e){a.reject(e),d.close()}).on("finish",function(){a.resolve({n:1,ok:1,id:c}),d.close()}),t.abrupt("return",a);case 14:case"end":return t.stop();}},t)})),f.apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return g=c(regeneratorRuntime.mark(function t(r){var o,a,c,l,d,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=N(),t.next=3,A.connect(e.url,{useNewUrlParser:!0});case 3:return a=t.sent,c=a.db(e.db),l=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),d=Buffer.from(""),i=l.openDownloadStreamByName(r),i.on("data",function(e){d=Buffer.concat([d,e])}),i.on("error",function(e){o.reject(e),a.close()}),i.on("end",function(){var e=new Uint8Array(d);d=null,o.resolve(e),a.close()}),t.abrupt("return",o);case 12:case"end":return t.stop();}},t)})),g.apply(this,arguments)}function m(){return j.apply(this,arguments)}function j(){return j=c(regeneratorRuntime.mark(function t(){var r,o,a,c,l,d=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0<d.length&&void 0!==d[0]?d[0]:{},o=1<d.length&&void 0!==d[1]?d[1]:null,a=N(),null!==o){t.next=9;break}return t.next=6,A.connect(e.url,{useNewUrlParser:!0});case 6:c=t.sent,l=c.db(e.db),o=new n.GridFSBucket(l,{chunkSizeBytes:10485760,bucketName:e.cl});case 9:return o.find(r).toArray(function(e,t){e?a.reject(e):a.resolve(t)}),t.abrupt("return",a);case 11:case"end":return t.stop();}},t)})),j.apply(this,arguments)}function _(){return x.apply(this,arguments)}function x(){return x=c(regeneratorRuntime.mark(function t(r){var o,a,c,l,d,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=N(),t.next=3,A.connect(e.url,{useNewUrlParser:!0});case 3:return a=t.sent,c=a.db(e.db),l=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),t.next=8,m({filename:r},l);case 8:return d=t.sent,0===d.length?(o.reject("can not find id"),a.close()):1<d.length?(o.reject("duplicate id"),a.close()):(i=d[0]._id,l["delete"](i,function(e){e?o.reject(e):o.resolve({n:1,nDeleted:1,ok:1}),a.close()})),t.abrupt("return",o);case 11:case"end":return t.stop();}},t)})),x.apply(this,arguments)}function w(){return v.apply(this,arguments)}function v(){return v=c(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=N(),n["delete"](t,function(e){e?r.reject(e):r.resolve({n:1,nDeleted:1,ok:1})}),e.abrupt("return",r);case 3:case"end":return e.stop();}},e)})),v.apply(this,arguments)}function k(){return S.apply(this,arguments)}function S(){return S=c(regeneratorRuntime.mark(function t(){var r,o,a,c,l,d,i,p=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=0<p.length&&void 0!==p[0]?p[0]:{},o=N(),t.next=4,A.connect(e.url,{useNewUrlParser:!0});case 4:return a=t.sent,c=a.db(e.db),l=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),t.next=9,m(r,l);case 9:return d=t.sent,i=Do(d,function(e){var t=e._id;return w(t,l)}),Promise.all(i).then(function(){o.resolve({n:d.length,ok:1})})["catch"](function(e){o.reject(e)})["finally"](function(){a.close()}),t.abrupt("return",o);case 13:case"end":return t.stop();}},t)})),S.apply(this,arguments)}e.url||(e.url="mongodb://127.0.0.1:27017"),e.db||(e.db="worm"),e.cl||(e.cl="test");var A=n.MongoClient;return{select:t,insert:a,save:d,del:p,delAll:u,selectGfs:h,insertGfs:b,delGfs:_,delAllGfs:k}}e=e&&e.hasOwnProperty("default")?e["default"]:e,t=t&&t.hasOwnProperty("default")?t["default"]:t,n=n&&n.hasOwnProperty("default")?n["default"]:n,r=r&&r.hasOwnProperty("default")?r["default"]:r;var te="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,ne=l(function(e){var t=function(e){function t(e,t,n,o){var a=t&&t.prototype instanceof r?t:r,c=Object.create(a.prototype),l=new y(o||[]);return c._invoke=i(e,n,l),c}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function r(){}function a(){}function c(){}function l(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function d(e){function t(r,a,c,l){var d=n(e[r],e,a);if("throw"===d.type)l(d.arg);else{var i=d.arg,p=i.value;return p&&"object"===o(p)&&m.call(p,"__await")?Promise.resolve(p.__await).then(function(e){t("next",e,c,l)},function(e){t("throw",e,c,l)}):Promise.resolve(p).then(function(e){i.value=e,c(i)},function(e){return t("throw",e,c,l)})}}function r(e,n){function r(){return new Promise(function(r,o){t(e,n,r,o)})}return a=a?a.then(r,r):r()}var a;this._invoke=r}function i(e,t,r){var o="suspendedStart";return function(a,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw c;return f()}for(r.method=a,r.arg=c;;){var l=r.delegate;if(l){var d=p(l,r);if(d){if(d===v)continue;return d}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===o)throw o="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o="executing";var i=n(e,t,r);if("normal"===i.type){if(o=r.done?"completed":"suspendedYield",i.arg===v)continue;return{value:i.arg,done:r.done}}"throw"===i.type&&(o="completed",r.method="throw",r.arg=i.arg)}}}function p(e,t){var r=e.iterator[t.method];if(r===h){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=h,p(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=n(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var a=o.arg;if(!a)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v;if(a.done)t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=h);else return a;return t.delegate=null,v}function s(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function u(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function y(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(s,this),this.reset(!0)}function b(e){if(e){var t=e[_];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(m.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=h,t.done=!0,t};return r.next=r}}return{next:f}}function f(){return{value:h,done:!0}}var h,g=Object.prototype,m=g.hasOwnProperty,j="function"==typeof Symbol?Symbol:{},_=j.iterator||"@@iterator",x=j.asyncIterator||"@@asyncIterator",w=j.toStringTag||"@@toStringTag";e.wrap=t;var v={},k={};k[_]=function(){return this};var S=Object.getPrototypeOf,A=S&&S(S(b([])));A&&A!==g&&m.call(A,_)&&(k=A);var O=c.prototype=r.prototype=Object.create(k);return a.prototype=O.constructor=c,c.constructor=a,c[w]=a.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,!(w in e)&&(e[w]="GeneratorFunction")),e.prototype=Object.create(O),e},e.awrap=function(e){return{__await:e}},l(d.prototype),d.prototype[x]=function(){return this},e.AsyncIterator=d,e.async=function(n,r,o,a){var c=new d(t(n,r,o,a));return e.isGeneratorFunction(r)?c:c.next().then(function(e){return e.done?e.value:c.next()})},l(O),O[w]="Generator",O[_]=function(){return this},O.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=b,y.prototype={constructor:y,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(u),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=h)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=h),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var c=m.call(o,"catchLoc"),l=m.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);}else if(!l)throw new Error("try statement without catch or finally");else if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}},abrupt:function(e,t){for(var n,r=this.tryEntries.length-1;0<=r;--r)if(n=this.tryEntries[r],n.tryLoc<=this.prev&&m.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t,n=this.tryEntries.length-1;0<=n;--n)if(t=this.tryEntries[n],t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),u(t),v},catch:function(e){for(var t,n=this.tryEntries.length-1;0<=n;--n)if(t=this.tryEntries[n],t.tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;u(t)}return o}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:b(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=h),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}),re=ne,oe=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){function a(e){d(l,r,o,a,c,"next",e)}function c(e){d(l,r,o,a,c,"throw",e)}var l=e.apply(t,n);a(void 0)})}},ae=function(e,t){return e===t||e!==e&&t!==t},ce=function(e,t){for(var n=e.length;n--;)if(ae(e[n][0],t))return n;return-1},le=Array.prototype,de=le.splice;i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype["delete"]=function(e){var t=this.__data__,n=ce(t,e);if(0>n)return!1;var r=t.length-1;return n==r?t.pop():de.call(t,n,1),--this.size,!0},i.prototype.get=function(e){var t=this.__data__,n=ce(t,e);return 0>n?void 0:t[n][1]},i.prototype.has=function(e){return-1<ce(this.__data__,e)},i.prototype.set=function(e,t){var n=this.__data__,r=ce(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var ie=i,pe="object"==o(te)&&te&&te.Object===Object&&te,se=pe,ue="object"==("undefined"==typeof self?"undefined":o(self))&&self&&self.Object===Object&&self,ye=se||ue||Function("return this")(),be=ye,fe=be.Symbol,he=fe,ge=Object.prototype,me=ge.hasOwnProperty,je=ge.toString,_e=he?he.toStringTag:void 0,xe=function(e){var t=me.call(e,_e),n=e[_e];try{e[_e]=void 0;var r=!0}catch(t){}var o=je.call(e);return r&&(t?e[_e]=n:delete e[_e]),o},we=Object.prototype,ve=we.toString,ke=function(e){return ve.call(e)},Se=he?he.toStringTag:void 0,Ae=p,Oe=s,Ee=function(e){if(!Oe(e))return!1;var t=Ae(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Pe=be["__core-js_shared__"],Le=Pe,Te=function(){var e=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ue=Function.prototype,ze=Ue.toString,Ne=function(e){if(null!=e){try{return ze.call(e)}catch(t){}try{return e+""}catch(t){}}return""},Fe=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,Ie=Function.prototype,De=Object.prototype,Ge=Ie.toString,Me=De.hasOwnProperty,Ce=RegExp("^"+Ge.call(Me).replace(Fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qe=function(e){if(!Oe(e)||u(e))return!1;var t=Ee(e)?Ce:Be;return t.test(Ne(e))},Re=function(e,t){return null==e?void 0:e[t]},qe=function(e,t){var n=Re(e,t);return Qe(n)?n:void 0},Ve=qe(be,"Map"),We=Ve,$e=qe(Object,"create"),Ye=$e,Xe=Object.prototype,Je=Xe.hasOwnProperty,Ze=Object.prototype,Ke=Ze.hasOwnProperty;y.prototype.clear=function(){this.__data__=Ye?Ye(null):{},this.size=0},y.prototype["delete"]=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},y.prototype.get=function(e){var t=this.__data__;if(Ye){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return Je.call(t,e)?t[e]:void 0},y.prototype.has=function(e){var t=this.__data__;return Ye?t[e]!==void 0:Ke.call(t,e)},y.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ye&&void 0===t?"__lodash_hash_undefined__":t,this};var He=y,et=function(e,t){var n=e.__data__;return b(t)?n["string"==typeof t?"string":"hash"]:n.map};f.prototype.clear=function(){this.size=0,this.__data__={hash:new He,map:new(We||ie),string:new He}},f.prototype["delete"]=function(e){var t=et(this,e)["delete"](e);return this.size-=t?1:0,t},f.prototype.get=function(e){return et(this,e).get(e)},f.prototype.has=function(e){return et(this,e).has(e)},f.prototype.set=function(e,t){var n=et(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var tt=f;h.prototype.clear=function(){this.__data__=new ie,this.size=0},h.prototype["delete"]=function(e){var t=this.__data__,n=t["delete"](e);return this.size=t.size,n},h.prototype.get=function(e){return this.__data__.get(e)},h.prototype.has=function(e){return this.__data__.has(e)},h.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ie){var r=n.__data__;if(!We||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new tt(r)}return n.set(e,t),this.size=n.size,this};var nt=h,rt=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!(!1===t(e[n],n,e)););return e},ot=function(){try{var e=qe(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),at=ot,ct=function(e,t,n){"__proto__"==t&&at?at(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},lt=Object.prototype,dt=lt.hasOwnProperty,it=g,pt=function(e,t,n,r){var o=!n;n||(n={});for(var a=-1,c=t.length;++a<c;){var l=t[a],d=r?r(n[l],e[l],l,n,e):void 0;d===void 0&&(d=e[l]),o?ct(n,l,d):it(n,l,d)}return n},st=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ut=m,yt=function(e){return ut(e)&&Ae(e)=="[object Arguments]"},bt=Object.prototype,ft=bt.hasOwnProperty,ht=bt.propertyIsEnumerable,gt=yt(function(){return arguments}())?yt:function(e){return ut(e)&&ft.call(e,"callee")&&!ht.call(e,"callee")},mt=gt,jt=Array.isArray,_t=jt,xt=function(){return!1},wt=l(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o?be.Buffer:void 0,c=a?a.isBuffer:void 0;e.exports=c||xt}),vt=/^(?:0|[1-9]\d*)$/,kt=j,St=function(e){return"number"==typeof e&&-1<e&&0==e%1&&e<=9007199254740991},At={};At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object Boolean]"]=At["[object DataView]"]=At["[object Date]"]=At["[object Error]"]=At["[object Function]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object WeakMap]"]=!1;var Ot=function(e){return function(t){return e(t)}},Et=l(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o&&se.process,c=function(){try{var e=r&&r.require&&r.require("util").types;return e?e:a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=c}),Pt=Et&&Et.isTypedArray,Lt=Pt?Ot(Pt):function(e){return ut(e)&&St(e.length)&&!!At[Ae(e)]},Tt=Lt,Ut=Object.prototype,zt=Ut.hasOwnProperty,Nt=function(e,t){var n=_t(e),r=!n&&mt(e),o=!n&&!r&&wt(e),a=!n&&!r&&!o&&Tt(e),c=n||r||o||a,l=c?st(e.length,String):[],d=l.length;for(var i in e)(t||zt.call(e,i))&&!(c&&("length"==i||o&&("offset"==i||"parent"==i)||a&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||kt(i,d)))&&l.push(i);return l},Ft=Object.prototype,Bt=function(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||Ft;return e===n},It=function(e,t){return function(n){return e(t(n))}},Dt=It(Object.keys,Object),Gt=Object.prototype,Mt=Gt.hasOwnProperty,Ct=function(e){if(!Bt(e))return Dt(e);var t=[];for(var n in Object(e))Mt.call(e,n)&&"constructor"!=n&&t.push(n);return t},Qt=function(e){return null!=e&&St(e.length)&&!Ee(e)},Rt=function(e){return Qt(e)?Nt(e):Ct(e)},qt=function(e,t){return e&&pt(t,Rt(t),e)},Vt=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Wt=Object.prototype,$t=Wt.hasOwnProperty,Yt=function(e){if(!Oe(e))return Vt(e);var t=Bt(e),n=[];for(var r in e)("constructor"!=r||!t&&$t.call(e,r))&&n.push(r);return n},Xt=function(e){return Qt(e)?Nt(e,!0):Yt(e)},Jt=function(e,t){return e&&pt(t,Xt(t),e)},Zt=l(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o?be.Buffer:void 0,c=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=c?c(n):new e.constructor(n);return e.copy(r),r}}),Kt=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Ht=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,a=[];++n<r;){var c=e[n];t(c,n,e)&&(a[o++]=c)}return a},en=function(){return[]},tn=Object.prototype,nn=tn.propertyIsEnumerable,rn=Object.getOwnPropertySymbols,on=rn?function(e){return null==e?[]:(e=Object(e),Ht(rn(e),function(t){return nn.call(e,t)}))}:en,an=on,cn=function(e,t){return pt(e,an(e),t)},ln=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e},dn=It(Object.getPrototypeOf,Object),pn=dn,sn=Object.getOwnPropertySymbols,un=sn?function(e){for(var t=[];e;)ln(t,an(e)),e=pn(e);return t}:en,yn=un,bn=function(e,t){return pt(e,yn(e),t)},fn=function(e,t,n){var r=t(e);return _t(e)?r:ln(r,n(e))},hn=function(e){return fn(e,Rt,an)},gn=function(e){return fn(e,Xt,yn)},mn=qe(be,"DataView"),jn=mn,_n=qe(be,"Promise"),xn=_n,wn=qe(be,"Set"),vn=wn,kn=qe(be,"WeakMap"),Sn=kn,An="[object Map]",On="[object Promise]",En="[object Set]",Pn="[object WeakMap]",Ln="[object DataView]",Tn=Ne(jn),Un=Ne(We),zn=Ne(xn),Nn=Ne(vn),Fn=Ne(Sn),Bn=Ae;(jn&&Bn(new jn(new ArrayBuffer(1)))!=Ln||We&&Bn(new We)!=An||xn&&Bn(xn.resolve())!=On||vn&&Bn(new vn)!=En||Sn&&Bn(new Sn)!=Pn)&&(Bn=function(e){var t=Ae(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Ne(n):"";if(r)switch(r){case Tn:return Ln;case Un:return An;case zn:return On;case Nn:return En;case Fn:return Pn;}return t});var In=Bn,Dn=Object.prototype,Gn=Dn.hasOwnProperty,Mn=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Gn.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Cn=be.Uint8Array,Qn=Cn,Rn=function(e){var t=new e.constructor(e.byteLength);return new Qn(t).set(new Qn(e)),t},qn=function(e,t){var n=t?Rn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},Vn=/\w*$/,Wn=function(e){var t=new e.constructor(e.source,Vn.exec(e));return t.lastIndex=e.lastIndex,t},$n=he?he.prototype:void 0,Yn=$n?$n.valueOf:void 0,Xn=function(e){return Yn?Object(Yn.call(e)):{}},Jn=function(e,t){var n=t?Rn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},Zn=function(e,t,n){var r=e.constructor;return"[object ArrayBuffer]"===t?Rn(e):"[object Boolean]"===t||"[object Date]"===t?new r(+e):"[object DataView]"===t?qn(e,n):"[object Float32Array]"===t||"[object Float64Array]"===t||"[object Int8Array]"===t||"[object Int16Array]"===t||"[object Int32Array]"===t||"[object Uint8Array]"===t||"[object Uint8ClampedArray]"===t||"[object Uint16Array]"===t||"[object Uint32Array]"===t?Jn(e,n):"[object Map]"===t?new r:"[object Number]"===t||"[object String]"===t?new r(e):"[object RegExp]"===t?Wn(e):"[object Set]"===t?new r:"[object Symbol]"===t?Xn(e):void 0},Kn=Object.create,Hn=function(){function e(){}return function(t){if(!Oe(t))return{};if(Kn)return Kn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),er=function(e){return"function"!=typeof e.constructor||Bt(e)?{}:Hn(pn(e))},tr=Et&&Et.isMap,nr=tr?Ot(tr):function(e){return ut(e)&&In(e)=="[object Map]"},rr=nr,or=Et&&Et.isSet,ar=or?Ot(or):function(e){return ut(e)&&In(e)=="[object Set]"},cr=ar,lr={};lr["[object Arguments]"]=lr["[object Array]"]=lr["[object ArrayBuffer]"]=lr["[object DataView]"]=lr["[object Boolean]"]=lr["[object Date]"]=lr["[object Float32Array]"]=lr["[object Float64Array]"]=lr["[object Int8Array]"]=lr["[object Int16Array]"]=lr["[object Int32Array]"]=lr["[object Map]"]=lr["[object Number]"]=lr["[object Object]"]=lr["[object RegExp]"]=lr["[object Set]"]=lr["[object String]"]=lr["[object Symbol]"]=lr["[object Uint8Array]"]=lr["[object Uint8ClampedArray]"]=lr["[object Uint16Array]"]=lr["[object Uint32Array]"]=!0,lr["[object Error]"]=lr["[object Function]"]=lr["[object WeakMap]"]=!1;var dr=_,ir=function(e){return dr(e,5)},pr=x,sr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ur=/^\w*$/,yr=w;v.Cache=tt;var br=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,fr=/\\(\\)?/g,hr=function(e){var t=v(e,function(e){return 500===n.size&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(br,function(e,n,r,o){t.push(r?o.replace(fr,"$1"):n||e)}),t}),gr=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o},mr=1/0,jr=he?he.prototype:void 0,_r=jr?jr.toString:void 0,xr=k,wr=function(e){return null==e?"":xr(e)},vr=function(e,t){return _t(e)?e:yr(e,t)?[e]:hr(wr(e))},kr=function(e){if("string"==typeof e||pr(e))return e;var t=e+"";return"0"==t&&1/e==-(1/0)?"-0":t},Sr=function(e,t){t=vr(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[kr(t[n++])];return n&&n==r?e:void 0},Ar=function(e,t,n){var r=null==e?void 0:Sr(e,t);return r===void 0?n:r},Or=0/0,Er=/^\s+|\s+$/g,Pr=/^[-+]0x[0-9a-f]+$/i,Lr=/^0b[01]+$/i,Tr=/^0o[0-7]+$/i,Ur=parseInt,zr=function(e){if("number"==typeof e)return e;if(pr(e))return Or;if(Oe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Oe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Er,"");var n=Lr.test(e);return n||Tr.test(e)?Ur(e.slice(2),n?2:8):Pr.test(e)?Or:+e},Nr=1/0,Fr=function(e){if(!e)return 0===e?e:0;if(e=zr(e),e===Nr||e===-Nr){var t=0>e?-1:1;return 1.7976931348623157e+308*t}return e===e?e:0},Br=function(e){var t=Fr(e),n=t%1;return t===t?n?t-n:t:0},Ir=function(e){return"number"==typeof e&&e==Br(e)},Dr=be.isFinite,Gr=Math.min,Mr=function(e){var t=Math[e];return function(e,n){if(e=zr(e),n=null==n?0:Gr(Br(n),292),n&&Dr(e)){var r=(wr(e)+"e").split("e"),o=t(r[0]+"e"+(+r[1]+n));return r=(wr(o)+"e").split("e"),+(r[0]+"e"+(+r[1]-n))}return t(e)}}("round"),Cr=Mr,Qr=function(e,t,n){var r=-1,o=e.length;0>t&&(t=-t>o?0:o+t),n=n>o?o:n,0>n&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(o);++r<o;)a[r]=e[r+t];return a},Rr=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:Qr(e,t,n)},qr=RegExp("["+"\\u200d"+"\\ud800-\\udfff"+("\\u0300-\\u036f"+"\\ufe20-\\ufe2f"+"\\u20d0-\\u20ff")+"\\ufe0e\\ufe0f"+"]"),Vr=function(e){return qr.test(e)},Wr=Et&&Et.isRegExp,$r=Wr?Ot(Wr):function(e){return ut(e)&&Ae(e)=="[object RegExp]"},Yr=function(e){return e.split("")},Xr="\\ud800-\\udfff",Jr="["+("\\u0300-\\u036f"+"\\ufe20-\\ufe2f"+"\\u20d0-\\u20ff")+"]",Zr="\\ud83c[\\udffb-\\udfff]",Kr="[^"+Xr+"]",Hr="(?:\\ud83c[\\udde6-\\uddff]){2}",eo="[\\ud800-\\udbff][\\udc00-\\udfff]",to="(?:"+Jr+"|"+Zr+")"+"?",no="["+"\\ufe0e\\ufe0f"+"]?",ro="(?:"+"\\u200d"+"(?:"+[Kr,Hr,eo].join("|")+")"+no+to+")*",oo="(?:"+[Kr+Jr+"?",Jr,Hr,eo,"["+Xr+"]"].join("|")+")",ao=RegExp(Zr+"(?="+Zr+")|"+oo+(no+to+ro),"g"),co=function(e){return e.match(ao)||[]},lo=function(e){return Vr(e)?co(e):Yr(e)},io=function(e,t,n){return(n&&"number"!=typeof n&&F(e,t,n)&&(t=n=void 0),n=void 0===n?4294967295:n>>>0,!n)?[]:(e=wr(e),e&&("string"==typeof t||null!=t&&!$r(t))&&(t=xr(t),!t&&Vr(e))?Rr(lo(e),0,n):e.split(t,n))};B.prototype.add=B.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},B.prototype.has=function(e){return this.__data__.has(e)};var po=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},so=function(e,t){return e.has(t)},uo=function(e,t,n,r,o,a){var c=1&n,l=e.length,d=t.length;if(l!=d&&!(c&&d>l))return!1;var i=a.get(e);if(i&&a.get(t))return i==t;var p=-1,s=!0,u=2&n?new B:void 0;for(a.set(e,t),a.set(t,e);++p<l;){var y=e[p],b=t[p];if(r)var f=c?r(b,y,p,t,e,a):r(y,b,p,e,t,a);if(void 0!==f){if(f)continue;s=!1;break}if(u){if(!po(t,function(e,t){if(!so(u,t)&&(y===e||o(y,e,n,r,a)))return u.push(t)})){s=!1;break}}else if(!(y===b||o(y,b,n,r,a))){s=!1;break}}return a["delete"](e),a["delete"](t),s},yo=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n},bo=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n},fo=he?he.prototype:void 0,ho=fo?fo.valueOf:void 0,go=function(e,t,n,r,o,a,c){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!!(e.byteLength==t.byteLength&&a(new Qn(e),new Qn(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ae(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var l=yo;case"[object Set]":var d=1&r;if(l||(l=bo),e.size!=t.size&&!d)return!1;var i=c.get(e);if(i)return i==t;r|=2,c.set(e,t);var p=uo(l(e),l(t),r,o,a,c);return c["delete"](e),p;case"[object Symbol]":if(ho)return ho.call(e)==ho.call(t);}return!1},mo=Object.prototype,jo=mo.hasOwnProperty,_o=Object.prototype,xo=_o.hasOwnProperty,wo=function(e,t,n,r,o,a){var c=_t(e),l=_t(t),d=c?"[object Array]":In(e),i=l?"[object Array]":In(t);d="[object Arguments]"==d?"[object Object]":d,i="[object Arguments]"==i?"[object Object]":i;var p="[object Object]"==d,s="[object Object]"==i,u=d==i;if(u&&wt(e)){if(!wt(t))return!1;c=!0,p=!1}if(u&&!p)return a||(a=new nt),c||Tt(e)?uo(e,t,n,r,o,a):go(e,t,d,n,r,o,a);if(!(1&n)){var y=p&&xo.call(e,"__wrapped__"),b=s&&xo.call(t,"__wrapped__");if(y||b){var f=y?e.value():e,h=b?t.value():t;return a||(a=new nt),o(f,h,n,r,a)}}return!!u&&(a||(a=new nt),I(e,t,n,r,o,a))},vo=D,ko=function(e){return e===e&&!Oe(e)},So=function(e){for(var t=Rt(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,ko(o)]}return t},Ao=function(e,t){return function(n){return null!=n&&n[e]===t&&(t!==void 0||e in Object(n))}},Oo=function(e){var t=So(e);return 1==t.length&&t[0][2]?Ao(t[0][0],t[0][1]):function(n){return n===e||G(n,e,t)}},Eo=function(e,t,n){t=vr(t,e);for(var r,o=-1,a=t.length,c=!1;++o<a&&(r=kr(t[o]),!!(c=null!=e&&n(e,r)));)e=e[r];return c||++o!=a?c:(a=null==e?0:e.length,!!a&&St(a)&&kt(r,a)&&(_t(e)||mt(e)))},Po=function(e,t){return null!=e&&Eo(e,t,M)},Lo=function(e,t){return yr(e)&&ko(t)?Ao(kr(e),t):function(n){var r=Ar(n,e);return r===void 0&&r===t?Po(n,e):vo(t,r,3)}},To=function(e){return e},Uo=function(e){return function(t){return null==t?void 0:t[e]}},zo=function(e){return function(t){return Sr(t,e)}},No=function(e){return yr(e)?Uo(kr(e)):zo(e)},Fo=function(e){return function(t,n,r){for(var o=-1,a=Object(t),c=r(t),l=c.length;l--;){var d=c[e?l:++o];if(!1===n(a[d],d,a))break}return t}}(),Bo=function(e,t){return function(n,r){if(null==n)return n;if(!Qt(n))return e(n,r);for(var o=n.length,a=t?o:-1,c=Object(n);(t?a--:++a<o)&&!(!1===r(c[a],a,c)););return n}}(function(e,t){return e&&Fo(e,t,Rt)}),Io=function(e,t){var n=-1,r=Qt(e)?Array(e.length):[];return Bo(e,function(e,o,a){r[++n]=t(e,o,a)}),r},Do=function(e,t){var n=_t(e)?gr:Io;return n(e,C(t))},Go=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var o=e[t];r[o[0]]=o[1]}return r},Mo=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},Co=function(e,t){return 2>t.length?e:Sr(e,Qr(t,0,-1))},Qo=function(e,t){return t=vr(t,e),e=Co(e,t),null==e||delete e[kr(Mo(t))]},Ro=Function.prototype,qo=Object.prototype,Vo=Ro.toString,Wo=qo.hasOwnProperty,$o=Vo.call(Object),Yo=function(e){if(!ut(e)||Ae(e)!="[object Object]")return!1;var t=pn(e);if(null===t)return!0;var n=Wo.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Vo.call(n)==$o},Xo=function(e){return Yo(e)?void 0:e},Jo=he?he.isConcatSpreadable:void 0,Zo=function(e){return _t(e)||mt(e)||!!(Jo&&e&&e[Jo])},Ko=function(e){var t=null==e?0:e.length;return t?Z(e,1):[]},Ho=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);}return e.apply(t,n)},ea=Math.max,ta=function(e,t,n){return t=ea(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,a=ea(r.length-t,0),c=Array(a);++o<a;)c[o]=r[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=r[o];return l[t]=n(c),Ho(e,this,l)}},na=function(e){return function(){return e}},ra=at?function(e,t){return at(e,"toString",{configurable:!0,enumerable:!1,value:na(t),writable:!0})}:To,oa=Date.now,aa=function(e){var t=0,n=0;return function(){var r=oa(),o=16-(r-n);if(n=r,!(0<o))t=0;else if(800<=++t)return arguments[0];return e.apply(void 0,arguments)}}(ra),ca=function(e){return aa(ta(e,void 0,Ko),e+"")}(function(e,t){var n={};if(null==e)return n;var r=!1;t=gr(t,function(t){return t=vr(t,e),r||(r=1<t.length),t}),pt(e,gn(e),n),r&&(n=dr(n,1|2|4,Xo));for(var o=t.length;o--;)Qo(n,t[o]);return n}),la=ca,da=function(e,t,r){var o=null==e?0:e.length;return o?(t=r||void 0===t?1:Br(t),Qr(e,0>t?0:t,o)):[]};return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e=ir(e),e.mongoUrl||(e.mongoUrl="mongodb://127.0.0.1:27017"),e.mongoDb||(e.mongoDb="wqws"),e.mongoCl||(e.mongoCl="queues"),e.port||(e.port=8080);var t=ee({url:e.mongoUrl,db:e.mongoDb,cl:e.mongoCl}),n=new J(e);return n.on("execute",function(){var e=oe(re.mark(function e(o,a,c,l){var d,i,p,s,u,y,b,f,h,g,m,j,_,x,w;return re.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=function(e){l({_mode:"deliver",data:e})},"pushQueue"===o||"modifyQueue"===o||"subTopic"===o||"unsubTopic"===o){e.next=3;break}return e.abrupt("return");case 3:if(d=Ar(a,"topic",null),"pushQueue"!==o){e.next=14;break}return p=z(),s=Ar(a,"input",null),u=Ar(a,"option"),y={topic:d,id:p,input:s,output:null,transData:Ar(u,"transData",null),timeStart:Ar(u,"timeStart",null),timeExp:Ar(u,"timeExp",null),timeTakeStart:Ar(u,"timeTakeStart",null),timeTakeExp:Ar(u,"timeTakeExp",null),state:"ready"},e.next=11,t.insert(y).then(function(){n.emit(d,{topic:d,id:p,input:y.input,output:y.output,state:y.state}),b="pushQueue success"})["catch"](function(){b={err:"can not find: ".concat(o)}});case 11:c(b),e.next=30;break;case 14:if("modifyQueue"!==o){e.next=29;break}if(f=Ar(a,"id",null),null===f){e.next=25;break}return g=Ar(a,"input",null),m=Ar(a,"output",null),j=Ar(a,"state",null),_={id:f,output:m,state:j},e.next=23,t.save(_).then(function(){n.emit(d,{topic:d,id:f,input:g,output:m,state:j}),h="modifyQueue success"})["catch"](function(){h={err:"can not find: ".concat(o)}});case 23:e.next=26;break;case 25:h={err:"can not find id"};case 26:c(h),e.next=30;break;case 29:"subTopic"===o?(n.deliverQueue=i,n.on(d,n.deliverQueue),x="subTopic success",c(x)):"unsubTopic"==o&&(n.off(d,n.deliverQueue),n.deliverQueue=null,w="unsubTopic success",c(w));case 30:case"end":return e.stop();}},e)}));return function(){return e.apply(this,arguments)}}()),n}});
//# sourceMappingURL=w-runqws-server.umd.js.map
