/*!
 * w-runqws-server v1.0.20
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("ws"),require("events"),require("mongodb"),require("stream")):"function"==typeof define&&define.amd?define(["ws","events","mongodb","stream"],r):(t=t||self)["w-runqws-server"]=r(t.ws,t.events,t.mongodb,t.stream)}(this,(function(t,r,e,n){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,r){return t(r={exports:{}},r.exports),r.exports}var u=i((function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r})),a=i((function(t){var r=function(t){var r=Object.prototype,e=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function c(t,r,e,n){var o=r&&r.prototype instanceof l?r:l,i=Object.create(o.prototype),u=new x(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(e.method=o,e.arg=i;;){var u=e.delegate;if(u){var a=m(u,e);if(a){if(a===s)continue;return a}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var c=f(t,r,e);if("normal"===c.type){if(n=e.done?"completed":"suspendedYield",c.arg===s)continue;return{value:c.arg,done:e.done}}"throw"===c.type&&(n="completed",e.method="throw",e.arg=c.arg)}}}(t,e,u),i}function f(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var s={};function l(){}function v(){}function p(){}var h={};h[o]=function(){return this};var d=Object.getPrototypeOf,y=d&&d(d(O([])));y&&y!==r&&e.call(y,o)&&(h=y);var b=p.prototype=l.prototype=Object.create(h);function g(t){["next","throw","return"].forEach((function(r){t[r]=function(t){return this._invoke(r,t)}}))}function j(t,r){var n;this._invoke=function(o,i){function a(){return new r((function(n,a){!function n(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var l=s.arg,v=l.value;return v&&"object"===u(v)&&e.call(v,"__await")?r.resolve(v.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):r.resolve(v).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,c)}))}c(s.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function m(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,m(t,r),"throw"===r.method))return s;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=f(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,s;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,s):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,s)}function w(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function _(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function O(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return v.prototype=b.constructor=p,p.constructor=v,p[a]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===v||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(j.prototype),j.prototype[i]=function(){return this},t.AsyncIterator=j,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var u=new j(c(r,e,n,o),i);return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},g(b),b[a]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return u.type="throw",u.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=e.call(i,"catchLoc"),c=e.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=t,u.arg=r,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(u)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),s},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),_(e),s}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;_(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:O(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),s}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}}));function c(t,r,e,n,o,i,u){try{var a=t[i](u),c=a.value}catch(t){return void e(t)}a.done?r(c):Promise.resolve(c).then(n,o)}var f=function(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var i=t.apply(r,e);function u(t){c(i,n,o,u,a,"next",t)}function a(t){c(i,n,o,u,a,"throw",t)}u(void 0)}))}};var s=function(){this.__data__=[],this.size=0};var l=function(t,r){return t===r||t!=t&&r!=r};var v=function(t,r){for(var e=t.length;e--;)if(l(t[e][0],r))return e;return-1},p=Array.prototype.splice;var h=function(t){var r=this.__data__,e=v(r,t);return!(e<0)&&(e==r.length-1?r.pop():p.call(r,e,1),--this.size,!0)};var d=function(t){var r=this.__data__,e=v(r,t);return e<0?void 0:r[e][1]};var y=function(t){return v(this.__data__,t)>-1};var b=function(t,r){var e=this.__data__,n=v(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};function g(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}g.prototype.clear=s,g.prototype.delete=h,g.prototype.get=d,g.prototype.has=y,g.prototype.set=b;var j=g;var m=function(){this.__data__=new j,this.size=0};var w=function(t){var r=this.__data__,e=r.delete(t);return this.size=r.size,e};var _=function(t){return this.__data__.get(t)};var x=function(t){return this.__data__.has(t)},O="object"==u(o)&&o&&o.Object===Object&&o,A="object"==("undefined"==typeof self?"undefined":u(self))&&self&&self.Object===Object&&self,k=O||A||Function("return this")(),S=k.Symbol,B=Object.prototype,E=B.hasOwnProperty,U=B.toString,P=S?S.toStringTag:void 0;var L=function(t){var r=E.call(t,P),e=t[P];try{t[P]=void 0;var n=!0}catch(t){}var o=U.call(t);return n&&(r?t[P]=e:delete t[P]),o},z=Object.prototype.toString;var F=function(t){return z.call(t)},I=S?S.toStringTag:void 0;var M=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":I&&I in Object(t)?L(t):F(t)};var N=function(t){var r=u(t);return null!=t&&("object"==r||"function"==r)};var T,D=function(t){if(!N(t))return!1;var r=M(t);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r},C=k["__core-js_shared__"],G=(T=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"";var R=function(t){return!!G&&G in t},$=Function.prototype.toString;var Q=function(t){if(null!=t){try{return $.call(t)}catch(t){}try{return t+""}catch(t){}}return""},q=/^\[object .+?Constructor\]$/,W=Function.prototype,V=Object.prototype,H=W.toString,J=V.hasOwnProperty,Y=RegExp("^"+H.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var K=function(t){return!(!N(t)||R(t))&&(D(t)?Y:q).test(Q(t))};var X=function(t,r){return null==t?void 0:t[r]};var Z=function(t,r){var e=X(t,r);return K(e)?e:void 0},tt=Z(k,"Map"),rt=Z(Object,"create");var et=function(){this.__data__=rt?rt(null):{},this.size=0};var nt=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},ot=Object.prototype.hasOwnProperty;var it=function(t){var r=this.__data__;if(rt){var e=r[t];return"__lodash_hash_undefined__"===e?void 0:e}return ot.call(r,t)?r[t]:void 0},ut=Object.prototype.hasOwnProperty;var at=function(t){var r=this.__data__;return rt?void 0!==r[t]:ut.call(r,t)};var ct=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=rt&&void 0===r?"__lodash_hash_undefined__":r,this};function ft(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}ft.prototype.clear=et,ft.prototype.delete=nt,ft.prototype.get=it,ft.prototype.has=at,ft.prototype.set=ct;var st=ft;var lt=function(){this.size=0,this.__data__={hash:new st,map:new(tt||j),string:new st}};var vt=function(t){var r=u(t);return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var pt=function(t,r){var e=t.__data__;return vt(r)?e["string"==typeof r?"string":"hash"]:e.map};var ht=function(t){var r=pt(this,t).delete(t);return this.size-=r?1:0,r};var dt=function(t){return pt(this,t).get(t)};var yt=function(t){return pt(this,t).has(t)};var bt=function(t,r){var e=pt(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};function gt(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}gt.prototype.clear=lt,gt.prototype.delete=ht,gt.prototype.get=dt,gt.prototype.has=yt,gt.prototype.set=bt;var jt=gt;var mt=function(t,r){var e=this.__data__;if(e instanceof j){var n=e.__data__;if(!tt||n.length<199)return n.push([t,r]),this.size=++e.size,this;e=this.__data__=new jt(n)}return e.set(t,r),this.size=e.size,this};function wt(t){var r=this.__data__=new j(t);this.size=r.size}wt.prototype.clear=m,wt.prototype.delete=w,wt.prototype.get=_,wt.prototype.has=x,wt.prototype.set=mt;var _t=wt;var xt=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t},Ot=function(){try{var t=Z(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var At=function(t,r,e){"__proto__"==r&&Ot?Ot(t,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[r]=e},kt=Object.prototype.hasOwnProperty;var St=function(t,r,e){var n=t[r];kt.call(t,r)&&l(n,e)&&(void 0!==e||r in t)||At(t,r,e)};var Bt=function(t,r,e,n){var o=!e;e||(e={});for(var i=-1,u=r.length;++i<u;){var a=r[i],c=n?n(e[a],t[a],a,e,t):void 0;void 0===c&&(c=t[a]),o?At(e,a,c):St(e,a,c)}return e};var Et=function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n};var Ut=function(t){return null!=t&&"object"==u(t)};var Pt=function(t){return Ut(t)&&"[object Arguments]"==M(t)},Lt=Object.prototype,zt=Lt.hasOwnProperty,Ft=Lt.propertyIsEnumerable,It=Pt(function(){return arguments}())?Pt:function(t){return Ut(t)&&zt.call(t,"callee")&&!Ft.call(t,"callee")},Mt=Array.isArray;var Nt=function(){return!1},Tt=i((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?k.Buffer:void 0,i=(o?o.isBuffer:void 0)||Nt;t.exports=i})),Dt=/^(?:0|[1-9]\d*)$/;var Ct=function(t,r){var e=u(t);return!!(r=null==r?9007199254740991:r)&&("number"==e||"symbol"!=e&&Dt.test(t))&&t>-1&&t%1==0&&t<r};var Gt=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Rt={};Rt["[object Float32Array]"]=Rt["[object Float64Array]"]=Rt["[object Int8Array]"]=Rt["[object Int16Array]"]=Rt["[object Int32Array]"]=Rt["[object Uint8Array]"]=Rt["[object Uint8ClampedArray]"]=Rt["[object Uint16Array]"]=Rt["[object Uint32Array]"]=!0,Rt["[object Arguments]"]=Rt["[object Array]"]=Rt["[object ArrayBuffer]"]=Rt["[object Boolean]"]=Rt["[object DataView]"]=Rt["[object Date]"]=Rt["[object Error]"]=Rt["[object Function]"]=Rt["[object Map]"]=Rt["[object Number]"]=Rt["[object Object]"]=Rt["[object RegExp]"]=Rt["[object Set]"]=Rt["[object String]"]=Rt["[object WeakMap]"]=!1;var $t=function(t){return Ut(t)&&Gt(t.length)&&!!Rt[M(t)]};var Qt=function(t){return function(r){return t(r)}},qt=i((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e&&O.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),Wt=qt&&qt.isTypedArray,Vt=Wt?Qt(Wt):$t,Ht=Object.prototype.hasOwnProperty;var Jt=function(t,r){var e=Mt(t),n=!e&&It(t),o=!e&&!n&&Tt(t),i=!e&&!n&&!o&&Vt(t),u=e||n||o||i,a=u?Et(t.length,String):[],c=a.length;for(var f in t)!r&&!Ht.call(t,f)||u&&("length"==f||o&&("offset"==f||"parent"==f)||i&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||Ct(f,c))||a.push(f);return a},Yt=Object.prototype;var Kt=function(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||Yt)};var Xt=function(t,r){return function(e){return t(r(e))}},Zt=Xt(Object.keys,Object),tr=Object.prototype.hasOwnProperty;var rr=function(t){if(!Kt(t))return Zt(t);var r=[];for(var e in Object(t))tr.call(t,e)&&"constructor"!=e&&r.push(e);return r};var er=function(t){return null!=t&&Gt(t.length)&&!D(t)};var nr=function(t){return er(t)?Jt(t):rr(t)};var or=function(t,r){return t&&Bt(r,nr(r),t)};var ir=function(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r},ur=Object.prototype.hasOwnProperty;var ar=function(t){if(!N(t))return ir(t);var r=Kt(t),e=[];for(var n in t)("constructor"!=n||!r&&ur.call(t,n))&&e.push(n);return e};var cr=function(t){return er(t)?Jt(t,!0):ar(t)};var fr=function(t,r){return t&&Bt(r,cr(r),t)},sr=i((function(t,r){var e=r&&!r.nodeType&&r,n=e&&t&&!t.nodeType&&t,o=n&&n.exports===e?k.Buffer:void 0,i=o?o.allocUnsafe:void 0;t.exports=function(t,r){if(r)return t.slice();var e=t.length,n=i?i(e):new t.constructor(e);return t.copy(n),n}}));var lr=function(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r};var vr=function(t,r){for(var e=-1,n=null==t?0:t.length,o=0,i=[];++e<n;){var u=t[e];r(u,e,t)&&(i[o++]=u)}return i};var pr=function(){return[]},hr=Object.prototype.propertyIsEnumerable,dr=Object.getOwnPropertySymbols,yr=dr?function(t){return null==t?[]:(t=Object(t),vr(dr(t),(function(r){return hr.call(t,r)})))}:pr;var br=function(t,r){return Bt(t,yr(t),r)};var gr=function(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t},jr=Xt(Object.getPrototypeOf,Object),mr=Object.getOwnPropertySymbols?function(t){for(var r=[];t;)gr(r,yr(t)),t=jr(t);return r}:pr;var wr=function(t,r){return Bt(t,mr(t),r)};var _r=function(t,r,e){var n=r(t);return Mt(t)?n:gr(n,e(t))};var xr=function(t){return _r(t,nr,yr)};var Or=function(t){return _r(t,cr,mr)},Ar=Z(k,"DataView"),kr=Z(k,"Promise"),Sr=Z(k,"Set"),Br=Z(k,"WeakMap"),Er=Q(Ar),Ur=Q(tt),Pr=Q(kr),Lr=Q(Sr),zr=Q(Br),Fr=M;(Ar&&"[object DataView]"!=Fr(new Ar(new ArrayBuffer(1)))||tt&&"[object Map]"!=Fr(new tt)||kr&&"[object Promise]"!=Fr(kr.resolve())||Sr&&"[object Set]"!=Fr(new Sr)||Br&&"[object WeakMap]"!=Fr(new Br))&&(Fr=function(t){var r=M(t),e="[object Object]"==r?t.constructor:void 0,n=e?Q(e):"";if(n)switch(n){case Er:return"[object DataView]";case Ur:return"[object Map]";case Pr:return"[object Promise]";case Lr:return"[object Set]";case zr:return"[object WeakMap]"}return r});var Ir=Fr,Mr=Object.prototype.hasOwnProperty;var Nr=function(t){var r=t.length,e=new t.constructor(r);return r&&"string"==typeof t[0]&&Mr.call(t,"index")&&(e.index=t.index,e.input=t.input),e},Tr=k.Uint8Array;var Dr=function(t){var r=new t.constructor(t.byteLength);return new Tr(r).set(new Tr(t)),r};var Cr=function(t,r){var e=r?Dr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)},Gr=/\w*$/;var Rr=function(t){var r=new t.constructor(t.source,Gr.exec(t));return r.lastIndex=t.lastIndex,r},$r=S?S.prototype:void 0,Qr=$r?$r.valueOf:void 0;var qr=function(t){return Qr?Object(Qr.call(t)):{}};var Wr=function(t,r){var e=r?Dr(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)};var Vr=function(t,r,e){var n=t.constructor;switch(r){case"[object ArrayBuffer]":return Dr(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return Cr(t,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Wr(t,e);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return Rr(t);case"[object Set]":return new n;case"[object Symbol]":return qr(t)}},Hr=Object.create,Jr=function(){function t(){}return function(r){if(!N(r))return{};if(Hr)return Hr(r);t.prototype=r;var e=new t;return t.prototype=void 0,e}}();var Yr=function(t){return"function"!=typeof t.constructor||Kt(t)?{}:Jr(jr(t))};var Kr=function(t){return Ut(t)&&"[object Map]"==Ir(t)},Xr=qt&&qt.isMap,Zr=Xr?Qt(Xr):Kr;var te=function(t){return Ut(t)&&"[object Set]"==Ir(t)},re=qt&&qt.isSet,ee=re?Qt(re):te,ne={};ne["[object Arguments]"]=ne["[object Array]"]=ne["[object ArrayBuffer]"]=ne["[object DataView]"]=ne["[object Boolean]"]=ne["[object Date]"]=ne["[object Float32Array]"]=ne["[object Float64Array]"]=ne["[object Int8Array]"]=ne["[object Int16Array]"]=ne["[object Int32Array]"]=ne["[object Map]"]=ne["[object Number]"]=ne["[object Object]"]=ne["[object RegExp]"]=ne["[object Set]"]=ne["[object String]"]=ne["[object Symbol]"]=ne["[object Uint8Array]"]=ne["[object Uint8ClampedArray]"]=ne["[object Uint16Array]"]=ne["[object Uint32Array]"]=!0,ne["[object Error]"]=ne["[object Function]"]=ne["[object WeakMap]"]=!1;var oe=function t(r,e,n,o,i,u){var a,c=1&e,f=2&e,s=4&e;if(n&&(a=i?n(r,o,i,u):n(r)),void 0!==a)return a;if(!N(r))return r;var l=Mt(r);if(l){if(a=Nr(r),!c)return lr(r,a)}else{var v=Ir(r),p="[object Function]"==v||"[object GeneratorFunction]"==v;if(Tt(r))return sr(r,c);if("[object Object]"==v||"[object Arguments]"==v||p&&!i){if(a=f||p?{}:Yr(r),!c)return f?wr(r,fr(a,r)):br(r,or(a,r))}else{if(!ne[v])return i?r:{};a=Vr(r,v,c)}}u||(u=new _t);var h=u.get(r);if(h)return h;u.set(r,a),ee(r)?r.forEach((function(o){a.add(t(o,e,n,o,r,u))})):Zr(r)&&r.forEach((function(o,i){a.set(i,t(o,e,n,i,r,u))}));var d=s?f?Or:xr:f?keysIn:nr,y=l?void 0:d(r);return xt(y||r,(function(o,i){y&&(o=r[i=o]),St(a,i,t(o,e,n,i,r,u))})),a};var ie=function(t){return oe(t,5)};var ue=function(t){return"symbol"==u(t)||Ut(t)&&"[object Symbol]"==M(t)},ae=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ce=/^\w*$/;var fe=function(t,r){if(Mt(t))return!1;var e=u(t);return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!ue(t))||(ce.test(t)||!ae.test(t)||null!=r&&t in Object(r))};function se(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var e=function e(){var n=arguments,o=r?r.apply(this,n):n[0],i=e.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return e.cache=i.set(o,u)||i,u};return e.cache=new(se.Cache||jt),e}se.Cache=jt;var le=se;var ve=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pe=/\\(\\)?/g,he=function(t){var r=le(t,(function(t){return 500===e.size&&e.clear(),t})),e=r.cache;return r}((function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(ve,(function(t,e,n,o){r.push(n?o.replace(pe,"$1"):e||t)})),r}));var de=function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o},ye=S?S.prototype:void 0,be=ye?ye.toString:void 0;var ge=function t(r){if("string"==typeof r)return r;if(Mt(r))return de(r,t)+"";if(ue(r))return be?be.call(r):"";var e=r+"";return"0"==e&&1/r==-1/0?"-0":e};var je=function(t){return null==t?"":ge(t)};var me=function(t,r){return Mt(t)?t:fe(t,r)?[t]:he(je(t))};var we=function(t){if("string"==typeof t||ue(t))return t;var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};var _e=function(t,r){for(var e=0,n=(r=me(r,t)).length;null!=t&&e<n;)t=t[we(r[e++])];return e&&e==n?t:void 0};var xe=function(t,r,e){var n=null==t?void 0:_e(t,r);return void 0===n?e:n};var Oe=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Ae=function(t){return this.__data__.has(t)};function ke(t){var r=-1,e=null==t?0:t.length;for(this.__data__=new jt;++r<e;)this.add(t[r])}ke.prototype.add=ke.prototype.push=Oe,ke.prototype.has=Ae;var Se=ke;var Be=function(t,r){for(var e=-1,n=null==t?0:t.length;++e<n;)if(r(t[e],e,t))return!0;return!1};var Ee=function(t,r){return t.has(r)};var Ue=function(t,r,e,n,o,i){var u=1&e,a=t.length,c=r.length;if(a!=c&&!(u&&c>a))return!1;var f=i.get(t);if(f&&i.get(r))return f==r;var s=-1,l=!0,v=2&e?new Se:void 0;for(i.set(t,r),i.set(r,t);++s<a;){var p=t[s],h=r[s];if(n)var d=u?n(h,p,s,r,t,i):n(p,h,s,t,r,i);if(void 0!==d){if(d)continue;l=!1;break}if(v){if(!Be(r,(function(t,r){if(!Ee(v,r)&&(p===t||o(p,t,e,n,i)))return v.push(r)}))){l=!1;break}}else if(p!==h&&!o(p,h,e,n,i)){l=!1;break}}return i.delete(t),i.delete(r),l};var Pe=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t,n){e[++r]=[n,t]})),e};var Le=function(t){var r=-1,e=Array(t.size);return t.forEach((function(t){e[++r]=t})),e},ze=S?S.prototype:void 0,Fe=ze?ze.valueOf:void 0;var Ie=function(t,r,e,n,o,i,u){switch(e){case"[object DataView]":if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=r.byteLength||!i(new Tr(t),new Tr(r)));case"[object Boolean]":case"[object Date]":case"[object Number]":return l(+t,+r);case"[object Error]":return t.name==r.name&&t.message==r.message;case"[object RegExp]":case"[object String]":return t==r+"";case"[object Map]":var a=Pe;case"[object Set]":var c=1&n;if(a||(a=Le),t.size!=r.size&&!c)return!1;var f=u.get(t);if(f)return f==r;n|=2,u.set(t,r);var s=Ue(a(t),a(r),n,o,i,u);return u.delete(t),s;case"[object Symbol]":if(Fe)return Fe.call(t)==Fe.call(r)}return!1},Me=Object.prototype.hasOwnProperty;var Ne=function(t,r,e,n,o,i){var u=1&e,a=xr(t),c=a.length;if(c!=xr(r).length&&!u)return!1;for(var f=c;f--;){var s=a[f];if(!(u?s in r:Me.call(r,s)))return!1}var l=i.get(t);if(l&&i.get(r))return l==r;var v=!0;i.set(t,r),i.set(r,t);for(var p=u;++f<c;){var h=t[s=a[f]],d=r[s];if(n)var y=u?n(d,h,s,r,t,i):n(h,d,s,t,r,i);if(!(void 0===y?h===d||o(h,d,e,n,i):y)){v=!1;break}p||(p="constructor"==s)}if(v&&!p){var b=t.constructor,g=r.constructor;b==g||!("constructor"in t)||!("constructor"in r)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(v=!1)}return i.delete(t),i.delete(r),v},Te=Object.prototype.hasOwnProperty;var De=function(t,r,e,n,o,i){var u=Mt(t),a=Mt(r),c=u?"[object Array]":Ir(t),f=a?"[object Array]":Ir(r),s="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),l="[object Object]"==(f="[object Arguments]"==f?"[object Object]":f),v=c==f;if(v&&Tt(t)){if(!Tt(r))return!1;u=!0,s=!1}if(v&&!s)return i||(i=new _t),u||Vt(t)?Ue(t,r,e,n,o,i):Ie(t,r,c,e,n,o,i);if(!(1&e)){var p=s&&Te.call(t,"__wrapped__"),h=l&&Te.call(r,"__wrapped__");if(p||h){var d=p?t.value():t,y=h?r.value():r;return i||(i=new _t),o(d,y,e,n,i)}}return!!v&&(i||(i=new _t),Ne(t,r,e,n,o,i))};var Ce=function t(r,e,n,o,i){return r===e||(null==r||null==e||!Ut(r)&&!Ut(e)?r!=r&&e!=e:De(r,e,n,o,t,i))};var Ge=function(t,r,e,n){var o=e.length,i=o,u=!n;if(null==t)return!i;for(t=Object(t);o--;){var a=e[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=e[o])[0],f=t[c],s=a[1];if(u&&a[2]){if(void 0===f&&!(c in t))return!1}else{var l=new _t;if(n)var v=n(f,s,c,t,r,l);if(!(void 0===v?Ce(s,f,3,n,l):v))return!1}}return!0};var Re=function(t){return t==t&&!N(t)};var $e=function(t){for(var r=nr(t),e=r.length;e--;){var n=r[e],o=t[n];r[e]=[n,o,Re(o)]}return r};var Qe=function(t,r){return function(e){return null!=e&&(e[t]===r&&(void 0!==r||t in Object(e)))}};var qe=function(t){var r=$e(t);return 1==r.length&&r[0][2]?Qe(r[0][0],r[0][1]):function(e){return e===t||Ge(e,t,r)}};var We=function(t,r){return null!=t&&r in Object(t)};var Ve=function(t,r,e){for(var n=-1,o=(r=me(r,t)).length,i=!1;++n<o;){var u=we(r[n]);if(!(i=null!=t&&e(t,u)))break;t=t[u]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&Gt(o)&&Ct(u,o)&&(Mt(t)||It(t))};var He=function(t,r){return null!=t&&Ve(t,r,We)};var Je=function(t,r){return fe(t)&&Re(r)?Qe(we(t),r):function(e){var n=xe(e,t);return void 0===n&&n===r?He(e,t):Ce(r,n,3)}};var Ye=function(t){return t};var Ke=function(t){return function(r){return null==r?void 0:r[t]}};var Xe=function(t){return function(r){return _e(r,t)}};var Ze=function(t){return fe(t)?Ke(we(t)):Xe(t)};var tn=function(t){return"function"==typeof t?t:null==t?Ye:"object"==u(t)?Mt(t)?Je(t[0],t[1]):qe(t):Ze(t)};var rn=function(t){return function(r,e,n){for(var o=-1,i=Object(r),u=n(r),a=u.length;a--;){var c=u[t?a:++o];if(!1===e(i[c],c,i))break}return r}}();var en=function(t,r){return function(e,n){if(null==e)return e;if(!er(e))return t(e,n);for(var o=e.length,i=r?o:-1,u=Object(e);(r?i--:++i<o)&&!1!==n(u[i],i,u););return e}}((function(t,r){return t&&rn(t,r,nr)}));var nn=function(t,r){var e=-1,n=er(t)?Array(t.length):[];return en(t,(function(t,o,i){n[++e]=r(t,o,i)})),n};var on=function(t,r){return(Mt(t)?de:nn)(t,tn(r))},un=/^\s+|\s+$/g,an=/^[-+]0x[0-9a-f]+$/i,cn=/^0b[01]+$/i,fn=/^0o[0-7]+$/i,sn=parseInt;var ln=function(t){if("number"==typeof t)return t;if(ue(t))return NaN;if(N(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=N(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(un,"");var e=cn.test(t);return e||fn.test(t)?sn(t.slice(2),e?2:8):an.test(t)?NaN:+t};var vn=function(t){return t?(t=ln(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var pn=function(t){var r=vn(t),e=r%1;return r==r?e?r-e:r:0};var hn=function(t){return"number"==typeof t&&t==pn(t)};function dn(t){return"[object String]"===Object.prototype.toString.call(t)}function yn(t){return!(!dn(t)||""===t)}function bn(t){var r=!1;return yn(t)?r=!isNaN(Number(t)):function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(r=!0),r}function gn(t){return bn(t)?vn(t):0}var jn=k.isFinite,mn=Math.min;var wn=function(t){var r=Math[t];return function(t,e){if(t=ln(t),(e=null==e?0:mn(pn(e),292))&&jn(t)){var n=(je(t)+"e").split("e"),o=r(n[0]+"e"+(+n[1]+e));return+((n=(je(o)+"e").split("e"))[0]+"e"+(+n[1]-e))}return r(t)}}("round");function _n(t){if(!bn(t))return 0;t=gn(t);var r=wn(t);return"0"===String(r)?0:r}function xn(t){return!!function(t){return!!bn(t)&&(t=gn(t),hn(t))}(t)&&_n(t)>0}var On="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),An=On.length;function kn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r=[];t=xn(t)?_n(t):32;for(var e=0;e<t;e++)r[e]=On[0|Math.random()*An];var n=r.join("");return n}function Sn(){var t,r,e=new Promise((function(){t=arguments[0],r=arguments[1]}));return e.resolve=t,e.reject=r,e}var Bn=function(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+r];return i};var En=function(t,r,e){var n=t.length;return e=void 0===e?n:e,!r&&e>=n?t:Bn(t,r,e)},Un=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Pn=function(t){return Un.test(t)};var Ln=function(t,r,e){if(!N(e))return!1;var n=u(r);return!!("number"==n?er(e)&&Ct(r,e.length):"string"==n&&r in e)&&l(e[r],t)};var zn=function(t){return Ut(t)&&"[object RegExp]"==M(t)},Fn=qt&&qt.isRegExp,In=Fn?Qt(Fn):zn;var Mn=function(t){return t.split("")},Nn="[\\ud800-\\udfff]",Tn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Dn="\\ud83c[\\udffb-\\udfff]",Cn="[^\\ud800-\\udfff]",Gn="(?:\\ud83c[\\udde6-\\uddff]){2}",Rn="[\\ud800-\\udbff][\\udc00-\\udfff]",$n="(?:"+Tn+"|"+Dn+")"+"?",Qn="[\\ufe0e\\ufe0f]?"+$n+("(?:\\u200d(?:"+[Cn,Gn,Rn].join("|")+")[\\ufe0e\\ufe0f]?"+$n+")*"),qn="(?:"+[Cn+Tn+"?",Tn,Gn,Rn,Nn].join("|")+")",Wn=RegExp(Dn+"(?="+Dn+")|"+qn+Qn,"g");var Vn=function(t){return t.match(Wn)||[]};var Hn=function(t){return Pn(t)?Vn(t):Mn(t)};var Jn=function(t,r,e){return e&&"number"!=typeof e&&Ln(t,r,e)&&(r=e=void 0),(e=void 0===e?4294967295:e>>>0)?(t=je(t))&&("string"==typeof r||null!=r&&!In(r))&&!(r=ge(r))&&Pn(t)?En(Hn(t),0,e):t.split(r,e):[]};function Yn(t){var r=Object.prototype.toString.call(t);return"[object Function]"===r||"[object AsyncFunction]"===r}var Kn=Math.ceil,Xn=Math.max;var Zn=function(t,r,e){r=(e?Ln(t,r,e):void 0===r)?1:Xn(pn(r),0);var n=null==t?0:t.length;if(!n||r<1)return[];for(var o=0,i=0,u=Array(Kn(n/r));o<n;)u[i++]=Bn(t,o,o+=r);return u},to=Array.prototype.join;var ro=function(t,r){return null==t?"":to.call(t,r)};var eo=function(t){return"function"==typeof t?t:Ye};var no=function(t,r){return(Mt(t)?xt:en)(t,eo(r))};function oo(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function io(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function uo(t,r){return yn(t)&&xn(r)?t.substr(0,r):""}function ao(t,r){return yn(t)&&xn(r)?function(t,r){if(!yn(t))return"";if(!xn(r))return"";var e=t.length-r;return e<0&&(e=0),t.substr(e,r)}(t,t.length-r):""}var co=i((function(t,r){var e;t.exports=(e=e||function(t,r){var e=Object.create||function(){function t(){}return function(r){var e;return t.prototype=r,e=new t,t.prototype=null,e}}(),n={},o=n.lib={},i=o.Base={extend:function(t){var r=e(this);return t&&r.mixIn(t),r.hasOwnProperty("init")&&this.init!==r.init||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},u=o.WordArray=i.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=null!=r?r:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var r=this.words,e=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var u=e[i>>>2]>>>24-i%4*8&255;r[n+i>>>2]|=u<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)r[n+i>>>2]=e[i>>>2];return this.sigBytes+=o,this},clamp:function(){var r=this.words,e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8,r.length=t.ceil(e/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(r){for(var e,n=[],o=function(r){r=r;var e=987654321,n=4294967295;return function(){var o=((e=36969*(65535&e)+(e>>16)&n)<<16)+(r=18e3*(65535&r)+(r>>16)&n)&n;return o/=4294967296,(o+=.5)*(t.random()>.5?1:-1)}},i=0;i<r;i+=4){var a=o(4294967296*(e||t.random()));e=987654071*a(),n.push(4294967296*a()|0)}return new u.init(n,r)}}),a=n.enc={},c=a.Hex={stringify:function(t){for(var r=t.words,e=t.sigBytes,n=[],o=0;o<e;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var r=t.length,e=[],n=0;n<r;n+=2)e[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new u.init(e,r/2)}},f=a.Latin1={stringify:function(t){for(var r=t.words,e=t.sigBytes,n=[],o=0;o<e;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var r=t.length,e=[],n=0;n<r;n++)e[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new u.init(e,r)}},s=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(f.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return f.parse(unescape(encodeURIComponent(t)))}},l=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=s.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(r){var e=this._data,n=e.words,o=e.sigBytes,i=this.blockSize,a=o/(4*i),c=(a=r?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*i,f=t.min(4*c,o);if(c){for(var s=0;s<c;s+=i)this._doProcessBlock(n,s);var l=n.splice(0,c);e.sigBytes-=f}return new u.init(l,f)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),v=(o.Hasher=l.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(r,e){return new t.init(e).finalize(r)}},_createHmacHelper:function(t){return function(r,e){return new v.HMAC.init(t,e).finalize(r)}}}),n.algo={});return n}(Math),e)})),fo=i((function(t,r){var e,n,o;t.exports=(n=(e=o=co).lib.WordArray,e.enc.Base64={stringify:function(t){var r=t.words,e=t.sigBytes,n=this._map;t.clamp();for(var o=[],i=0;i<e;i+=3)for(var u=(r[i>>>2]>>>24-i%4*8&255)<<16|(r[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|r[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<e;a++)o.push(n.charAt(u>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var r=t.length,e=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<e.length;i++)o[e.charCodeAt(i)]=i}var u=e.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(r=a)}return function(t,r,e){for(var o=[],i=0,u=0;u<r;u++)if(u%4){var a=e[t.charCodeAt(u-1)]<<u%4*2,c=e[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=(a|c)<<24-i%4*8,i++}return n.create(o,i)}(t,r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)})),so=i((function(t,r){var e;t.exports=(e=co,function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],o=0;o<e;o++)n[o>>>2]|=t[o]<<24-o%4*8;r.call(this,n,e)}else r.apply(this,arguments)}).prototype=t}}(),e.lib.WordArray)}));function lo(t){return oo(t)?so.create(t).toString(fo):""}function vo(t){if(!dn(t))return new Uint8Array;for(var r=fo.parse(t),e=r.words,n=r.sigBytes,o=new Uint8Array(n),i=0;i<n;i++){var u=e[i>>>2]>>>24-i%4*8&255;o[i]=u}return o}function po(t){return io(t)?lo(function(t){return io(t)?new Uint8Array(t):new Uint8Array}(t)):""}function ho(t){return dn(t)?function(t){return oo(t)?new Uint16Array(t):new Uint16Array}(vo(t)):new Uint16Array}var yo="[Uint8Array]::";var bo="[Uint16Array]::";var go={tagU8A:yo,u8arr2b64:function(t){return oo(t)?yo+lo(t):t},b642u8arr:function(t){return dn(t)&&uo(t,yo.length)===yo?vo(t=ao(t,yo.length)):t},tagU16A:bo,u16arr2b64:function(t){return io(t)?bo+po(t):t},b642u16arr:function(t){return dn(t)&&uo(t,bo.length)===bo?ho(t=ao(t,bo.length)):t}};function jo(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function mo(t){return"[object Array]"===Object.prototype.toString.call(t)}function wo(t,r,e,n,o){var i=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(jo(t))return"";if(dn(r))r=[r];else if(!mo(r))return"";function e(t,e){return r.indexOf("Uint8Array")>=0&&(e=go.u8arr2b64(e)),r.indexOf("Uint16Array")>=0&&(e=go.u16arr2b64(e)),e}var n="";try{n=JSON.stringify(t,e)}catch(t){n=""}return n}(e),u=Zn(i,r),a=kn(),c=u.length;no(u,(function(r,e){r=ro(r,"");var i="".concat(a,"|").concat(e,"|").concat(c,"|").concat(r);t.send(i,(function(t){t&&D(o)&&o(t)})),D(n)&&n((e+1)/c*100)}))}var _o=function(t,r,e){var n=null==t?0:t.length;return n?(r=e||void 0===r?1:pn(r),Bn(t,r<0?0:r,n)):[]},xo=Math.ceil,Oo=Math.max;var Ao=function(t,r,e,n){for(var o=-1,i=Oo(xo((r-t)/(e||1)),0),u=Array(i);i--;)u[n?i:++o]=t,t+=e;return u};var ko=function(t){return function(r,e,n){return n&&"number"!=typeof n&&Ln(r,e,n)&&(e=n=void 0),r=vn(r),void 0===e?(e=r,r=0):e=vn(e),n=void 0===n?r<e?1:-1:vn(n),Ao(r,e,n,t)}}();function So(t,r){return e=t,"[object Object]"===Object.prototype.toString.call(e)&&(!!yn(r)&&r in t);var e}var Bo={};function Eo(t,r){var e=Jn(t,"|"),n=e[0],o=ln(e[1]),i=ln(e[2]),u=ro(_o(e,3),"|");if(So(Bo,n)||(Bo[n]={}),Bo[n]["_"+o]=u,o===i-1){var a="";no(ko(i),(function(t){a+=Bo[n]["_"+t]})),delete Bo[n],r(function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(dn(r))r=[r];else if(!mo(r))return{};function e(t,e){return r.indexOf("Uint8Array")>=0&&(e=go.b642u8arr(e)),r.indexOf("Uint16Array")>=0&&(e=go.b642u16arr(e)),e}var n={};try{n=JSON.parse(t,e)}catch(t){n={}}return n}(a))}}function Uo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.port||(e.port=8080),e.strSplitLength||(e.strSplitLength=1e6);var n=new r.EventEmitter;function o(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),o=1;o<r;o++)e[o-1]=arguments[o];setTimeout((function(){n.emit.apply(n,[t].concat(e))}),1)}var i=t.Server,u={port:e.port},a=null;try{a=new i(u)}catch(t){f({msg:"can not create websocket",err:t})}if(!a)return n;function c(){o("open")}function f(t){o("error",t)}function s(){o("clientChange",l)}c();var l=[];return a.on("connection",(function(r,i){function u(n,o){r.readyState===t.OPEN&&wo(r,e.strSplitLength,n,o,(function(t){f({msg:"can not send message",err:t})}))}function a(t){var r=xe(t,"_mode","");"execute"===r?o("execute",xe(t,"func",""),xe(t,"input"),(function(r){t.output=r,delete t.input,u(t,null)}),u):"broadcast"===r?o("broadcast",xe(t,"data")):"deliver"===r?o("deliver",xe(t,"data")):f({msg:"can not find _mode in data",err:t})}l.push(r),s(),r.on("close",(function(){l=l.filter((function(t){return t!==r})),s()})),r.sendData=u,r.on("message",(function(t){Eo(t,a)})),n.on("triggerBroadcast",(function(t,r){u({_mode:"broadcast",data:t},r)}))})),n.broadcast=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};o("triggerBroadcast",t,r)},n}var Po=function(t){var r=null==t?0:t.length;return r?t[r-1]:void 0};var Lo=function(t,r){return r.length<2?t:_e(t,Bn(r,0,-1))};var zo=function(t,r){return r=me(r,t),null==(t=Lo(t,r))||delete t[we(Po(r))]},Fo=Function.prototype,Io=Object.prototype,Mo=Fo.toString,No=Io.hasOwnProperty,To=Mo.call(Object);var Do=function(t){if(!Ut(t)||"[object Object]"!=M(t))return!1;var r=jr(t);if(null===r)return!0;var e=No.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&Mo.call(e)==To};var Co=function(t){return Do(t)?void 0:t},Go=S?S.isConcatSpreadable:void 0;var Ro=function(t){return Mt(t)||It(t)||!!(Go&&t&&t[Go])};var $o=function t(r,e,n,o,i){var u=-1,a=r.length;for(n||(n=Ro),i||(i=[]);++u<a;){var c=r[u];e>0&&n(c)?e>1?t(c,e-1,n,o,i):gr(i,c):o||(i[i.length]=c)}return i};var Qo=function(t){return(null==t?0:t.length)?$o(t,1):[]};var qo=function(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)},Wo=Math.max;var Vo=function(t,r,e){return r=Wo(void 0===r?t.length-1:r,0),function(){for(var n=arguments,o=-1,i=Wo(n.length-r,0),u=Array(i);++o<i;)u[o]=n[r+o];o=-1;for(var a=Array(r+1);++o<r;)a[o]=n[o];return a[r]=e(u),qo(t,this,a)}};var Ho=function(t){return function(){return t}},Jo=Ot?function(t,r){return Ot(t,"toString",{configurable:!0,enumerable:!1,value:Ho(r),writable:!0})}:Ye,Yo=Date.now;var Ko=function(t){var r=0,e=0;return function(){var n=Yo(),o=16-(n-e);if(e=n,o>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(Jo);var Xo=function(t){return Ko(Vo(t,void 0,Qo),t+"")}((function(t,r){var e={};if(null==t)return e;var n=!1;r=de(r,(function(r){return r=me(r,t),n||(n=r.length>1),r})),Bt(t,Or(t),e),n&&(e=oe(e,7,Co));for(var o=r.length;o--;)zo(e,r[o]);return e}));var Zo=function(t){return"string"==typeof t||!Mt(t)&&Ut(t)&&"[object String]"==M(t)},ti=Ke("length"),ri="[\\ud800-\\udfff]",ei="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ni="\\ud83c[\\udffb-\\udfff]",oi="[^\\ud800-\\udfff]",ii="(?:\\ud83c[\\udde6-\\uddff]){2}",ui="[\\ud800-\\udbff][\\udc00-\\udfff]",ai="(?:"+ei+"|"+ni+")"+"?",ci="[\\ufe0e\\ufe0f]?"+ai+("(?:\\u200d(?:"+[oi,ii,ui].join("|")+")[\\ufe0e\\ufe0f]?"+ai+")*"),fi="(?:"+[oi+ei+"?",ei,ii,ui,ri].join("|")+")",si=RegExp(ni+"(?="+ni+")|"+fi+ci,"g");var li=function(t){for(var r=si.lastIndex=0;si.test(t);)++r;return r};var vi=function(t){return Pn(t)?li(t):ti(t)};var pi=function(t){if(null==t)return 0;if(er(t))return Zo(t)?vi(t):t.length;var r=Ir(t);return"[object Map]"==r||"[object Set]"==r?t.size:rr(t).length};function hi(t,r){var e=Sn();if(!mo(t))return e.reject("rs is not array"),e;Yn(r)||(r=function(t){return t});var n=-1,o=[];return t.reduce((function(t,e){return t.then((function(t){return o.push(t),n+=1,Yn(r)?r(e,n):e}))}),Promise.resolve()).then((function(t){o.push(t),o=_o(o),e.resolve(o)})).catch((function(t){e.reject(t)})),e}var di={useNewUrlParser:!0,useUnifiedTopology:!0};function yi(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.url||(t.url="mongodb://127.0.0.1:27017"),t.db||(t.db="worm"),t.cl||(t.cl="test");var o=new r.EventEmitter,i=e.MongoClient;function u(){return c.apply(this,arguments)}function c(){return(c=f(a.mark((function r(){var e,n,o,u,c=arguments;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:{},n=Sn(),r.next=4,i.connect(t.url,di);case 4:return o=r.sent,u=o.db(t.db),u.collection(t.cl).find(e).toArray((function(t,r){t?n.reject(t):(r=on(r,(function(t){return t=Xo(t,"_id")})),n.resolve(r)),o.close()})),r.abrupt("return",n);case 9:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function s(t){return l.apply(this,arguments)}function l(){return(l=f(a.mark((function r(e){var n,u,c,f;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=ie(e),n=Sn(),r.next=4,i.connect(t.url,di);case 4:return u=r.sent,c=u.db(t.db),f=c.collection(t.cl),mo(e)||(e=[e]),e=on(e,(function(t){return t.id||(t.id=kn()),t})),f.insertMany(e,(function(t,r){t?n.reject(t):r.insertedCount>0?(r=r.result,n.resolve(r),o.emit("change","insert",e,r)):n.reject(t),u.close()})),r.abrupt("return",n);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function v(t){return p.apply(this,arguments)}function p(){return(p=f(a.mark((function r(e){var n,u,c,f,l,v,p,h,d=arguments;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:{},e=ie(e),u=xe(n,"autoInsert",!0),c=xe(n,"atomic",!1),f=Sn(),r.next=7,i.connect(t.url,di);case 7:return l=r.sent,v=l.db(t.db),p=v.collection(t.cl),mo(e)||(e=[e]),h=null,h=c?"findOneAndUpdate":"updateOne",hi(e,(function(t){var r=Sn();return p[h]({id:t.id},{$set:t},(function(e,n){e?r.reject(e):(n.lastErrorObject&&(n.result={n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}),u&&0===n.result.n?s(t).then((function(t){t.nInserted=1,r.resolve(t)})).catch((function(t){r.reject(t)})):r.resolve(n.result))})),r})).then((function(t){f.resolve(t),o.emit("change","save",e,t)})).catch((function(t){f.reject(t)})).finally((function(){l.close()})),r.abrupt("return",f);case 15:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function h(t){return d.apply(this,arguments)}function d(){return(d=f(a.mark((function r(e){var n,u,c,f;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=ie(e),n=Sn(),r.next=4,i.connect(t.url,di);case 4:return u=r.sent,c=u.db(t.db),f=c.collection(t.cl),mo(e)||(e=[e]),hi(e,(function(t){var r=Sn();return f.deleteOne({id:t.id},(function(t,e){t?r.resolve(t):((e=e.result).nDeleted=1,r.resolve(e))})),r})).then((function(t){n.resolve(t),o.emit("change","del",e,t)})).catch((function(t){n.reject(t)})).finally((function(){u.close()})),r.abrupt("return",n);case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function y(){return b.apply(this,arguments)}function b(){return(b=f(a.mark((function r(){var e,n,u,c,f=arguments;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=f.length>0&&void 0!==f[0]?f[0]:{},n=Sn(),r.next=4,i.connect(t.url,di);case 4:return u=r.sent,c=u.db(t.db),c.collection(t.cl).deleteMany(e,(function(t,r){t?n.resolve(t):(r=r.result,n.resolve(r),o.emit("change","delAll",null,r)),u.close()})),r.abrupt("return",n);case 9:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function g(t){return j.apply(this,arguments)}function j(){return(j=f(a.mark((function r(u){var c,f,s,l,v,p,h;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=Sn(),f=kn(),s=Buffer.from(u),r.next=5,i.connect(t.url,di);case 5:return l=r.sent,v=l.db(t.db),p=new e.GridFSBucket(v,{chunkSizeBytes:10485760,bucketName:t.cl}),(h=new n.Readable)._read=function(){},h.push(s),h.push(null),h.pipe(p.openUploadStream(f)).on("error",(function(t){c.reject(t),l.close()})).on("finish",(function(){var t={n:1,ok:1,id:f};c.resolve(t),o.emit("change","insertGfs",null,t),l.close()})),r.abrupt("return",c);case 14:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function m(t){return w.apply(this,arguments)}function w(){return(w=f(a.mark((function r(n){var o,u,c,f,s,l;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=Sn(),r.next=3,i.connect(t.url,di);case 3:return u=r.sent,c=u.db(t.db),f=new e.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:t.cl}),s=Buffer.from(""),(l=f.openDownloadStreamByName(n)).on("data",(function(t){s=Buffer.concat([s,t])})),l.on("error",(function(t){o.reject(t),u.close()})),l.on("end",(function(){var t=new Uint8Array(s);s=null,o.resolve(t),u.close()})),r.abrupt("return",o);case 12:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function _(){return x.apply(this,arguments)}function x(){return(x=f(a.mark((function r(){var n,o,u,c,f,s=arguments;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=s.length>0&&void 0!==s[0]?s[0]:{},o=s.length>1&&void 0!==s[1]?s[1]:null,u=Sn(),null!==o){r.next=9;break}return r.next=6,i.connect(t.url,di);case 6:c=r.sent,f=c.db(t.db),o=new e.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:t.cl});case 9:return o.find(n).toArray((function(t,r){t?u.reject(t):u.resolve(r)})),r.abrupt("return",u);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function O(t){return A.apply(this,arguments)}function A(){return(A=f(a.mark((function r(n){var u,c,f,s,l,v;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=Sn(),r.next=3,i.connect(t.url,di);case 3:return c=r.sent,f=c.db(t.db),s=new e.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:t.cl}),r.next=8,_({filename:n},s);case 8:return 0===(l=r.sent).length?(u.reject("can not find id"),c.close()):l.length>1?(u.reject("duplicate id"),c.close()):(v=l[0]._id,s.delete(v,(function(t){if(t)u.reject(t);else{var r={n:1,nDeleted:1,ok:1};u.resolve(r),o.emit("change","delGfs",null,r)}c.close()}))),r.abrupt("return",u);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function k(t,r){return S.apply(this,arguments)}function S(){return(S=f(a.mark((function t(r,e){var n;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Sn(),e.delete(r,(function(t){t?n.reject(t):n.resolve({n:1,nDeleted:1,ok:1})})),t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(){return E.apply(this,arguments)}function E(){return(E=f(a.mark((function r(){var n,u,c,f,s,l,v,p,h=arguments;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=h.length>0&&void 0!==h[0]?h[0]:{},u=Sn(),r.next=4,i.connect(t.url,di);case 4:return c=r.sent,f=c.db(t.db),s=new e.GridFSBucket(f,{chunkSizeBytes:10485760,bucketName:t.cl}),r.next=9,_(n,s);case 9:return l=r.sent,v=pi(l),p=on(l,(function(t){return k(t._id,s)})),Promise.all(p).then((function(t){var r={n:v,ok:1};u.resolve(r),o.emit("change","delAllGfs",null,r)})).catch((function(t){u.reject(t)})).finally((function(){c.close()})),r.abrupt("return",u);case 14:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return o.select=u,o.insert=s,o.save=v,o.del=h,o.delAll=y,o.selectGfs=m,o.insertGfs=g,o.delGfs=O,o.delAllGfs=B,o}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=ie(t)).mongoUrl||(t.mongoUrl="mongodb://127.0.0.1:27017"),t.mongoDb||(t.mongoDb="wqws"),t.mongoCl||(t.mongoCl="queues"),t.port||(t.port=8080);var r=yi({url:t.mongoUrl,db:t.mongoDb,cl:t.mongoCl}),e=new Uo(t);return e.on("execute",function(){var t=f(a.mark((function t(n,o,i,u){var c,f,s,l,v,p,h,d,y,b,g,j,m,w,_,x,O,A,k,S;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(f=function(t){u({_mode:"deliver",data:t})},c=xe(o,"topic",null),"pushQueue"!==n){t.next=12;break}return l=kn(),v=xe(o,"input",null),p=xe(o,"option"),h={topic:c,id:l,input:v,output:null,transData:xe(p,"transData",null),timeStart:xe(p,"timeStart",null),timeExp:xe(p,"timeExp",null),timeTakeStart:xe(p,"timeTakeStart",null),timeTakeExp:xe(p,"timeTakeExp",null),state:"ready"},t.next=9,r.insert(h).then((function(t){e.emit(c,{topic:c,id:l,input:h.input,output:h.output,state:h.state}),s="success"})).catch((function(t){s={err:t}}));case 9:i(s),t.next=105;break;case 12:if("modifyQueue"!==n){t.next=27;break}if(null===(d=xe(o,"id",null))){t.next=23;break}return y=xe(o,"input",null),b=xe(o,"output",null),g=xe(o,"state",null),j={id:d,output:b,state:g},t.next=21,r.save(j,{atomic:!0}).then((function(t){e.emit(c,{topic:c,id:d,input:y,output:b,state:g}),s="success"})).catch((function(t){s={err:t}}));case 21:t.next=24;break;case 23:s={err:"can not find id"};case 24:i(s),t.next=105;break;case 27:if("subTopic"!==n){t.next=34;break}e.deliverQueue=f,e.on(c,e.deliverQueue),i(s="success"),t.next=105;break;case 34:if("unsubTopic"!==n){t.next=41;break}e.off(c,e.deliverQueue),e.deliverQueue=null,i(s="success"),t.next=105;break;case 41:if("delQueueByTopic"!==n){t.next=47;break}return t.next=44,r.delAll({topic:c}).then((function(t){s="success"})).catch((function(t){s={err:t}}));case 44:i(s),t.next=105;break;case 47:if("delQueueByID"!==n){t.next=58;break}if(null===(m=xe(o,"id",null))){t.next=54;break}return t.next=52,r.delAll({id:m}).then((function(t){s="success"})).catch((function(t){s={err:t}}));case 52:t.next=55;break;case 54:s={err:"can not find id"};case 55:i(s),t.next=105;break;case 58:if("delQueueByIDs"!==n){t.next=66;break}return w=xe(o,"ids",null),_=on(w,(function(t){return r.delAll({id:t})})),t.next=63,Promise.all(_).then((function(t){s="success"})).catch((function(t){s={err:t}}));case 63:i(s),t.next=105;break;case 66:if("delQueueByMatches"!==n){t.next=73;break}return x=xe(o,"find",null),t.next=70,r.delAll(x).then((function(t){s="success"})).catch((function(t){s={err:t}}));case 70:i(s),t.next=105;break;case 73:if("getQueueByTopic"!==n){t.next=79;break}return t.next=76,r.select({topic:c}).then((function(t){s=t})).catch((function(t){s={err:t}}));case 76:i(s),t.next=105;break;case 79:if("getQueueByID"!==n){t.next=90;break}if(null===(O=xe(o,"id",null))){t.next=86;break}return t.next=84,r.select({id:O}).then((function(t){s=t})).catch((function(t){s={err:t}}));case 84:t.next=87;break;case 86:s={err:"can not find id"};case 87:i(s),t.next=105;break;case 90:if("getQueueByIDs"!==n){t.next=98;break}return A=xe(o,"ids",null),k=on(A,(function(t){return r.select({id:t})})),t.next=95,Promise.all(k).then((function(t){s=t})).catch((function(t){s={err:t}}));case 95:i(s),t.next=105;break;case 98:if("getQueueByMatches"!==n){t.next=105;break}return S=xe(o,"find",null),t.next=102,r.select(S).then((function(t){s=t})).catch((function(t){s={err:t}}));case 102:i(s),t.next=105;break;case 105:case"end":return t.stop()}}),t)})));return function(r,e,n,o){return t.apply(this,arguments)}}()),e}}));
//# sourceMappingURL=w-runqws-server.umd.js.map
